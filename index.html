<!DOCTYPE html>
<html lang="fr">
<head>
    <link rel="manifest" href="/site.webmanifest">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flash Cards Français-Anglais</title>
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2ecc71;
            --text-color: #333;
            --card-bg: #fff;
            --card-shadow: rgba(0, 0, 0, 0.1);
            --body-bg: #f5f7fa;
            --translation-color: #2ecc71;
            --subtitle-color: #666;
            --info-color: #666;
            --button-bg: #e0e0e0;
            --button-text: #333;
            --progress-bg: #e0e0e0;
            --incorrect-color: #e74c3c;
            --correct-color: #2ecc71;
            --save-button-bg: #f39c12;
            --load-button-bg: #9b59b6;
        }
        
        body.dark-mode {
            --primary-color: #ffffff;
            --secondary-color: #3498db;
            --text-color: #000000;
            --card-bg: #2c3e50;
            --card-shadow: rgba(0, 0, 0, 0.3);
            --body-bg: #1a1a1a;
            --translation-color: #3498db;
            --subtitle-color: #bbb;
            --info-color: #bbb;
            --button-bg: #34495e;
            --button-text: #fff;
            --progress-bg: #34495e;
            --incorrect-color: #e74c3c;
            --correct-color: #2ecc71;
            --save-button-bg: #d35400;
            --load-button-bg: #8e44ad;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--body-bg);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            color: var(--text-color);
            transition: all 0.3s ease;
        }
        
        h1 {
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.1rem;
            color: var(--subtitle-color);
            text-align: center;
            margin-bottom: 30px;
        }
        
        .container {
            width: 100%;
            max-width: 600px;
        }
        
        .chapters {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .chapter-btn {
            padding: 8px 15px;
            background-color: var(--button-bg);
            color: var(--button-text);
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .chapter-btn.active {
            background-color: var(--primary-color);
            color: white;
        }
        
        .mode-controls {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            gap: 10px;
        }
        
        .mode-btn {
            padding: 8px 15px;
            background-color: var(--button-bg);
            color: var(--button-text);
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .mode-btn.active {
            background-color: var(--primary-color);
            color: white;
        }
        
        .progress-container {
            width: 100%;
            height: 10px;
            background-color: var(--progress-bg);
            border-radius: 5px;
            margin-bottom: 20px;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background-color: var(--secondary-color);
            border-radius: 5px;
            transition: width 0.3s ease;
        }
        
        .card-container {
            height: 300px;
            margin-bottom: 20px;
            position: relative;
        }
        
        .card {
            width: 100%;
            height: 100%;
            cursor: pointer;
            box-shadow: 0 10px 25px var(--card-shadow);
            border-radius: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: var(--card-bg);
            padding: 20px;
            box-sizing: border-box;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .card-content {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .english-translation {
            color: var(--translation-color);
            font-size: 2rem;
            font-weight: bold;
            display: none;
        }
        
        .success-rate {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 0.9rem;
            font-weight: bold;
            background-color: rgba(255, 255, 255, 0.7);
            padding: 3px 8px;
            border-radius: 10px;
        }
        
        .controls {
            display: flex;
            justify-content: space-between;
            width: 100%;
            margin-bottom: 15px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            background-color: var(--primary-color);
            color: white;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }
        
        .btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .save-load-controls {
            display: flex;
            justify-content: center;
            width: 100%;
            margin-top: 15px;
            gap: 10px;
        }
        
        .save-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            background-color: var(--save-button-bg);
            color: white;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .load-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            background-color: var(--load-button-bg);
            color: white;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .save-btn:hover, .load-btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }
        
        .save-input, .load-input {
            display: none;
        }
        
        .info {
            text-align: center;
            margin-top: 20px;
            font-size: 0.9rem;
            color: var(--info-color);
        }
        
        .timer-container {
            text-align: center;
            margin-top: 20px;
            margin-bottom: 20px;
            font-size: 1.2rem;
            color: var(--primary-color);
            font-weight: bold;
        }
        
        .stats-container {
            text-align: center;
            margin-top: 10px;
            font-size: 0.9rem;
            color: var(--info-color);
        }
        
        .raw-content {
            background-color: var(--card-bg);
            color: var(--text-color);
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
            width: 100%;
            height: 300px;
            overflow-y: auto;
            display: none;
            white-space: pre-line;
            box-shadow: 0 10px 25px var(--card-shadow);
            text-align: left;
            font-size: 1rem;
            line-height: 1.6;
        }
        
        .validation-container {
            width: 100%;
            margin: 15px 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .input-group {
            display: flex;
            width: 100%;
            margin-bottom: 10px;
        }
        
        .translation-input {
            flex: 1;
            padding: 10px;
            border: 1px solid var(--button-bg);
            border-radius: 5px 0 0 5px;
            font-size: 1rem;
            background-color: var(--card-bg);
            color: var(--text-color);
        }
        
        .validate-btn {
            padding: 10px 15px;
            background-color: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 0 5px 5px 0;
            cursor: pointer;
            font-weight: 600;
        }
        
        .validation-result {
            margin-top: 5px;
            font-weight: bold;
            height: 20px;
        }
        
        .correct {
            color: var(--correct-color);
        }
        
        .incorrect {
            color: var(--incorrect-color);
        }
        
        .scores-container {
            display: flex;
            justify-content: space-between;
            width: 100%;
            margin-top: 10px;
        }
        
        .score-item {
            font-size: 0.9rem;
            color: var(--info-color);
        }
        
        .toast {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            font-size: 0.9rem;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .toast.show {
            opacity: 1;
        }
        
        @media (max-width: 600px) {
            .card-content {
                font-size: 1.5rem;
            }
            
            .english-translation {
                font-size: 1.2rem;
            }
            
            .btn, .save-btn, .load-btn {
                padding: 8px 15px;
                font-size: 0.9rem;
            }
            
            .input-group {
                flex-direction: column;
            }
            
            .translation-input {
                border-radius: 5px;
                margin-bottom: 5px;
            }
            
            .validate-btn {
                border-radius: 5px;
                width: 100%;
            }
            
            .save-load-controls {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Flash Cards Français-Anglais</h1>
        <p class="subtitle">Traduisez le mot ou cliquez sur la carte pour voir la traduction</p>
        
        <div class="mode-controls">
            <button class="mode-btn" id="theme-toggle">Mode Sombre</button>
            <button class="mode-btn" id="raw-toggle">Mode Raw</button>
        </div>
        
        <div class="chapters">
            <button class="chapter-btn active" data-chapter="1">Democracy</button>
            <button class="chapter-btn" data-chapter="2">Genetics</button>
            <button class="chapter-btn" data-chapter="3">Immigration</button>
            <button class="chapter-btn" data-chapter="4">International tensions</button>
            <button class="chapter-btn" data-chapter="5">Unemployment</button>
        </div>
        
        <div class="timer-container">
            <div id="timer">00:00</div>
        </div>
        
        <div class="progress-container">
            <div class="progress-bar" style="width: 0%"></div>
        </div>
        
        <div class="card-container">
            <div class="card">
                <div class="card-content">
                    <div class="french-word"></div>
                    <div class="english-translation"></div>
                </div>
                <div class="success-rate" id="success-rate"></div>
            </div>
        </div>
        
        <div class="validation-container">
            <div class="input-group">
                <input type="text" class="translation-input" id="translation-input" placeholder="Entrez la traduction en anglais">
                <button class="validate-btn" id="validate-btn">Valider</button>
            </div>
            <div class="validation-result" id="validation-result"></div>
            <div class="scores-container">
                <div class="score-item">Score: <span id="current-score">0</span></div>
                <div class="score-item">Meilleur score: <span id="best-score">0</span></div>
            </div>
        </div>
        
        <div class="raw-content" id="raw-content"></div>
        
        <div class="controls">
            <button class="btn" id="prev-btn">Précédent</button>
            <button class="btn" id="random-btn">Aléatoire</button>
            <button class="btn" id="next-btn">Suivant</button>
        </div>
        
        <div class="save-load-controls">
            <button class="save-btn" id="save-btn">Sauvegarder</button>
            <input type="file" id="load-input" class="load-input" accept=".json">
            <button class="load-btn" id="load-btn">Charger</button>
        </div>
        
        <div class="info">
            <span id="current-card">0</span>/<span id="total-cards">0</span>
        </div>
        
        <div class="stats-container">
            <div>Meilleur temps: <span id="best-time">-</span></div>
            <div>Cartes vues: <span id="cards-seen">0</span>/<span id="cards-total">0</span></div>
        </div>
    </div>
    
    <div class="toast" id="toast-message"></div>
    
    <script>
        // Structure de données pour les mots par chapitre
        const vocabularyByChapter = {
            1: [
{ french: "monarchie", english: "monarchy" },
{ french: "monarque de droit divin", english: "a monarch by divine right" },
{ french: "souverain", english: "sovereign" },
{ french: "aristocratie", english: "aristocracy" },
{ french: "oligarchie", english: "oligarchy" },
{ french: "dictateur", english: "a dictator" },
{ french: "dictature", english: "dictatorship" },
{ french: "autoritaire", english: "authoritarian" },
{ french: "autoritarisme", english: "authoritarianism" },
{ french: "totalitaire", english: "totalitarian" },
{ french: "totalitarisme", english: "totalitarianism" },
{ french: "homme fort", english: "a strongman" },
{ french: "tyran", english: "a tyrant, an autocrat" },
{ french: "despote", english: "a despot" },
{ french: "despote éclairé", english: "an enlightened despot" },
{ french: "junte militaire", english: "a military junta" },
{ french: "coup d'État", english: "a coup, a coup d’état" },
{ french: "gouvernement autoritaire", english: "a regime" },
{ french: "régime de Vichy / de Pinochet", english: "the Vichy / Pinochet regime" },
{ french: "régime répressif", english: "a repressive regime" },
{ french: "régime politique", english: "a political system" },
{ french: "se démocratiser", english: "to become more democratic" },
{ french: "prendre le pouvoir", english: "to take, seize power" },
{ french: "arriver au pouvoir", english: "to come to power" },
{ french: "arriver au pouvoir (démocratiquement)", english: "to come into office" },
{ french: "être au pouvoir", english: "to be in power" },
{ french: "rester au pouvoir", english: "to remain, stay in power" },
{ french: "s'accrocher au pouvoir", english: "to cling to power" },
{ french: "bonne gouvernance", english: "good governance" },
{ french: "mal administrer, mal gérer", english: "to misrule, mismanage" },
{ french: "mauvaise administration", english: "misrule" },
{ french: "mauvaise gestion", english: "mismanagement" },
{ french: "tenir un dirigeant pour responsable", english: "to hold a leader to account" },
{ french: "être responsable devant les électeurs", english: "to be accountable to the electorate" },
{ french: "responsabilité", english: "accountability" },
{ french: "corruption", english: "corruption, sleaze, bribery" },
{ french: "corrompu", english: "corrupt" },
{ french: "pot-de-vin", english: "a bribe" },
{ french: "acheter, soudoyer qn", english: "to bribe sb" },
{ french: "état de droit, règne de la loi", english: "the rule of law" },
{ french: "multipartisme", english: "multi-party system" },
{ french: "système de parti unique", english: "single-party system" },
{ french: "élections libres et régulières", english: "free and fair elections" },
{ french: "fraude électorale", english: "vote rigging, ballot rigging, electoral fraud" },
{ french: "l'élection était truquée", english: "the election was rigged" },
{ french: "opposant politique", english: "a political opponent" },
{ french: "dissident", english: "a dissident" },
{ french: "bâillonner / museler la presse / l'opposition", english: "to gag / muzzle the press / the opposition" },
{ french: "déclarer l'état d'urgence", english: "to declare a state of emergency" },
{ french: "bafouer la constitution", english: "to trample the constitution" },
{ french: "censurer", english: "to censor" },
{ french: "censure", english: "censorship" },
{ french: "bloquer / restreindre l'accès à internet", english: "to block / restrict internet access" },
{ french: "contourner la censure", english: "to circumvent, bypass censorship" },
{ french: "droits de l'homme", english: "human rights" },
{ french: "atteintes aux droits de l'homme", english: "human rights abuses, violations" },
{ french: "crime contre l'humanité", english: "a crime against humanity" },
{ french: "devoir d'ingérence", english: "the duty to interfere, to intervene" },
{ french: "association de défense des droits de l'homme", english: "human-rights lobby" },
{ french: "passé de la Chine en matière de droits de l'homme", english: "China's human rights record" },
{ french: "mécontentement, malaise", english: "discontent" },
{ french: "provoquer des troubles", english: "to spark unrest" },
{ french: "agitation", english: "turmoil" },
{ french: "bouleversement", english: "an upheaval" },
{ french: "fomenter des troubles", english: "to stir up trouble" },
{ french: "insurgé", english: "an insurgent" },
{ french: "insurrection", english: "an insurgency" },
{ french: "manifestation", english: "a demonstration, a protest march" },
{ french: "manifestant", english: "a demonstrator, a protester" },
{ french: "organiser / participer à un rassemblement", english: "to hold / attend a rally" },
{ french: "émeute", english: "a riot" },
{ french: "émeutier, casseur", english: "a rioter" },
{ french: "des émeutes ont éclaté", english: "riots broke out" },
{ french: "CRS", english: "anti-riot police" },
{ french: "cocktail Molotov", english: "a petrol bomb, a Molotov cocktail" },
{ french: "gaz lacrymogène", english: "tear gas" },
{ french: "heurt, affrontement", english: "a clash" },
{ french: "échauffourée", english: "a skirmish" },
{ french: "complot", english: "a plot" },
{ french: "comploteur", english: "a plotter" },
{ french: "se révolter", english: "to revolt" },
{ french: "se rebeller", english: "to rebel" },
{ french: "rebelle", english: "a rebel" },
{ french: "rébellion, révolte", english: "a rebellion" },
{ french: "déjouer les autorités", english: "to defy the authorities" },
{ french: "soulèvement", english: "an uprising" },
{ french: "se soulever contre", english: "to rise up against" },
{ french: "renverser un dictateur", english: "to overthrow, to topple a dictator" },
{ french: "évincer un dictateur", english: "to oust a dictator" },
{ french: "renversement d'un dictateur", english: "the overthrow of a dictator" },
{ french: "déposer un dirigeant", english: "to depose a ruler" },
{ french: "s'effondrer", english: "to collapse" },
{ french: "restaurer la démocratie", english: "to restore democracy" },
{ french: "chute d'un gouvernement", english: "the downfall of a government" },
{ french: "répression brutale", english: "ruthless repression" },
{ french: "réprimer une rébellion", english: "to put down, to suppress a rebellion" },
{ french: "réprimer, étouffer la contestation", english: "to quell the protests" },
{ french: "mesures de répression", english: "crackdown, clampdown" },
{ french: "mettre les gens en prison", english: "to send people to prison" },
{ french: "passer qn à tabac", english: "to beat sb up" }
],
2: [
{ french: "gène", english: "a gene" },
{ french: "cellule", english: "a cell" },
{ french: "cellules-souches", english: "stem cells" },
{ french: "recherche sur les cellules souches", english: "stem-cell research" },
{ french: "génome humain", english: "the human genome" },
{ french: "cartographie du génome", english: "genome mapping" },
{ french: "carte génétique", english: "gene map, genetic map" },
{ french: "séquence génétique", english: "gene sequence" },
{ french: "séquençage", english: "sequencing" },
{ french: "épissage du gène", english: "gene splicing" },
{ french: "patrimoine héréditaire", english: "gene pool" },
{ french: "généticien", english: "a geneticist" },
{ french: "eugénisme", english: "eugenics" },
{ french: "eugéniste, partisan de l'eugénisme", english: "a eugenicist" },
{ french: "ADN", english: "DNA" },
{ french: "test génétique", english: "a DNA test" },
{ french: "empreinte génétique", english: "a DNA print, genetic print" },
{ french: "analyse ADN", english: "DNA analysis" },
{ french: "prélèvement d'ADN", english: "a DNA sample" },
{ french: "profil génétique", english: "genetic make-up, genetic profile" },
{ french: "analyse de l'empreinte génétique", english: "genetic profiling, DNA fingerprinting" },
{ french: "dépistage génétique", english: "genetic screening" },
{ french: "subir un prélèvement d'ADN", english: "to be DNA-swabbed" },
{ french: "manipulations génétiques, génie génétique", english: "genetic engineering" },
{ french: "transgénique", english: "transgenic" },
{ french: "organisme génétiquement modifié", english: "a genetically modified organism" },
{ french: "OGM", english: "GMOs" },
{ french: "aliments contenant des OGM", english: "GM food" },
{ french: "pommes de terres génétiquement modifiées", english: "GM potatoes" },
{ french: "produits transgéniques", english: "biotech products" },
{ french: "semence, graines", english: "seed" },
{ french: "soja", english: "soyabeans" },
{ french: "colza", english: "rapeseed" },
{ french: "maïs", english: "maize (GB), corn (US)" },
{ french: "blé", english: "wheat" },
{ french: "culture, récolte", english: "a crop" },
{ french: "essais sur le terrain", english: "field trials, crop trials" },
{ french: "culture OGM", english: "a GM crop" },
{ french: "rendement", english: "yield" },
{ french: "filière agroalimentaire", english: "agribusiness" },
{ french: "augmenter, améliorer les rendements", english: "to improve yields" },
{ french: "résistant aux maladies", english: "resistant to disease" },
{ french: "insecticide / pesticide / herbicide", english: "insecticide / pesticide / herbicide" },
{ french: "polliniser", english: "to pollinate" },
{ french: "pollinisation croisée", english: "cross-pollination" },
{ french: "contaminer", english: "to contaminate" },
{ french: "contamination", english: "contamination" },
{ french: "maladie génétique", english: "a genetic disease" },
{ french: "gène défectueux", english: "a faulty gene" },
{ french: "gène manquant", english: "a missing gene" },
{ french: "héréditaire", english: "hereditary" },
{ french: "chromosome X / Y", english: "an X / Y chromosome" },
{ french: "clonage", english: "cloning" },
{ french: "conseil génétique", english: "genetic counselling" },
{ french: "entreprise pharmaceutique", english: "a pharmaceutical company" },
{ french: "thérapie génique", english: "gene therapy" },
{ french: "traitement génique", english: "genetic treatment" },
{ french: "à des fins thérapeutiques", english: "for therapeutic purposes" },
{ french: "agriculture au service de la médecine", english: "pharming" },
{ french: "jouer à l'apprenti-sorcier", english: "to play God" },
{ french: "toucher à la nature", english: "to tamper with nature" },
{ french: "principe de précaution", english: "the precautionary principle, the safety-first principle" },
{ french: "étiquette", english: "a label" },
{ french: "étiquetter", english: "to label" },
{ french: "étiquetage", english: "labelling" },
{ french: "avertir", english: "to warn" },
{ french: "avertissement", english: "a warning" },
{ french: "dont l'origine peut être établie", english: "traceable" },
{ french: "traçabilité", english: "traceability" },
{ french: "effets à long terme", english: "long-term effects" },
{ french: "chaîne alimentaire", english: "the food chain" },
{ french: "sécurité alimentaire", english: "food security" },
{ french: "lobby OGM", english: "the pro-GM lobby" },
{ french: "militants contre les OGM", english: "anti-GM activists" },
{ french: "campagne contre les OGM", english: "an anti-GM campaign" }
],
3: [
{ french: "étranger", english: "a foreigner" },
{ french: "inconnu", english: "a stranger" },
{ french: "nationalité", english: "nationality" },
{ french: "ressortissant étranger", english: "a foreign national" },
{ french: "personnes de nationalité française", english: "French citizens" },
{ french: "émigrer en Nouvelle-Zélande", english: "to emigrate to New Zealand" },
{ french: "immigrer en France", english: "to immigrate to France" },
{ french: "vague d'immigration", english: "a wave of immigration" },
{ french: "immigration à grande échelle / de masse", english: "large-scale / mass immigration" },
{ french: "exode", english: "an exodus" },
{ french: "nouvel arrivant", english: "a newcomer" },
{ french: "pays natal, pays d'origine", english: "native country, home country" },
{ french: "patrie", english: "homeland" },
{ french: "pays d'accueil", english: "a host country" },
{ french: "pays d'adoption", english: "an adoptive country, a country of adoption" },
{ french: "accueillir", english: "to welcome" },
{ french: "accueillant", english: "welcoming" },
{ french: "politique migratoire", english: "immigration policy" },
{ french: "immigration choisie", english: "selective immigration, controlled immigration" },
{ french: "flux migratoires", english: "migration flows" },
{ french: "passager clandestin", english: "a stowaway" },
{ french: "immigration clandestine, irrégulière", english: "illegal immigration" },
{ french: "immigration sauvage", english: "uncontrolled immigration" },
{ french: "immigrant clandestin, sans-papiers", english: "an illegal immigrant, an illegal alien, an undocumented alien" },
{ french: "il est en situation irrégulière", english: "his papers are not in order" },
{ french: "frontière", english: "a border, a frontier" },
{ french: "fermer ses frontières", english: "to close one's borders" },
{ french: "contrôles aux frontières", english: "border controls" },
{ french: "contrôles d'identité", english: "identity checks" },
{ french: "centre de rétention (administrative)", english: "a holding centre, a detention facility" },
{ french: "passeport", english: "a passport" },
{ french: "carte d'identité", english: "an identity card" },
{ french: "visa", english: "a visa" },
{ french: "réfugié", english: "a refugee" },
{ french: "personne déplacée", english: "a displaced person" },
{ french: "apatride", english: "a stateless person" },
{ french: "se réfugier", english: "to take refuge, take shelter" },
{ french: "demander l'asile politique", english: "to seek political asylum" },
{ french: "demandeur d'asile", english: "an asylum-seeker" },
{ french: "fuir la persécution / la misère", english: "to flee persecution / destitution" },
{ french: "échapper à la pauvreté", english: "to escape poverty" },
{ french: "chercher de meilleures conditions de vie", english: "to be in search of better living conditions" },
{ french: "trafic des êtres humains", english: "human trafficking" },
{ french: "contrebandier, passeur", english: "a smuggler" },
{ french: "passeurs d'immigrants clandestins", english: "people-smugglers" },
{ french: "réseau de passeurs", english: "a smuggling ring" },
{ french: "faux passeport", english: "a fake passport" },
{ french: "reconduire qn à la frontière", english: "to escort sb back to the border" },
{ french: "renvoyer un immigrant dans son pays d'origine", english: "to send an immigrant back to his native country" },
{ french: "expulser qn", english: "to deport sb" },
{ french: "être refoulé à la frontière", english: "to be turned away at the border" },
{ french: "être expulsé", english: "to be ordered out of the country" },
{ french: "s'exiler", english: "to go into exile" },
{ french: "exilé", english: "an exile" },
{ french: "exiler, bannir qn", english: "to exile, banish sb" },
{ french: "s'expatrier", english: "to expatriate oneself" },
{ french: "expatrié", english: "an expatriate, an expat" },
{ french: "passer à l'Ouest / à l'ennemi", english: "to defect to the West / to the enemy" },
{ french: "fuite des cerveaux / afflux des cerveaux", english: "brain drain / brain gain" },
{ french: "partir de rien", english: "to start from scratch" },
{ french: "travail au noir", english: "moonlighting" },
{ french: "atelier clandestin", english: "a sweatshop" },
{ french: "exploiter les travailleurs immigrés", english: "to exploit migrant workers" },
{ french: "permis de travail, carte de travail", english: "a work permit" },
{ french: "permis de séjour, carte de séjour", english: "a residence permit, a resident permit" },
{ french: "travailleur migrant", english: "a migrant worker" },
{ french: "travailleur invité (disposant d'un visa temporaire)", english: "a guest worker" },
{ french: "s'intégrer", english: "to become integrated" },
{ french: "bien s'intégrer dans une société", english: "to integrate well into a society" },
{ french: "insertion sociale", english: "social integration" },
{ french: "régulariser la situation des clandestins", english: "to regularise the status of illegal immigrants" },
{ french: "régularisation", english: "regularisation" },
{ french: "se faire naturaliser britannique, être naturalisé britannique, obtenir la nationalité britannique", english: "to be granted British citizenship, to become a British citizen" },
{ french: "quota", english: "a quota" },
{ french: "regroupement familial", english: "family reunion, reunification" },
{ french: "qn qui abuse du système des prestations sociales", english: "a benefit cheat" },
{ french: "fraude aux prestations sociales", english: "benefit fraud" },
{ french: "parasite", english: "a freeloader" },
{ french: "mariage blanc", english: "a sham marriage, a marriage of convenience" },
{ french: "inonder", english: "to flood" },
{ french: "être envahi par les étrangers", english: "to be swamped with foreigners" },
{ french: "arrivée massive, afflux de travailleurs", english: "the influx of workers" },
{ french: "endiguer l'afflux d'immigrés", english: "to stem the flow of immigrants" },
{ french: "limiter / freiner l'immigration", english: "to restrict / curb immigration" },
{ french: "parti d'extrême-droite", english: "a far-right party" },
{ french: "faire fuir les immigrants", english: "to scare immigrants away" },
{ french: "empêcher les indésirables d'entrer", english: "to keep out undesirables" },
{ french: "xénophobie", english: "xenophobia" },
{ french: "xénophobe", english: "xenophobic" },
{ french: "avoir un grand-père né à l'étranger", english: "to have a foreign-born grandfather" },
{ french: "jeunes gens d'origine asiatique / portugaise", english: "young men of Asian / Portuguese descent" },
{ french: "Français de naissance", english: "a native of France" },
{ french: "New Yorkais de souche", english: "a born and bred New Yorker" },
{ french: "il est français de souche", english: "he's of French origin, of French extraction" },
{ french: "Maghreb", english: "North Africa" },
{ french: "Maghrébins", english: "North Africans" },
{ french: "pakistanais / du Bangladesh", english: "Pakistani / Bangladeshi" },
{ french: "hispanophone / parlant le Hindi", english: "Spanish-speaking / Hindi-speaking" },
{ french: "diaspora", english: "diaspora" }
],
4: [
{ french: "affaires étrangères", english: "foreign affairs" },
{ french: "relations extérieures", english: "foreign relations" },
{ french: "communauté internationale", english: "the international community" },
{ french: "problème mondial, planétaire", english: "a global issue" },
{ french: "État souverain", english: "a sovereign state" },
{ french: "souveraineté", english: "sovereignty" },
{ french: "État-nation", english: "a nation-state" },
{ french: "frontière", english: "a border, a frontier" },
{ french: "droit international", english: "international law" },
{ french: "géopolitique", english: "geopolitics" },
{ french: "scène internationale", english: "the international stage, the international scene, the world stage" },
{ french: "jouer un rôle dans qch", english: "to play a role, a part in sth" },
{ french: "occidental / oriental", english: "western / eastern" },
{ french: "politique étrangère, extérieure", english: "foreign policy" },
{ french: "ambassadeur", english: "an ambassador" },
{ french: "ambassade", english: "an embassy" },
{ french: "attaché culturel / commercial / militaire", english: "a cultural / commercial / military attaché" },
{ french: "envoyé, émissaire", english: "an envoy, an emissary" },
{ french: "diplomate", english: "a diplomat" },
{ french: "diplomatie", english: "diplomacy" },
{ french: "rompre / reprendre les relations", english: "to break off / resume diplomatic relations" },
{ french: "relations tendues", english: "tense, strained relations" },
{ french: "réchauffement", english: "a thaw" },
{ french: "refroidissement", english: "a chill, a cooling off" },
{ french: "rappeler un ambassadeur", english: "to recall an ambassador" },
{ french: "normaliser les relations", english: "to normalize relations" },
{ french: "grande puissance", english: "a great power" },
{ french: "superpuissance / hyperpuissance", english: "a superpower / a hyperpower" },
{ french: "hégémonie", english: "hegemony" },
{ french: "impérialisme", english: "imperialism" },
{ french: "impérialiste", english: "imperialistic" },
{ french: "expansionisme", english: "expansionism" },
{ french: "unilatéralisme / multilatéralisme", english: "unilateralism / multilateralism" },
{ french: "bilatéral / multilatéral", english: "bilateral / multilateral" },
{ french: "bipolaire / multipolaire", english: "bipolar / multipolar" },
{ french: "bloc", english: "a bloc" },
{ french: "équilibre des forces", english: "balance of power" },
{ french: "système onusien", english: "the UN system" },
{ french: "État-membre, pays membre", english: "a member state" },
{ french: "membre fondateur", english: "a founding member, founder member" },
{ french: "cotisation", english: "a contribution" },
{ french: "discuter / voter une résolution", english: "to debate / to pass a resolution" },
{ french: "appliquer une résolution", english: "to implement, enforce a resolution" },
{ french: "autoriser l'usage de la force", english: "to authorize the use of force" },
{ french: "embargo", english: "an embargo" },
{ french: "majorité des deux-tiers", english: "a two-thirds majority" },
{ french: "maintenir la paix", english: "to maintain peace" },
{ french: "opération de maintien de la paix", english: "a peace-keeping operation" },
{ french: "soldat de la paix", english: "a peacekeeper" },
{ french: "casque bleu", english: "a blue helmet" },
{ french: "devoir d'ingérence", english: "the duty to interfere, to intervene" },
{ french: "intervention militaire", english: "military intervention" },
{ french: "OTAN", english: "NATO, the North Atlantic Treaty Organization" },
{ french: "négocier", english: "to negotiate" },
{ french: "négociations, pourparlers, discussions", english: "negotiations, talks" },
{ french: "table des négociations", english: "negotiating table" },
{ french: "table ronde", english: "a round table" },
{ french: "faire une déclaration", english: "to make, issue, deliver a statement" },
{ french: "communiqué", english: "a communiqué" },
{ french: "sous l'égide de", english: "under the aegis of" },
{ french: "réunion au sommet, sommet", english: "a summit (meeting)" },
{ french: "porte-parole", english: "a spokesman, spokeswoman, spokesperson" },
{ french: "homologue", english: "a counterpart, an opposite number" },
{ french: "impasse", english: "a stalemate, a deadlock, a standoff, an impasse" },
{ french: "aboutir à une impasse", english: "to reach a stalemate" },
{ french: "sortir d'une impasse", english: "to break a stalemate" },
{ french: "ultimatum", english: "an ultimatum" },
{ french: "médiateur", english: "a mediator" },
{ french: "négocier un accord", english: "to broker an agreement" },
{ french: "surmonter un obstacle", english: "to overcome an obstacle" },
{ french: "volonté politique", english: "political will" },
{ french: "compromis", english: "a compromise" },
{ french: "transiger", english: "to compromise" },
{ french: "faire une concession", english: "to make a concession" },
{ french: "s'engager à faire qch", english: "to commit oneself to doing sth" },
{ french: "promettre de faire, s'engager à faire qch", english: "to pledge to do sth" },
{ french: "signer / ratifier un traité", english: "to sign / ratify a treaty" },
{ french: "protocole", english: "a protocol" },
{ french: "accord", english: "an agreement, an accord" },
{ french: "conclure un accord", english: "to reach a settlement" },
{ french: "stipuler", english: "to stipulate" },
{ french: "parvenir à un consensus", english: "to reach a consensus" },
{ french: "interdire", english: "to prohibit, to ban" },
{ french: "mettre son véto à une décision", english: "to veto a decision" },
{ french: "Union Européenne, l'UE", english: "the European Union, the EU" },
{ french: "directive européenne", english: "an EU directive" },
{ french: "adhérer à l'UE", english: "to join the EU" },
{ french: "demander son adhésion à l'UE", english: "to apply to join the EU, to apply for EU membership" },
{ french: "pourparlers d'adhésion", english: "membership negotiations" },
{ french: "organisation non-gouvernementale, ONG", english: "a non-governmental organization, an NGO" },
{ french: "droits de l'homme", english: "human rights" },
{ french: "violations des droits de l'homme", english: "human rights abuses, violations" },
{ french: "faire respecter un principe", english: "to uphold a principle" },
{ french: "passé de la Chine en matière de droits de l'homme", english: "China's human-rights record" },
{ french: "décolonisation", english: "decolonization" },
{ french: "obtenir l'indépendance, devenir indépendant", english: "to achieve, gain, attain independence" },
{ french: "ancienne colonie", english: "a former colony" },
{ french: "puissance coloniale", english: "a colonial power" }
],
5: [
{ french: "conditions de travail", english: "working conditions" },
{ french: "atelier", english: "a workshop" },
{ french: "usine", english: "a factory, a plant" },
{ french: "atelier clandestin (où la main d'œuvre est exploitée)", english: "a sweatshop" },
{ french: "travailler beaucoup", english: "to work hard" },
{ french: "être travailleur", english: "to be hard-working" },
{ french: "travailleur acharné, bourreau de travail", english: "a hard worker, a workaholic" },
{ french: "permis de travail", english: "a work permit" },
{ french: "être / ne pas être de service OU de garde", english: "to be on duty / off duty" },
{ french: "chômage", english: "unemployment, joblessness" },
{ french: "être au chômage", english: "to be unemployed, jobless, out of work" },
{ french: "taux de chômage", english: "unemployment rate, jobless rate" },
{ french: "chômeurs", english: "the unemployed, the jobless" },
{ french: "chômage de longue durée", english: "long-term unemployment" },
{ french: "chômage des jeunes", english: "youth unemployment" },
{ french: "allocation chômage", english: "unemployment benefit" },
{ french: "toucher le chômage", english: "to be on the dole (GB), to be on welfare (US)" },
{ french: "marché du travail, de l'emploi", english: "job market, labour market" },
{ french: "contrat à durée déterminée, CDD", english: "a fixed-term contract" },
{ french: "contrat à durée indéterminée, CDI", english: "an open-ended contract" },
{ french: "flexibilité de l'emploi", english: "job flexibility" },
{ french: "avoir des horaires flexibles", english: "work flexitime (GB) flextime (US)" },
{ french: "sécurité / précarité de l'emploi", english: "job security / insecurity" },
{ french: "stage", english: "an internship, a work placement" },
{ french: "stagiaire", english: "an intern, a trainee" },
{ french: "travailleur précaire", english: "a casual worker" },
{ french: "petit boulot", english: "an odd job, a casual job" },
{ french: "boulot d'été", english: "a summer job" },
{ french: "intérimaire", english: "a temporary worker" },
{ french: "faire de l'intérim", english: "to temp, to work as a temp" },
{ french: "employer", english: "to employ" },
{ french: "employeur", english: "an employer" },
{ french: "employé", english: "an employee" },
{ french: "changer de travail", english: "to change jobs" },
{ french: "embaucher un travailleur", english: "to hire, to take on a worker" },
{
  "french": "recruter",
  "english": "to recruit"
},
{
  "french": "période d'essai",
  "english": "a trial period"
},
{
  "french": "poste",
  "english": "a post, a position"
},
{
  "french": "nommer qn à un poste",
  "english": "to appoint sb to a post"
},
{
  "french": "muter qn",
  "english": "to transfer sb"
},
{
  "french": "poste à responsabilité(s)",
  "english": "a responsible job"
},
{
  "french": "emploi subalterne",
  "english": "a menial job"
},
{
  "french": "demandeur d'emploi",
  "english": "a job-seeker"
},
{
  "french": "agence Pôle emploi",
  "english": "a Jobcenter (GB)"
},
{
  "french": "CV, curriculum vitae",
  "english": "a curriculum vitae, a CV, a résumé (US)"
},
{
  "french": "expérience professionnelle",
  "english": "work experience"
},
{
  "french": "compétences",
  "english": "skills"
},
{
  "french": "être candidat à un emploi, faire une demande d'emploi",
  "english": "to apply for a job"
},
{
  "french": "candidat à un poste",
  "english": "an applicant"
},
{
  "french": "entretien d'embauche",
  "english": "a job interview"
},
{
  "french": "offre d'emploi",
  "english": "a job offer, a job vacancy, a job opportunity"
},
{
  "french": "travail OU main d'œuvre",
  "english": "labour"
},
{
  "french": "main d'œuvre féminine / travail des enfants",
  "english": "female labour / child labour"
},
{
  "french": "normes en matière d'emploi",
  "english": "labour standards"
},
{
  "french": "main d'œuvre",
  "english": "manpower, workforce"
},
{
  "french": "personnel",
  "english": "staff, personnel"
},
{
  "french": "collègue, camarade de travail",
  "english": "a colleague, a co-worker, a workmate"
},
{
  "french": "ressources humaines",
  "english": "human resources"
},
{
  "french": "travail qualifié / peu qualifié / non qualifié",
  "english": "a skilled / low-skilled / an unskilled job"
},
{
  "french": "ouvrier spécialisé, OS",
  "english": "an unskilled worker"
},
{
  "french": "ouvrier",
  "english": "a blue-collar worker"
},
{
  "french": "employé de bureau",
  "english": "a white-collar worker"
},
{
  "french": "fonctionnaire",
  "english": "a state employee, a civil servant"
},
{
  "french": "salarié du secteur public",
  "english": "a public-sector employee"
},
{
  "french": "haut fonctionnaire",
  "english": "a high-ranking civil servant"
},
{
  "french": "être indépendant, travailler à son compte",
  "english": "to be self-employed"
},
{
  "french": "travailleurs indépendants",
  "english": "the self-employed"
},
{
  "french": "honoraires",
  "english": "fees"
},
{
  "french": "paie, paye",
  "english": "pay"
},
{
  "french": "salaire",
  "english": "salary"
},
{
  "french": "salaire (d'ouvrier)",
  "english": "wages"
},
{
  "french": "gagner de l'argent",
  "english": "to earn money, to make money"
},
{
  "french": "gagner sa vie",
  "english": "to earn a living, to earn one's living, to make a living"
},
{
  "french": "Que fait-il dans la vie ?",
  "english": "What does he do for a living?"
},
{
  "french": "travail mal payé",
  "english": "a badly-paid job, a low-paid job"
},
{
  "french": "travail bien payé",
  "english": "a well-paid job, a highly-paid job"
},
{
  "french": "salarié",
  "english": "a wage-earner"
},
{
  "french": "prime",
  "english": "a bonus"
},
{
  "french": "avantage (en nature), avantage annexe",
  "english": "a perk, a fringe benefit"
},
{
  "french": "voiture de fonction",
  "english": "a company car"
},
{
  "french": "salaire au rendement",
  "english": "performance-related pay"
},
{
  "french": "être employé par une entreprise",
  "english": "to be on a company's payroll"
},
{
  "french": "vacances",
  "english": "holiday, vacation (US)"
},
{
  "french": "congés payés",
  "english": "paid holiday"
},
{
  "french": "être en vacances",
  "english": "to be on holiday"
},
{
  "french": "jour férié",
  "english": "a bank holiday"
},
{
  "french": "être en congé maladie",
  "english": "to be on sick leave"
},
{
  "french": "prendre deux jours de congé",
  "english": "to take two days off"
},
{
  "french": "réduction du temps de travail, RTT",
  "english": "reduction of working hours"
},
{
  "french": "les 35 heures, la semaine de 35 heures",
  "english": "the 35-hour working week"
},
{
  "french": "supprimer des emplois",
  "english": "to cut jobs"
},
{
  "french": "faire des coupes sombres, claires dans la main d'œuvre",
  "english": "to slash, to axe jobs"
},
{
  "french": "pertes d'emploi, suppressions d'emploi",
  "english": "job losses"
},
{
  "french": "rationaliser",
  "english": "to streamline"
},
{
  "french": "dégraisser ses effectifs",
  "english": "to downsize"
},
{
  "french": "licencier des salariés",
  "english": "to lay off workers, to make workers redundant"
},
{
  "french": "licenciement (économique)",
  "english": "a redundancy"
},
{
  "french": "départ volontaire",
  "english": "a voluntary redundancy"
},
{
  "french": "plan social",
  "english": "a redundancy plan"
},
{
  "french": "indemnité de licenciement, prime de départ",
  "english": "redundancy payment, severance pay, severance package"
},
{
  "french": "parachute doré",
  "english": "a golden parachute, a golden handshake"
},
{
  "french": "renvoyer, licencier, congédier qn",
  "english": "to dismiss sb"
},
{
  "french": "mettre à la porte, renvoyer, virer",
  "english": "to fire, to sack, to give sb the sack"
},
{
  "french": "être renvoyé",
  "english": "to get the sack"
},
{
  "french": "conflit social",
  "english": "an industrial dispute"
},
{
  "french": "se mettre / être en grève",
  "english": "to go on strike / be on strike"
},
{
  "french": "gréviste",
  "english": "a striker"
},
{
  "french": "direction et les salariés",
  "english": "management and workers"
},
{
  "french": "délégué syndical",
  "english": "a shop steward"
},
{
  "french": "syndicat",
  "english": "a (trade) union"
},
{
  "french": "revendication",
  "english": "a claim"
},
{
  "french": "revendications salariales",
  "english": "wage claims, wage demands"
},
{
  "french": "augmentation de salaire",
  "english": "a payrise (GB), a payraise (US)"
},
{
  "french": "reprendre le travail",
  "english": "to resume work"
},
{
  "french": "prendre sa retraite",
  "english": "to retire"
},
{
  "french": "démissionner",
  "english": "to resign, to step down"
},
{
  "french": "retraité",
  "english": "a pensioner, an old age pensioner, a retiree (US)"
},
{
  "french": "retraite",
  "english": "retirement"
},
{
  "french": "partir en pré-retraite",
  "english": "to take early retirement"
},
{
  "french": "âge de la retraite",
  "english": "retirement age"
}]};
        
        // Variables d'état
        let currentChapter = 1;
        let currentCardIndex = 0;
        let isTranslationVisible = false;
        let seenCards = new Set();
        let cardHistory = [];
        let isDarkMode = false;
        let isRawMode = false;
        let currentScore = 0;
        let bestScores = {};
        let cardPerformance = {};
        let startTime;
        let timerInterval;
        let bestTimes = {};
        let isTimerActive = true;
        
        // Éléments DOM
        const elements = {
            chapterButtons: document.querySelectorAll('.chapter-btn'),
            card: document.querySelector('.card'),
            cardContainer: document.querySelector('.card-container'),
            rawContent: document.getElementById('raw-content'),
            frenchWord: document.querySelector('.french-word'),
            englishTranslation: document.querySelector('.english-translation'),
            prevBtn: document.getElementById('prev-btn'),
            nextBtn: document.getElementById('next-btn'),
            randomBtn: document.getElementById('random-btn'),
            progressBar: document.querySelector('.progress-bar'),
            currentCardElement: document.getElementById('current-card'),
            totalCardsElement: document.getElementById('total-cards'),
            timerElement: document.getElementById('timer'),
            bestTimeElement: document.getElementById('best-time'),
            cardsSeenElement: document.getElementById('cards-seen'),
            cardsTotalElement: document.getElementById('cards-total'),
            themeToggle: document.getElementById('theme-toggle'),
            rawToggle: document.getElementById('raw-toggle'),
            translationInput: document.getElementById('translation-input'),
            validateBtn: document.getElementById('validate-btn'),
            validationResult: document.getElementById('validation-result'),
            currentScoreElement: document.getElementById('current-score'),
            bestScoreElement: document.getElementById('best-score'),
            successRateElement: document.getElementById('success-rate'),
            saveBtn: document.getElementById('save-btn'),
            loadBtn: document.getElementById('load-btn'),
            loadInput: document.getElementById('load-input'),
            toastMessage: document.getElementById('toast-message')
        };
        
        // Fonction pour afficher un message toast
        function showToast(message, duration = 3000) {
            elements.toastMessage.textContent = message;
            elements.toastMessage.classList.add('show');
            
            setTimeout(() => {
                elements.toastMessage.classList.remove('show');
            }, duration);
        }
        
        // Fonction pour sauvegarder l'état actuel
        function saveState() {
            const state = {
                currentChapter,
                seenCards: Array.from(seenCards),
                cardPerformance,
                bestScores,
                bestTimes,
                isDarkMode,
                currentScore
            };
            
            // Convertir en JSON
            const stateJSON = JSON.stringify(state);
            
            // Créer un objet Blob
            const blob = new Blob([stateJSON], { type: 'application/json' });
            
            // Créer une URL pour le Blob
            const url = URL.createObjectURL(blob);
            
            // Créer un élément de lien
            const a = document.createElement('a');
            a.href = url;
            a.download = `flashcards_save_${new Date().toISOString().slice(0, 10)}.json`;
            
            // Ajouter le lien au document et cliquer dessus
            document.body.appendChild(a);
            a.click();
            
            // Nettoyer
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showToast('Sauvegarde réussie!');
        }
        
        // Fonction pour charger un état sauvegardé
        function loadState(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const state = JSON.parse(e.target.result);
                    
                    // Restaurer l'état
                    currentChapter = state.currentChapter || 1;
                    seenCards = new Set(state.seenCards || []);
                    cardPerformance = state.cardPerformance || {};
                    bestScores = state.bestScores || {};
                    bestTimes = state.bestTimes || {};
                    currentScore = state.currentScore || 0;
                    
                    // Restaurer le thème
                    isDarkMode = state.isDarkMode || false;
                    document.body.classList.toggle('dark-mode', isDarkMode);
                    elements.themeToggle.textContent = isDarkMode ? "Mode Clair" : "Mode Sombre";
                    elements.themeToggle.classList.toggle('active', isDarkMode);
                    
                    // Recharger le chapitre courant
                    currentCardIndex = 0;
                    cardHistory = [];
                    
                    elements.chapterButtons.forEach(btn => {
                        btn.classList.toggle('active', parseInt(btn.dataset.chapter) === currentChapter);
                    });
                    
                    // Mettre à jour l'affichage
                    elements.currentScoreElement.textContent = currentScore;
                    updateBestScoreDisplay();
                    updateBestTimeDisplay();
                    resetTimer();
                    startTimer();
                    
                    if (isRawMode) {
                        generateRawContent();
                    } else {
                        updateCard();
                    }
                    
                    showToast('Chargement réussi!');
                } catch (error) {
                    console.error('Erreur lors du chargement:', error);
                    showToast('Erreur lors du chargement du fichier');
                }
                
                // Réinitialiser l'input file pour permettre le rechargement du même fichier
                elements.loadInput.value = '';
            };
            
            reader.readAsText(file);
        }
        
        // Fonction pour calculer et trier les cartes selon leur taux de succès
        function getSortedCardsByPerformance() {
            const cards = vocabularyByChapter[currentChapter];
            if (!cards || cards.length === 0) return [];
            
            // Créer un tableau d'objets contenant l'index et le taux de succès
            const cardsWithRates = cards.map((_, index) => {
                const cardKey = `${currentChapter}-${index}`;
                const perf = cardPerformance[cardKey];
                const successRate = perf ? perf.successes / perf.attempts : 1; // Par défaut 100% si jamais tentée
                return { index, successRate };
            });
            
            // Trier par taux de succès (ascendant)
            cardsWithRates.sort((a, b) => {
                // Si même taux de succès, ordre aléatoire
                if (a.successRate === b.successRate) {
                    return Math.random() - 0.5;
                }
                return a.successRate - b.successRate;
            });
            
            // Retourner seulement les indices
            return cardsWithRates.map(card => card.index);
        }
        
        // Fonction pour mettre à jour la carte
        function updateCard() {
            const cards = vocabularyByChapter[currentChapter];
            
            if (cards && cards.length > 0) {
                const cardData = cards[currentCardIndex];
                elements.frenchWord.textContent = cardData.french;
                elements.englishTranslation.textContent = cardData.english;
                
                seenCards.add(currentCardIndex);
                
                elements.englishTranslation.style.display = 'none';
                isTranslationVisible = false;
                
                elements.translationInput.value = '';
                elements.validationResult.textContent = '';
                elements.validationResult.className = 'validation-result';
                
                // Mettre à jour l'affichage des statistiques
                updateStatsDisplay();
                
                // Mettre à jour la barre de progression
                elements.progressBar.style.width = `${(seenCards.size / cards.length) * 100}%`;
                
                // Activer/désactiver les boutons
                elements.prevBtn.disabled = cardHistory.length === 0;
                elements.nextBtn.disabled = currentCardIndex === cards.length - 1;
                elements.randomBtn.disabled = cards.length <= 1 || seenCards.size >= cards.length;
                
                // Mettre à jour la couleur de la carte et le taux de succès
                updateCardColorAndSuccessRate();
                
                // Vérifier si toutes les cartes ont été vues
                if (seenCards.size === cards.length) {
                    stopTimer();
                }
            } else {
                showNoCardsMessage();
            }
        }
        
        // Fonction pour afficher un message quand il n'y a pas de cartes
        function showNoCardsMessage() {
            elements.frenchWord.textContent = "Aucune carte disponible";
            elements.englishTranslation.textContent = "";
            elements.englishTranslation.style.display = 'none';
            elements.currentCardElement.textContent = "0";
            elements.totalCardsElement.textContent = "0";
            elements.cardsSeenElement.textContent = "0";
            elements.cardsTotalElement.textContent = "0";
            elements.progressBar.style.width = "0%";
            elements.prevBtn.disabled = true;
            elements.nextBtn.disabled = true;
            elements.randomBtn.disabled = true;
            elements.successRateElement.textContent = "";
        }
        
        // Fonction pour mettre à jour l'affichage des statistiques
        function updateStatsDisplay() {
            const cards = vocabularyByChapter[currentChapter];
            elements.currentCardElement.textContent = currentCardIndex + 1;
            elements.totalCardsElement.textContent = cards.length;
            elements.cardsSeenElement.textContent = seenCards.size;
            elements.cardsTotalElement.textContent = cards.length;
        }
        
        // Fonction pour mettre à jour la couleur et le taux de succès de la carte
        function updateCardColorAndSuccessRate() {
            const cardKey = `${currentChapter}-${currentCardIndex}`;
            
            if (cardPerformance[cardKey]) {
                const performance = cardPerformance[cardKey];
                const successRate = performance.successes / performance.attempts;
                const successPercentage = Math.round(successRate * 100);
                
                // Afficher le pourcentage de réussite
                elements.successRateElement.textContent = `${successPercentage}%`;
                
                // Couleur allant du rouge (0% correct) au vert (100% correct)
                const r = Math.round(231 - (successRate * 231));
                const g = Math.round(46 + (successRate * 140));
                const b = Math.round(60 - (successRate * 50));
                
                elements.card.style.backgroundColor = `rgb(${r}, ${g}, ${b})`;
                
                // Ajuster la couleur du texte pour un meilleur contraste
                elements.frenchWord.style.color = successRate > 0.5 ? "#333" : "#fff";
                
                // Ajuster la couleur du texte du taux de succès
                elements.successRateElement.style.backgroundColor = successRate > 0.5 ? 
                    "rgba(255, 255, 255, 0.7)" : "rgba(0, 0, 0, 0.7)";
                elements.successRateElement.style.color = successRate > 0.5 ? "#333" : "#fff";
            } else {
                // Réinitialiser aux couleurs par défaut si pas d'historique
                elements.card.style.backgroundColor = isDarkMode ? "#2c3e50" : "#fff";
                elements.frenchWord.style.color = isDarkMode ? "#ffffff" : "#3498db";
                elements.successRateElement.textContent = "";
            }
        }
        
        // Fonction pour générer le contenu en mode "raw"
        function generateRawContent() {
            const cards = vocabularyByChapter[currentChapter];
            let content = "";
            
            for (let i = 0; i < cards.length; i++) {
                content += `${cards[i].english}    ${cards[i].french}\n\n`;
            }
            
            elements.rawContent.textContent = content;
        }
        
        // Fonction pour basculer le mode sombre
        function toggleDarkMode() {
            isDarkMode = !isDarkMode;
            document.body.classList.toggle('dark-mode', isDarkMode);
            elements.themeToggle.textContent = isDarkMode ? "Mode Clair" : "Mode Sombre";
            elements.themeToggle.classList.toggle('active', isDarkMode);
            updateCardColorAndSuccessRate();
        }
        
        // Fonction pour basculer le mode raw
        function toggleRawMode() {
            isRawMode = !isRawMode;
            elements.rawToggle.textContent = isRawMode ? "Mode Flash Cards" : "Mode Raw";
            elements.rawToggle.classList.toggle('active', isRawMode);
            
            // Si isRawMode est vrai, afficher le contenu brut et cacher la carte
        if (isRawMode) {
            elements.cardContainer.style.display = 'none';
            elements.rawContent.style.display = 'block';
            elements.controls.style.display = 'none';
            elements.validationContainer.style.display = 'none';
            generateRawContent();
        } else {
            elements.cardContainer.style.display = 'block';
            elements.rawContent.style.display = 'none';
            elements.controls.style.display = 'flex';
            elements.validationContainer.style.display = 'flex';
            updateCard();
        }
}

// Fonction pour mettre à jour l'affichage du meilleur score
function updateBestScoreDisplay() {
    const bestScore = bestScores[currentChapter] || 0;
    elements.bestScoreElement.textContent = bestScore;
}

// Fonction pour démarrer le timer
function startTimer() {
    if (!isTimerActive) return;
    
    clearInterval(timerInterval);
    startTime = new Date();
    
    timerInterval = setInterval(() => {
        const now = new Date();
        const diff = new Date(now - startTime);
        const minutes = String(diff.getUTCMinutes()).padStart(2, '0');
        const seconds = String(diff.getUTCSeconds()).padStart(2, '0');
        
        elements.timerElement.textContent = `${minutes}:${seconds}`;
    }, 1000);
}

// Fonction pour arrêter le timer
function stopTimer() {
    clearInterval(timerInterval);
    
    // Sauvegarder le meilleur temps si c'est le cas
    if (isTimerActive) {
        const now = new Date();
        const totalTime = now - startTime;
        
        if (!bestTimes[currentChapter] || totalTime < bestTimes[currentChapter]) {
            bestTimes[currentChapter] = totalTime;
            updateBestTimeDisplay();
        }
    }
}

// Fonction pour réinitialiser le timer
function resetTimer() {
    clearInterval(timerInterval);
    elements.timerElement.textContent = "00:00";
}

// Fonction pour mettre à jour l'affichage du meilleur temps
function updateBestTimeDisplay() {
    const bestTime = bestTimes[currentChapter];
    
    if (bestTime) {
        const diff = new Date(bestTime);
        const minutes = String(diff.getUTCMinutes()).padStart(2, '0');
        const seconds = String(diff.getUTCSeconds()).padStart(2, '0');
        
        elements.bestTimeElement.textContent = `${minutes}:${seconds}`;
    } else {
        elements.bestTimeElement.textContent = "-";
    }
}

// Gestionnaires d'événements
function initEventListeners() {
    // Changement de chapitre
    elements.chapterButtons.forEach(button => {
        button.addEventListener('click', () => {
            const chapter = parseInt(button.dataset.chapter);
            
            // Ne rien faire si on clique sur le chapitre actif
            if (chapter === currentChapter) return;
            
            // Désactiver le chapitre actuel et activer le nouveau
            elements.chapterButtons.forEach(btn => {
                btn.classList.toggle('active', parseInt(btn.dataset.chapter) === chapter);
            });
            
            // Changer le chapitre
            currentChapter = chapter;
            currentCardIndex = 0;
            cardHistory = [];
            
            // Réinitialiser le timer
            resetTimer();
            startTimer();
            
            // Mettre à jour le meilleur score
            updateBestScoreDisplay();
            
            // Mettre à jour le meilleur temps
            updateBestTimeDisplay();
            
            // Mettre à jour la carte ou le contenu raw
            if (isRawMode) {
                generateRawContent();
            } else {
                updateCard();
            }
        });
    });
    
    // Retourner la carte
    elements.card.addEventListener('click', () => {
        isTranslationVisible = !isTranslationVisible;
        elements.englishTranslation.style.display = isTranslationVisible ? 'block' : 'none';
    });
    
    // Bouton précédent
    elements.prevBtn.addEventListener('click', () => {
        if (cardHistory.length > 0) {
            currentCardIndex = cardHistory.pop();
            updateCard();
        }
    });
    
    // Bouton suivant
    elements.nextBtn.addEventListener('click', () => {
        if (currentCardIndex < vocabularyByChapter[currentChapter].length - 1) {
            cardHistory.push(currentCardIndex);
            currentCardIndex++;
            updateCard();
        }
    });
    
    // Bouton aléatoire
    elements.randomBtn.addEventListener('click', () => {
        const cards = vocabularyByChapter[currentChapter];
        const sortedIndices = getSortedCardsByPerformance();
        
        // Sélectionner principalement parmi les cartes avec le taux de succès le plus bas
        const selectionPool = sortedIndices.slice(0, Math.max(3, Math.ceil(sortedIndices.length * 0.3)));
        
        // Sélectionner une carte aléatoire du pool
        let newIndex;
        if (selectionPool.length > 0) {
            const randomPos = Math.floor(Math.random() * selectionPool.length);
            newIndex = selectionPool[randomPos];
        } else {
            // Fallback à la sélection complètement aléatoire
            do {
                newIndex = Math.floor(Math.random() * cards.length);
            } while (newIndex === currentCardIndex);
        }
        
        cardHistory.push(currentCardIndex);
        currentCardIndex = newIndex;
        updateCard();
    });
    
    // Validation de la traduction
    elements.validateBtn.addEventListener('click', validateTranslation);
    elements.translationInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            validateTranslation();
        }
    });
    
    // Basculer le mode sombre
    elements.themeToggle.addEventListener('click', toggleDarkMode);
    
    // Basculer le mode raw
    elements.rawToggle.addEventListener('click', toggleRawMode);
    
    // Boutons de sauvegarde et chargement
    elements.saveBtn.addEventListener('click', saveState);
    elements.loadBtn.addEventListener('click', () => {
        elements.loadInput.click();
    });
    elements.loadInput.addEventListener('change', loadState);
}

// Fonction de validation de traduction
function validateTranslation() {
    const userInput = elements.translationInput.value.trim().toLowerCase();
    const cards = vocabularyByChapter[currentChapter];
    const correctAnswer = cards[currentCardIndex].english.toLowerCase();
    
    // Vérifier la réponse
    const isCorrect = userInput === correctAnswer;
    
    // Mettre à jour la performance de la carte
    const cardKey = `${currentChapter}-${currentCardIndex}`;
    if (!cardPerformance[cardKey]) {
        cardPerformance[cardKey] = { attempts: 0, successes: 0 };
    }
    cardPerformance[cardKey].attempts++;
    
    if (isCorrect) {
        cardPerformance[cardKey].successes++;
        elements.validationResult.textContent = "Correct !";
        elements.validationResult.className = "validation-result correct";
        
        // Incrémenter le score
        currentScore++;
        elements.currentScoreElement.textContent = currentScore;
        
        // Mettre à jour le meilleur score
        if (!bestScores[currentChapter] || currentScore > bestScores[currentChapter]) {
            bestScores[currentChapter] = currentScore;
            elements.bestScoreElement.textContent = bestScores[currentChapter];
        }
    } else {
        elements.validationResult.textContent = `Incorrect. La réponse était : ${cards[currentCardIndex].english}`;
        elements.validationResult.className = "validation-result incorrect";
    }
    
    // Mettre à jour la couleur de la carte
    updateCardColorAndSuccessRate();
    
    // Passer automatiquement à la carte suivante après quelques secondes si la réponse est correcte
    if (isCorrect && currentCardIndex < cards.length - 1) {
        setTimeout(() => {
            cardHistory.push(currentCardIndex);
            currentCardIndex++;
            updateCard();
        }, 1500);
    }
}

// Initialisation
function init() {
    // Charger les données depuis le localStorage
    const savedData = localStorage.getItem('flashcardsData');
    if (savedData) {
        try {
            const data = JSON.parse(savedData);
            seenCards = new Set(data.seenCards || []);
            cardPerformance = data.cardPerformance || {};
            bestScores = data.bestScores || {};
            bestTimes = data.bestTimes || {};
            isDarkMode = data.isDarkMode || false;
            
            // Appliquer le mode sombre si nécessaire
            document.body.classList.toggle('dark-mode', isDarkMode);
            elements.themeToggle.textContent = isDarkMode ? "Mode Clair" : "Mode Sombre";
            elements.themeToggle.classList.toggle('active', isDarkMode);
        } catch (e) {
            console.error("Erreur lors du chargement des données:", e);
        }
    }
    
    // Initialiser les gestionnaires d'événements
    initEventListeners();
    
    // Initialiser l'affichage
    updateBestScoreDisplay();
    updateBestTimeDisplay();
    
    // Démarrer le timer
    startTimer();
    
    // Afficher la première carte
    if (isRawMode) {
        generateRawContent();
    } else {
        updateCard();
    }
    
    // Sauvegarder les données avant de quitter
    window.addEventListener('beforeunload', () => {
        localStorage.setItem('flashcardsData', JSON.stringify({
            seenCards: Array.from(seenCards),
            cardPerformance,
            bestScores,
            bestTimes,
            isDarkMode
        }));
    });
}

// Lancer l'initialisation
init();
</script>
</body>
</html>
