<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
  <title>Cartes M√©moire Avanc√©es</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet" />
  <style>
    :root{--easing:cubic-bezier(.2,.7,.2,1);--brand:#10b981;--brand-2:#06b6d4}
    .glassmorphism,.glassmorphism-menu{backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px)}
    .light-mode-card-neutral{background:rgba(255,255,255,.85);border:1px solid rgba(0,0,0,.05);color:#374151}
    .dark-mode-card-neutral{background:rgba(55,65,81,.7);border:1px solid rgba(255,255,255,.12);color:#f3f4f6}
    .glassmorphism-menu{border-right:1px solid;transition:background-color .3s,border-color .3s}
    body.light-mode .glassmorphism-menu{background:rgba(255,255,255,.9);border-color:rgba(0,0,0,.1)}
    body.dark-mode .glassmorphism-menu{background:rgba(17,24,39,.92);border-color:rgba(255,255,255,.1)}
    .menu-slide-in{transform:translateX(0%);transition:transform .3s ease-out}
    .menu-slide-out{transform:translateX(-100%);transition:transform .3s ease-in}
    #sidebar-menu{will-change:transform}
    html,body{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}
    :where(button,input,select){outline:none}
    :where(button,input,select):focus-visible{box-shadow:0 0 0 2px var(--brand),0 0 0 4px rgba(16,185,129,.25);border-color:transparent!important}
    button{transition:transform .15s var(--easing),opacity .2s;min-height:40px}
    button:hover{transform:translateY(-1px)}button:active{transform:translateY(0)}
    .menu-overlay{position:fixed;inset:0;background:rgba(0,0,0,.35);opacity:0;pointer-events:none;transition:opacity .2s var(--easing);z-index:30}
    body.menu-open .menu-overlay{opacity:1;pointer-events:auto}
    .chapter-button-active{background-color:#F59E0B;color:#fff!important;box-shadow:0 2px 8px rgba(0,0,0,.2);transform:translateY(-1px)}
    body.dark-mode .chapter-button-active{background-color:#FBBF24;color:#1f2937!important}
    body.light-mode .chapter-button-default{background-color:#fff;color:#374151;box-shadow:0 1px 3px rgba(0,0,0,.1)}
    body.dark-mode .chapter-button-default{background-color:#374151;color:#f3f4f6;box-shadow:0 1px 3px rgba(0,0,0,.3)}
    body{transition:background-color .5s,color .5s,background-image .5s;touch-action:pan-y}
    body.light-mode{background-color:#f3f4f6;color:#111827}
    body.dark-mode{background-color:#111827;color:#f9fafb}
    body.light-mode input[type="text"],body.light-mode select{background-color:#fff;color:#111827;border-color:#d1d5db}
    body.dark-mode input[type="text"],body.dark-mode select{background-color:#1f2937;color:#f9fafb;border-color:#4b5563}
    body.light-mode #burger-button{background-color:rgba(255,255,255,.85);color:#374151}
    body.dark-mode #burger-button{background-color:rgba(30,41,59,.85);color:#e5e7eb}
    body.light-mode .bg-white\/50{background-color:rgba(255,255,255,.8)}
    body.dark-mode .bg-white\/50{background-color:rgba(30,41,59,.8)}
    #progress-bar-fill{background-image:linear-gradient(90deg,var(--brand),var(--brand-2));box-shadow:0 0 12px rgba(16,185,129,.35)}
    @keyframes shakeX{10%,90%{transform:translateX(-1px)}20%,80%{transform:translateX(2px)}30%,50%,70%{transform:translateX(-3px)}40%,60%{transform:translateX(3px)}}
    .flash-error{animation:shakeX .4s ease-in-out}
    #input-bar{padding-bottom:calc(env(safe-area-inset-bottom,0px) + 8px)}
    .card-translation{color:#2563eb}body.dark-mode .card-translation{color:#60a5fa}
    #flashcard-container{transition: background-color .35s var(--easing), border-color .35s var(--easing), color .35s var(--easing)}
  </style>
</head>
<body class="flex flex-col items-center justify-start min-h-screen p-4 overflow-x-hidden pt-20 light-mode">
  <div id="animated-bg-elements" class="fixed top-0 left-0 w-full h-full pointer-events-none overflow-hidden"></div>

  <button id="burger-button" class="fixed top-4 left-4 z-30 p-2 backdrop-blur-sm rounded-md shadow-lg text-lg" aria-label="Ouvrir le menu" aria-controls="sidebar-menu" aria-expanded="false">‚ò∞</button>
  <div id="menu-overlay" class="menu-overlay" aria-hidden="true" tabindex="-1"></div>

  <div id="sidebar-menu" class="fixed top-0 left-0 h-full w-72 sm:w-80 glassmorphism-menu shadow-2xl p-6 z-40 menu-slide-out overflow-y-auto" role="dialog" aria-modal="true" aria-label="Menu" aria-hidden="true">
    <button id="close-menu-button" class="absolute top-4 right-4 text-xl p-1 hover:text-red-500 transition-colors" aria-label="Fermer le menu">‚úï</button>
    <h2 class="text-2xl font-semibold mb-6">Menu</h2>

    <div class="mb-4">
      <input type="text" id="search-bar" placeholder="Rechercher une carte..." class="w-full p-2 border rounded-md focus:ring-2 focus:ring-emerald-500 outline-none text-sm sm:text-base" autocapitalize="off" autocorrect="off" spellcheck="false">
      <div id="search-results-container" class="mt-2 max-h-32 overflow-y-auto text-sm"></div>
    </div>

    <div class="mb-4">
      <h3 id="chapters-title" class="text-lg font-medium mb-2">Chapitres</h3>
      <div id="menu-chapters" class="space-y-2"></div>
    </div>

    <div class="mb-4 flex items-center justify-between">
      <label id="dark-mode-label" class="text-lg">Mode Sombre</label>
      <button id="dark-mode-toggle" class="p-2 rounded-md" aria-label="Basculer le mode sombre" aria-pressed="false">üåô</button>
    </div>

    <div class="mb-4">
      <h3 id="themes-title" class="text-lg font-medium mb-2">Th√®mes</h3>
      <select id="theme-selector" class="w-full p-2 border rounded-md mb-2">
        <option value="default">D√©faut</option>
        <option value="pastel">Pastel (√âvolutif)</option>
      </select>
    </div>

    <div>
      <h3 id="reset-title" class="text-lg font-medium mb-2">R√©initialiser</h3>
      <select id="reset-options" class="w-full p-2 border rounded-md mb-2"></select>
      <button id="reset-data-button" class="w-full p-2 bg-red-500 hover:bg-red-600 text-white rounded-md transition-colors">‚Üª R√©initialiser S√©lection</button>
    </div>

    <div class="mt-6">
      <button id="reverse-mode-button" class="w-full p-2 bg-purple-500 hover:bg-purple-600 text-white rounded-md transition-colors">‚áÑ Inverser FR ‚Üî EN</button>
    </div>

    <div id="stats-section" class="mt-8 border-t border-gray-200 dark:border-gray-700 pt-4 text-sm">
      <h3 class="text-lg font-medium mb-2">Statistiques</h3>
      <div id="stats-content" class="space-y-2 mb-3"></div>
      <div id="stats-chart" class="w-full">
        <div class="flex items-center justify-between mb-1">
          <span id="chart-title" class="text-gray-600 dark:text-gray-300">√âvolution (14j)</span>
          <span id="chart-legend" class="text-xs text-gray-500"></span>
        </div>
        <svg id="sparkline" width="260" height="70" class="w-full h-[70px]">
          <defs>
            <linearGradient id="grad" x1="0" x2="0" y1="0" y2="1">
              <stop offset="0%" stop-color="#10b981" stop-opacity="0.35"/>
              <stop offset="100%" stop-color="#10b981" stop-opacity="0"/>
            </linearGradient>
          </defs>
          <rect x="0" y="0" width="100%" height="100%" fill="none"/>
          <path id="sparkline-path" d="" stroke="#10b981" stroke-width="2" fill="none"/>
          <path id="sparkline-fill" d="" fill="url(#grad)" opacity="0.8"/>
          <circle id="sparkline-last" r="3" fill="#06b6d4" cx="0" cy="0" />
        </svg>
      </div>
    </div>
  </div>

  <div class="w-full max-w-2xl mx-auto flex flex-col items-center space-y-3 sm:space-y-4 relative z-10">
    <div id="current-chapter-label" class="text-[11px] sm:text-xs uppercase tracking-wide text-amber-600 dark:text-amber-600 select-none -mb-1"></div>

    <div class="flex items-center">
      <div id="timer" class="font-mono text-xl sm:text-2xl p-2 bg-white/50 backdrop-blur-sm rounded-md shadow">00:00:00</div>
      <div id="streak-badge" class="ml-2 px-2 py-1 text-xs sm:text-sm rounded-md select-none bg-gray-100 text-gray-600 dark:bg-gray-800/50 dark:text-gray-300" aria-live="polite">üî• 0</div>
    </div>

    <div class="w-full p-1 bg-white/50 backdrop-blur-sm rounded-md shadow">
      <div class="flex justify-between text-xs sm:text-sm mb-1 px-1">
        <span id="progress-text">Cycle: 0/0</span>
        <span id="progress-percentage"></span>
      </div>
      <div class="w-full bg-gray-300 rounded-full h-2.5 sm:h-3">
        <div id="progress-bar-fill" class="h-2.5 sm:h-3 rounded-full transition-all duration-300 ease-out" style="width:0%"></div>
      </div>
    </div>

    <div id="flashcard-container" class="w-full min-h-[20rem] sm:min-h-[24rem] flex-grow p-6 rounded-xl shadow-xl flex flex-col justify-between items-center text-center cursor-pointer glassmorphism">
      <div class="w-full flex justify-end items-center">
        <span id="card-score" class="text-lg sm:text-xl font-bold px-3 py-1 rounded-lg bg-white/40 dark:bg-black/20" title="Score saisie pr√©c√©dente">--%</span>
      </div>
      <div id="card-content" class="flex-grow flex flex-col justify-center items-center">
        <p id="card-french-word" class="text-2xl sm:text-3xl md:text-4xl font-semibold"></p>
        <p id="card-english-word" class="text-xl sm:text-2xl md:text-3xl font-medium card-translation hidden"></p>
      </div>
      <div class="h-6"></div>
    </div>

    <div id="message-area" class="w-full text-center h-6 text-sm font-medium" role="status" aria-live="polite"></div>

    <div id="input-bar" class="w-full flex flex-col sm:flex-row items-center gap-2 p-3 bg-white/50 backdrop-blur-sm rounded-lg shadow">
      <input type="text" id="answer-input" placeholder="Votre r√©ponse en anglais..." class="flex-grow p-3 border rounded-md focus:ring-2 focus:ring-emerald-500 outline-none text-base" autocorrect="off" autocapitalize="off" spellcheck="false">
      <button id="submit-answer-button" class="w-full sm:w-auto px-6 py-3 bg-emerald-500 hover:bg-emerald-600 text-white font-semibold rounded-md transition-colors text-sm sm:text-base">Valider</button>
    </div>

    <div id="grade-bar" class="w-full grid grid-cols-2 sm:flex sm:flex-row gap-2 hidden">
      <button id="grade-again"  data-grade="1" class="flex-1 px-4 py-2 rounded-md bg-red-500/90 hover:bg-red-600 text-white font-semibold">Encore</button>
      <button id="grade-hard"   data-grade="2" class="flex-1 px-4 py-2 rounded-md bg-amber-500/90 hover:bg-amber-600 text-white font-semibold">Difficile</button>
      <button id="grade-good"   data-grade="3" class="flex-1 px-4 py-2 rounded-md bg-emerald-500/90 hover:bg-emerald-600 text-white font-semibold">Bien</button>
      <button id="grade-easy"   data-grade="4" class="flex-1 px-4 py-2 rounded-md bg-sky-500/90 hover:bg-sky-600 text-white font-semibold">Facile</button>
    </div>
  </div>

  <script>
    // Cat√©gories d√©clar√©es (pour supporter ${...} dans les donn√©es)
    const CD="Democracy", CG="Genetics", CI="Immigration", CIT="Relations internationales", CU="Travail", CR="Crime";

    // Place ici TON GROS DATASET (tu peux garder ${CD}, ${CG}, ${CI}, ${CIT}, ${CU})
    const cardsRaw = `
0|monarchie|monarchy|${CD}
1|monarque de droit divin|a monarch by divine right|${CD}
2|souverain|sovereign|${CD}
3|aristocratie|aristocracy|${CD}
4|oligarchie|oligarchy|${CD}
5|dictateur|a dictator|${CD}
6|dictature|dictatorship|${CD}
7|autoritaire|authoritarian|${CD}
8|autoritarisme|authoritarianism|${CD}
9|totalitaire|totalitarian|${CD}
10|totalitarisme|totalitarianism|${CD}
11|homme fort|a strongman|${CD}
12|tyran|a tyrant, an autocrat|${CD}
13|despote|a despot|${CD}
14|despote √©clair√©|an enlightened despot|${CD}
15|junte militaire|a military junta|${CD}
16|coup d'√âtat|a coup, a coup d'√©tat|${CD}
17|gouvernement autoritaire|a regime|${CD}
18|r√©gime de Vichy / de Pinochet|the Vichy / Pinochet regime|${CD}
19|r√©gime r√©pressif|a repressive regime|${CD}
20|r√©gime politique|a political system|${CD}
21|se d√©mocratiser|to become more democratic|${CD}
22|prendre le pouvoir|to take, seize power|${CD}
23|arriver au pouvoir|to come to power|${CD}
24|arriver au pouvoir (d√©mocratiquement)|to come into office|${CD}
25|√™tre au pouvoir|to be in power|${CD}
26|rester au pouvoir|to remain, stay in power|${CD}
27|s'accrocher au pouvoir|to cling to power|${CD}
28|bonne gouvernance|good governance|${CD}
29|mal administrer, mal g√©rer|to misrule, mismanage|${CD}
30|mauvaise administration|misrule|${CD}
31|mauvaise gestion|mismanagement|${CD}
32|tenir un dirigeant pour responsable|to hold a leader to account|${CD}
33|√™tre responsable devant les √©lecteurs|to be accountable to the electorate|${CD}
34|responsabilit√©|accountability|${CD}
35|corruption|corruption, sleaze, bribery|${CD}
36|corrompu|corrupt|${CD}
37|pot-de-vin|a bribe|${CD}
38|acheter, soudoyer qn|to bribe sb|${CD}
39|√©tat de droit, r√®gne de la loi|the rule of law|${CD}
40|multipartisme|multi-party system|${CD}
41|syst√®me de parti unique|single-party system|${CD}
42|√©lections libres et r√©guli√®res|free and fair elections|${CD}
43|fraude √©lectorale|vote rigging, ballot rigging, electoral fraud|${CD}
44|l'√©lection √©tait truqu√©e|the election was rigged|${CD}
45|opposant politique|a political opponent|${CD}
46|dissident|a dissident|${CD}
47|b√¢illonner / museler la presse / l'opposition|to gag / muzzle the press / the opposition|${CD}
48|d√©clarer l'√©tat d'urgence|to declare a state of emergency|${CD}
49|bafouer la constitution|to trample the constitution|${CD}
50|censurer|to censor|${CD}
51|censure|censorship|${CD}
52|bloquer / restreindre l'acc√®s √† internet|to block / restrict internet access|${CD}
53|contourner la censure|to circumvent, bypass censorship|${CD}
54|droits de l'homme|human rights|${CD}
55|atteintes aux droits de l'homme|human rights abuses, violations|${CD}
56|crime contre l'humanit√©|a crime against humanity|${CD}
57|devoir d'ing√©rence|the duty to interfere, to intervene|${CD}
58|association de d√©fense des droits de l'homme|human Rights lobby|${CD}
59|pass√© de la Chine en mati√®re de droits de l'homme|China's human rights record|${CD}
60|m√©contentement, malaise|discontent|${CD}
61|provoquer des troubles|to spark unrest|${CD}
62|agitation|turmoil|${CD}
63|bouleversement|an upheaval|${CD}
64|fomenter des troubles|to stir up trouble|${CD}
65|insurg√©|an insurgent|${CD}
66|insurrection|an insurgency|${CD}
67|manifestation|a demonstration, a protest march|${CD}
68|manifestant|a demonstrator, a protester|${CD}
69|organiser / participer √† un rassemblement|to hold / attend a rally|${CD}
70|√©meute|a riot|${CD}
71|√©meutier, casseur|a rioter|${CD}
72|des √©meutes ont √©clat√©|riots broke out|${CD}
73|CRS|anti-riot police|${CD}
74|cocktail Molotov|a petrol bomb, a Molotov cocktail|${CD}
75|gaz lacrymog√®ne|tear gas|${CD}
76|heurt, affrontement|a clash|${CD}
77|√©chauffour√©e|a skirmish|${CD}
78|complot|a plot|${CD}
79|comploteur|a plotter|${CD}
80|se r√©volter|to revolt|${CD}
81|se rebeller|to rebel|${CD}
82|rebelle|a rebel|${CD}
83|r√©bellion, r√©volte|a rebellion|${CD}
84|d√©jouer les autorit√©s|to defy the authorities|${CD}
85|soul√®vement|an uprising|${CD}
86|se soulever contre|to rise up against|${CD}
87|renverser un dictateur|to overthrow, to topple a dictator|${CD}
88|√©vincer un dictateur|to oust a dictator|${CD}
89|renversement d'un dictateur|the overthrow of a dictator|${CD}
90|d√©poser un dirigeant|to depose a ruler|${CD}
91|s'effondrer|to collapse|${CD}
92|restaurer la d√©mocratie|to restore democracy|${CD}
93|chute d'un gouvernement|the downfall of a government|${CD}
94|r√©pression brutale|ruthless repression|${CD}
95|r√©primer une r√©bellion|to put down, to suppress a rebellion|${CD}
96|r√©primer, √©touffer la contestation|to quell the protests|${CD}
97|mesures de r√©pression|crackdown, clampdown|${CD}
98|mettre les gens en prison|to send people to prison|${CD}
99|passer qn √† tabac|to beat sb up|${CD}
100|g√®ne|a gene|${CG}
101|cellule|a cell|${CG}
102|cellules-souches|stem cells|${CG}
103|recherche sur les cellules souches|stem-cell research|${CG}
104|g√©nome humain|the human genome|${CG}
105|cartographie du g√©nome|genome mapping|${CG}
106|carte g√©n√©tique|gene map, genetic map|${CG}
107|s√©quence g√©n√©tique|gene sequence|${CG}
108|s√©quen√ßage|sequencing|${CG}
109|√©pissage du g√®ne|gene splicing|${CG}
110|patrimoine h√©r√©ditaire|gene pool|${CG}
111|g√©n√©ticien|a geneticist|${CG}
112|eug√©nisme|eugenics|${CG}
113|eug√©niste, partisan de l'eug√©nisme|a eugenicist|${CG}
114|ADN|DNA|${CG}
115|test g√©n√©tique|a DNA test|${CG}
116|empreinte g√©n√©tique|a DNA print, genetic print|${CG}
117|analyse ADN|DNA analysis|${CG}
118|pr√©l√®vement d'ADN|a DNA sample|${CG}
119|profil g√©n√©tique|genetic make-up, genetic profile|${CG}
120|analyse de l'empreinte g√©n√©tique|genetic profiling, DNA fingerprinting|${CG}
121|d√©pistage g√©n√©tique|genetic screening|${CG}
122|subir un pr√©l√®vement d'ADN|to be DNA-swabbed|${CG}
123|manipulations g√©n√©tiques, g√©nie g√©n√©tique|genetic engineering|${CG}
124|transg√©nique|transgenic|${CG}
125|organisme g√©n√©tiquement modifi√©|a genetically modified organism|${CG}
126|OGM|GMOs|${CG}
127|aliments contenant des OGM|GM food|${CG}
128|pommes de terres g√©n√©tiquement modifi√©es|GM potatoes|${CG}
129|produits transg√©niques|biotech products|${CG}
130|semence, graines|seed|${CG}
131|soja|soyabeans|${CG}
132|colza|rapeseed|${CG}
133|ma√Øs|maize (GB), corn (US)|${CG}
134|bl√©|wheat|${CG}
135|culture, r√©colte|a crop|${CG}
136|essais sur le terrain|field trials, crop trials|${CG}
137|culture OGM|a GM crop|${CG}
138|rendement|yield|${CG}
139|fili√®re agroalimentaire|agribusiness|${CG}
140|augmenter, am√©liorer les rendements|to improve yields|${CG}
141|r√©sistant aux maladies|resistant to disease|${CG}
142|insecticide / pesticide / herbicide|insecticide / pesticide / herbicide|${CG}
143|polliniser|to pollinate|${CG}
144|pollinisation crois√©e|cross-pollination|${CG}
145|contaminer|to contaminate|${CG}
146|contamination|contamination|${CG}
147|maladie g√©n√©tique|a genetic disease|${CG}
148|g√®ne d√©fectueux|a faulty gene|${CG}
149|g√®ne manquant|a missing gene|${CG}
150|h√©r√©ditaire|hereditary|${CG}
151|chromosome X / Y|an X / Y chromosome|${CG}
152|clonage|cloning|${CG}
153|conseil g√©n√©tique|genetic counselling|${CG}
154|entreprise pharmaceutique|a pharmaceutical company|${CG}
155|th√©rapie g√©nique|gene therapy|${CG}
156|traitement g√©nique|genetic treatment|${CG}
157|√† des fins th√©rapeutiques|for therapeutic purposes|${CG}
158|agriculture au service de la m√©decine|pharming|${CG}
159|jouer √† l'apprenti-sorcier|to play God|${CG}
160|toucher √† la nature|to tamper with nature|${CG}
161|principe de pr√©caution|the precautionary principle, the safety-first principle|${CG}
162|√©tiquette|a label|${CG}
163|√©tiquetter|to label|${CG}
164|√©tiquetage|labelling|${CG}
165|avertir|to warn|${CG}
166|avertissement|a warning|${CG}
167|dont l'origine peut √™tre √©tablie|traceable|${CG}
168|tra√ßabilit√©|traceability|${CG}
169|effets √† long terme|long-term effects|${CG}
170|cha√Æne alimentaire|the food chain|${CG}
171|s√©curit√© alimentaire|food security|${CG}
172|lobby OGM|the pro-GM lobby|${CG}
173|militants contre les OGM|anti-GM activists|${CG}
174|campagne contre les OGM|an anti-GM campaign|${CG}
175|√©tranger|a foreigner|${CI}
176|inconnu|a stranger|${CI}
177|nationalit√©|nationality|${CI}
178|ressortissant √©tranger|a foreign national|${CI}
179|personnes de nationalit√© fran√ßaise|French citizens|${CI}
180|√©migrer en Nouvelle-Z√©lande|to emigrate to New Zealand|${CI}
181|immigrer en France|to immigrate to France|${CI}
182|vague d'immigration|a wave of immigration|${CI}
183|immigration √† grande √©chelle / de masse|large-scale / mass immigration|${CI}
184|exode|an exodus|${CI}
185|nouvel arrivant|a newcomer|${CI}
186|pays natal, pays d'origine|native country, home country|${CI}
187|patrie|homeland|${CI}
188|pays d'accueil|a host country|${CI}
189|pays d'adoption|an adoptive country, a country of adoption|${CI}
190|accueillir|to welcome|${CI}
191|accueillant|welcoming|${CI}
192|politique migratoire|immigration policy|${CI}
193|immigration choisie|selective immigration, controlled immigration|${CI}
194|flux migratoires|migration flows|${CI}
195|passager clandestin|a stowaway|${CI}
196|immigration clandestine, irr√©guli√®re|illegal immigration|${CI}
197|immigration sauvage|uncontrolled immigration|${CI}
198|immigrant clandestin, sans-papiers|an illegal immigrant, an illegal alien, an undocumented alien|${CI}
199|il est en situation irr√©guli√®re|his papers are not in order|${CI}
200|fronti√®re|a border, a frontier|${CI}
201|fermer ses fronti√®res|to close one's borders|${CI}
202|contr√¥les aux fronti√®res|border controls|${CI}
203|contr√¥les d'identit√©|identity checks|${CI}
204|centre de r√©tention (administrative)|a holding centre, a detention facility|${CI}
205|passeport|a passport|${CI}
206|carte d'identit√©|an identity card|${CI}
207|visa|a visa|${CI}
208|r√©fugi√©|a refugee|${CI}
209|personne d√©plac√©e|a displaced person|${CI}
210|apatride|a stateless person|${CI}
211|se r√©fugier|to take refuge, take shelter|${CI}
212|demander l'asile politique|to seek political asylum|${CI}
213|demandeur d'asile|an asylum-seeker|${CI}
214|fuir la pers√©cution / la mis√®re|to flee persecution / destitution|${CI}
215|√©chapper √† la pauvret√©|to escape poverty|${CI}
216|chercher de meilleures conditions de vie|to be in search of better living conditions|${CI}
217|trafic des √™tres humains|human trafficking|${CI}
218|contrebandier, passeur|a smuggler|${CI}
219|passeurs d'immigrants clandestins|people-smugglers|${CI}
220|r√©seau de passeurs|a smuggling ring|${CI}
221|faux passeport|a fake passport|${CI}
222|reconduire qn √† la fronti√®re|to escort sb back to the border|${CI}
223|renvoyer un immigrant dans son pays d'origine|to send an immigrant back to his native country|${CI}
224|expulser qn|to deport sb|${CI}
225|√™tre refoul√© √† la fronti√®re|to be turned away at the border|${CI}
226|√™tre expuls√©|to be ordered out of the country|${CI}
227|s'exiler|to go into exile|${CI}
228|exil√©|an exile|${CI}
229|exiler, bannir qn|to exile, banish sb|${CI}
230|s'expatrier|to expatriate oneself|${CI}
231|expatri√©|an expatriate, an expat|${CI}
232|passer √† l'Ouest / √† l'ennemi|to defect to the West / to the enemy|${CI}
233|fuite des cerveaux / afflux des cerveaux|brain drain / brain gain|${CI}
234|partir de rien|to start from scratch|${CI}
235|travail au noir|moonlighting|${CI}
236|atelier clandestin|a sweatshop|${CI}
237|exploiter les travailleurs immigr√©s|to exploit migrant workers|${CI}
238|permis de travail, carte de travail|a work permit|${CI}
239|permis de s√©jour, carte de s√©jour|a residence permit, a resident permit|${CI}
240|travailleur migrant|a migrant worker|${CI}
241|travailleur invit√© (disposant d'un visa temporaire)|a guest worker|${CI}
242|s'int√©grer|to become integrated|${CI}
243|bien s'int√©grer dans une soci√©t√©|to integrate well into a society|${CI}
244|insertion sociale|social integration|${CI}
245|r√©gulariser la situation des clandestins|to regularise the status of illegal immigrants|${CI}
246|r√©gularisation|regularisation|${CI}
247|se faire naturaliser britannique, √™tre naturalis√© britannique, obtenir la nationalit√© britannique|to be granted British citizenship, to become a British citizen|${CI}
248|quota|a quota|${CI}
249|regroupement familial|family reunion, reunification|${CI}
250|qn qui abuse du syst√®me des prestations sociales|a benefit cheat|${CI}
251|fraude aux prestations sociales|benefit fraud|${CI}
252|parasite|a freeloader|${CI}
253|mariage blanc|a sham marriage, a marriage of convenience|${CI}
254|inonder|to flood|${CI}
255|√™tre envahi par les √©trangers|to be swamped with foreigners|${CI}
256|arriv√©e massive, afflux de travailleurs|the influx of workers|${CI}
257|endiguer l'afflux d'immigr√©s|to stem the flow of immigrants|${CI}
258|limiter / freiner l'immigration|to restrict / curb immigration|${CI}
259|parti d'extr√™me-droite|a far-right party|${CI}
260|faire fuir les immigrants|to scare immigrants away|${CI}
261|emp√™cher les ind√©sirables d'entrer|to keep out undesirables|${CI}
262|x√©nophobie|xenophobia|${CI}
263|x√©nophobe|xenophobic|${CI}
264|avoir un grand-p√®re n√© √† l'√©tranger|to have a foreign-born grandfather|${CI}
265|jeunes gens d'origine asiatique / portugaise|young men of Asian / Portuguese descent|${CI}
266|Fran√ßais de naissance|a native of France|${CI}
267|New Yorkais de souche|a born and bred New Yorker|${CI}
268|il est fran√ßais de souche|he's of French origin, of French extraction|${CI}
269|Maghreb|North Africa|${CI}
270|Maghr√©bins|North Africans|${CI}
271|pakistanais / du Bangladesh|Pakistani / Bangladeshi|${CI}
272|hispanophone / parlant le Hindi|Spanish-speaking / Hindi-speaking|${CI}
273|diaspora|diaspora|${CI}
274|affaires √©trang√®res|foreign affairs|${CIT}
275|relations ext√©rieures|foreign relations|${CIT}
276|communaut√© internationale|the international community|${CIT}
277|probl√®me mondial, plan√©taire|a global issue|${CIT}
278|√âtat souverain|a sovereign state|${CIT}
279|souverainet√©|sovereignty|${CIT}
280|√âtat-nation|a nation-state|${CIT}
281|fronti√®re|a border, a frontier|${CIT}
282|droit international|international law|${CIT}
283|g√©opolitique|geopolitics|${CIT}
284|sc√®ne internationale|the international stage, the international scene, the world stage|${CIT}
285|jouer un r√¥le dans qch|to play a role, a part in sth|${CIT}
286|occidental / oriental|western / eastern|${CIT}
287|politique √©trang√®re, ext√©rieure|foreign policy|${CIT}
288|ambassadeur|an ambassador|${CIT}
289|ambassade|an embassy|${CIT}
290|attach√© culturel / commercial / militaire|a cultural / commercial / military attach√©|${CIT}
291|envoy√©, √©missaire|an envoy, an emissary|${CIT}
292|diplomate|a diplomat|${CIT}
293|diplomatie|diplomacy|${CIT}
294|rompre / reprendre les relations|to break off / resume diplomatic relations|${CIT}
295|relations tendues|tense, strained relations|${CIT}
296|r√©chauffement|a thaw|${CIT}
297|refroidissement|a chill, a cooling off|${CIT}
298|rappeler un ambassadeur|to recall an ambassador|${CIT}
299|normaliser les relations|to normalize relations|${CIT}
300|grande puissance|a great power|${CIT}
301|superpuissance / hyperpuissance|a superpower / a hyperpower|${CIT}
302|h√©g√©monie|hegemony|${CIT}
303|imp√©rialisme|imperialism|${CIT}
304|imp√©rialiste|imperialistic|${CIT}
305|expansionisme|expansionism|${CIT}
306|unilat√©ralisme / multilat√©ralisme|unilateralism / multilateralism|${CIT}
307|bilat√©ral / multilat√©ral|bilateral / multilateral|${CIT}
308|bipolaire / multipolaire|bipolar / multipolar|${CIT}
309|bloc|a bloc|${CIT}
310|√©quilibre des forces|balance of power|${CIT}
311|syst√®me onusien|the UN system|${CIT}
312|√âtat-membre, pays membre|a member state|${CIT}
313|membre fondateur|a founding member, founder member|${CIT}
314|cotisation|a contribution|${CIT}
315|discuter / voter une r√©solution|to debate / to pass a resolution|${CIT}
316|appliquer une r√©solution|to implement, enforce a resolution|${CIT}
317|autoriser l'usage de la force|to authorize the use of force|${CIT}
318|embargo|an embargo|${CIT}
319|majorit√© des deux-tiers|a two-thirds majority|${CIT}
320|maintenir la paix|to maintain peace|${CIT}
321|op√©ration de maintien de la paix|a peace-keeping operation|${CIT}
322|soldat de la paix|a peacekeeper|${CIT}
323|casque bleu|a blue helmet|${CIT}
324|devoir d'ing√©rence|the duty to interfere, to intervene|${CIT}
325|intervention militaire|military intervention|${CIT}
326|OTAN|NATO, the North Atlantic Treaty Organization|${CIT}
327|n√©gocier|to negotiate|${CIT}
328|n√©gociations, pourparlers, discussions|negotiations, talks|${CIT}
329|table des n√©gociations|negotiating table|${CIT}
330|table ronde|a round table|${CIT}
331|faire une d√©claration|to make, issue, deliver a statement|${CIT}
332|communiqu√©|a communiqu√©|${CIT}
333|sous l'√©gide de|under the aegis of|${CIT}
334|r√©union au sommet, sommet|a summit (meeting)|${CIT}
335|porte-parole|a spokesman, spokeswoman, spokesperson|${CIT}
336|homologue|a counterpart, an opposite number|${CIT}
337|impasse|a stalemate, a deadlock, a standoff, an impasse|${CIT}
338|aboutir √† une impasse|to reach a stalemate|${CIT}
339|sortir d'une impasse|to break a stalemate|${CIT}
340|ultimatum|an ultimatum|${CIT}
341|m√©diateur|a mediator|${CIT}
342|n√©gocier un accord|to broker an agreement|${CIT}
343|surmonter un obstacle|to overcome an obstacle|${CIT}
344|volont√© politique|political will|${CIT}
345|compromis|a compromise|${CIT}
346|transiger|to compromise|${CIT}
347|faire une concession|to make a concession|${CIT}
348|s'engager √† faire qch|to commit oneself to doing sth|${CIT}
349|promettre de faire, s'engager √† faire qch|to pledge to do sth|${CIT}
350|signer / ratifier un trait√©|to sign / ratify a treaty|${CIT}
351|protocole|a protocol|${CIT}
352|accord|an agreement, an accord|${CIT}
353|conclure un accord|to reach a settlement|${CIT}
354|stipuler|to stipulate|${CIT}
355|parvenir √† un consensus|to reach a consensus|${CIT}
356|interdire|to prohibit, to ban|${CIT}
357|mettre son v√©to √† une d√©cision|to veto a decision|${CIT}
358|Union Europ√©enne, l'UE|the European Union, the EU|${CIT}
359|directive europ√©enne|an EU directive|${CIT}
360|adh√©rer √† l'UE|to join the EU|${CIT}
361|demander son adh√©sion √† l'UE|to apply to join the EU, to apply for EU membership|${CIT}
362|pourparlers d'adh√©sion|membership negotiations|${CIT}
363|organisation non-gouvernementale, ONG|a non-governmental organization, an NGO|${CIT}
364|droits de l'homme|human rights|${CIT}
365|violations des droits de l'homme|human rights abuses, violations|${CIT}
366|faire respecter un principe|to uphold a principle|${CIT}
367|pass√© de la Chine en mati√®re de droits de l'homme|China's human Rights record|${CIT}
368|d√©colonisation|decolonization|${CIT}
369|obtenir l'ind√©pendance, devenir ind√©pendant|to achieve, gain, attain independence|${CIT}
370|ancienne colonie|a former colony|${CIT}
371|puissance coloniale|a colonial power|${CIT}
372|du travail|work|${CU}
373|un travail, un emploi|a job|${CU}
374|une profession, une activit√© professionnelle|an occupation|${CU}
375|les professions lib√©rales|the professions|${CU}
376|une carri√®re|a career|${CU}
377|le monde du travail|the world of work|${CU}
378|√™tre au travail|to be at work|${CU}
379|le lieu de travail|the workplace|${CU}
380|travailler chez soi|to work from home|${CU}
381|travailler √† temps partiel OU √† mi-temps|to work part time|${CU}
382|travailler √† plein temps|to work full time|${CU}
383|la classe ouvri√®re|the working class|${CU}
384|la population active|the working population|${CU}
385|la vie active|the working life|${CU}
386|conditions de travail|working conditions|${CU}
387|atelier|a workshop|${CU}
388|usine|a factory, a plant|${CU}
389|atelier clandestin (o√π la main d'≈ìuvre est exploit√©e)|a sweatshop|${CU}
390|travailler beaucoup|to work hard|${CU}
391|√™tre travailleur|to be hard-working|${CU}
392|travailleur acharn√©, bourreau de travail|a hard worker, a workaholic|${CU}
393|permis de travail|a work permit|${CU}
394|√™tre / ne pas √™tre de service OU de garde|to be on duty / off duty|${CU}
395|ch√¥mage|unemployment, joblessness|${CU}
396|√™tre au ch√¥mage|to be unemployed, jobless, out of work|${CU}
397|taux de ch√¥mage|unemployment rate, jobless rate|${CU}
398|ch√¥meurs|the unemployed, the jobless|${CU}
399|ch√¥mage de longue dur√©e|long-term unemployment|${CU}
400|ch√¥mage des jeunes|youth unemployment|${CU}
401|allocation ch√¥mage|unemployment benefit|${CU}
402|toucher le ch√¥mage|to be on the dole (GB), to be on welfare (US)|${CU}
403|march√© du travail, de l'emploi|job market, labour market|${CU}
404|contrat √† dur√©e d√©termin√©e, CDD|a fixed-term contract|${CU}
405|contrat √† dur√©e ind√©termin√©e, CDI|an open-ended contract|${CU}
406|flexibilit√© de l'emploi|job flexibility|${CU}
407|avoir des horaires flexibles|work flexitime (GB) flextime (US)|${CU}
408|s√©curit√© / pr√©carit√© de l'emploi|job security / insecurity|${CU}
409|stage|an internship, a work placement|${CU}
410|stagiaire|an intern, a trainee|${CU}
411|travailleur pr√©caire|a casual worker|${CU}
412|petit boulot|an odd job, a casual job|${CU}
413|boulot d'√©t√©|a summer job|${CU}
414|int√©rimaire|a temporary worker|${CU}
415|faire de l'int√©rim|to temp, to work as a temp|${CU}
416|employer|to employ|${CU}
417|employeur|an employer|${CU}
418|employ√©|an employee|${CU}
419|changer de travail|to change jobs|${CU}
420|embaucher un travailleur|to hire, to take on a worker|${CU}
421|recruter|to recruit|${CU}
422|p√©riode d'essai|a trial period|${CU}
423|poste|a post, a position|${CU}
424|nommer qn √† un poste|to appoint sb to a post|${CU}
425|muter qn|to transfer sb|${CU}
426|poste √† responsabilit√©(s)|a responsible job|${CU}
427|emploi subalterne|a menial job|${CU}
428|demandeur d'emploi|a job-seeker|${CU}
429|agence P√¥le emploi|a Jobcenter (GB)|${CU}
430|CV, curriculum vitae|a curriculum vitae, a CV, a r√©sum√© (US)|${CU}
431|exp√©rience professionnelle|work experience|${CU}
432|comp√©tences|skills|${CU}
433|√™tre candidat √† un emploi, faire une demande d'emploi|to apply for a job|${CU}
434|candidat √† un poste|an applicant|${CU}
435|entretien d'embauche|a job interview|${CU}
436|offre d'emploi|a job offer, a job vacancy, a job opportunity|${CU}
437|travail OU main d'≈ìuvre|labour|${CU}
438|main d'≈ìuvre f√©minine / travail des enfants|female labour / child labour|${CU}
439|normes en mati√®re d'emploi|labour standards|${CU}
440|main d'≈ìuvre|manpower, workforce|${CU}
441|personnel|staff, personnel|${CU}
442|coll√®gue, camarade de travail|a colleague, a co-worker, a workmate|${CU}
443|ressources humaines|human resources|${CU}
444|travail qualifi√© / peu qualifi√© / non qualifi√©|a skilled / low-skilled / an unskilled job|${CU}
445|ouvrier sp√©cialis√©, OS|an unskilled worker|${CU}
446|ouvrier|a blue-collar worker|${CU}
447|employ√© de bureau|a white-collar worker|${CU}
448|fonctionnaire|a state employee, a civil servant|${CU}
449|salari√© du secteur public|a public-sector employee|${CU}
450|haut fonctionnaire|a high-ranking civil servant|${CU}
451|√™tre ind√©pendant, travailler √† son compte|to be self-employed|${CU}
452|travailleurs ind√©pendants|the self-employed|${CU}
453|honoraires|fees|${CU}
454|paie, paye|pay|${CU}
455|salaire|salary|${CU}
456|salaire (d'ouvrier)|wages|${CU}
457|gagner de l'argent|to earn money, to make money|${CU}
458|gagner sa vie|to earn a living, to earn one's living, to make a living|${CU}
459|Que fait-il dans la vie ?|What does he do for a living?|${CU}
460|travail mal pay√©|a badly-paid job, a low-paid job|${CU}
461|travail bien pay√©|a well-paid job, a highly-paid job|${CU}
462|salari√©|a wage-earner|${CU}
463|prime|a bonus|${CU}
464|avantage (en nature), avantage annexe|a perk, a fringe benefit|${CU}
465|voiture de fonction|a company car|${CU}
466|salaire au rendement|performance-related pay|${CU}
467|√™tre employ√© par une entreprise|to be on a company's payroll|${CU}
468|vacances|holiday, vacation (US)|${CU}
469|cong√©s pay√©s|paid holiday|${CU}
470|√™tre en vacances|to be on holiday|${CU}
471|jour f√©ri√©|a bank holiday|${CU}
472|√™tre en cong√© maladie|to be on sick leave|${CU}
473|prendre deux jours de cong√©|to take two days off|${CU}
474|r√©duction du temps de travail, RTT|reduction of working hours|${CU}
475|les 35 heures, la semaine de 35 heures|the 35-hour working week|${CU}
476|supprimer des emplois|to cut jobs|${CU}
477|faire des coupes sombres, claires dans la main d'≈ìuvre|to slash, to axe jobs|${CU}
478|pertes d'emploi, suppressions d'emploi|job losses|${CU}
479|rationaliser|to streamline|${CU}
480|d√©graisser ses effectifs|to downsize|${CU}
481|licencier des salari√©s|to lay off workers, to make workers redundant|${CU}
482|licenciement (√©conomique)|a redundancy|${CU}
483|d√©part volontaire|a voluntary redundancy|${CU}
484|plan social|a redundancy plan|${CU}
485|indemnit√© de licenciement, prime de d√©part|redundancy payment, severance pay, severance package|${CU}
486|parachute dor√©|a golden parachute, a golden handshake|${CU}
487|renvoyer, licencier, cong√©dier qn|to dismiss sb|${CU}
488|mettre √† la porte, renvoyer, virer|to fire, to sack, to give sb the sack|${CU}
489|√™tre renvoy√©|to get the sack|${CU}
490|conflit social|an industrial dispute|${CU}
491|se mettre / √™tre en gr√®ve|to go on strike / be on strike|${CU}
492|gr√©viste|a striker|${CU}
493|direction et les salari√©s|management and workers|${CU}
494|d√©l√©gu√© syndical|a shop steward|${CU}
495|syndicat|a (trade) union|${CU}
496|revendication|a claim|${CU}
497|revendications salariales|wage claims, wage demands|${CU}
498|augmentation de salaire|a payrise (GB), a payraise (US)|${CU}
499|reprendre le travail|to resume work|${CU}
500|prendre sa retraite|to retire|${CU}
501|d√©missionner|to resign, to step down|${CU}
502|retrait√©|a pensioner, an old age pensioner, a retiree (US)|${CU}
503|retraite|retirement|${CU}
504|partir en pr√©-retraite|to take early retirement|${CU}
505|√¢ge de la retraite|retirement age|${CU}
506|bien r√©ussir √† l'√©cole|to do well at school|Education
507|lire l'anglais couramment|to read English fluently|Education
508|√™tre bon en sport|to be good at sports|Education
509|faire l'√©cole buissonni√®re|to play truant|Education
510|absent√©isme|truancy|Education
511|suivre un cours d'anglais|to take a class in English|Education
512|donner du travail √† la maison|to set homework|Education
513|rendre un travail|to hand in a piece of work|Education
514|les subtilit√©s de la langue anglaise|the intricacies of the English language|Education
515|se lancer|to get started|Education
516|se conformer √† une r√®gle|to obey a rule|Education
517|ob√©ir √† (qqn)|to obey (sone)|Education
518|avoir des difficult√©s en maths|to have difficulty with maths|Education
519|donner un coup de main √† (qqn)|to give (sone) a hand|Education
520|obtenir un dipl√¥me|to graduate|Education
521|une salle de classe|a classroom|Education
522|une le√ßon|a class|Education
523|rattraper un cours loup√©|to catch up a missed lesson|Education
524|√©valuer|to assess, appraise|Education
525|le programme scolaire|the school curriculum|Education
526|√©tudiant de premier cycle|undergraduate|Education
527|indisciplin√©|unruly|Education
528|incontr√¥lable|unmanageable|Education
529|b√¢cler ses devoirs|to dash off one's work|Education
530|obtenir une bonne note|to get a good mark|Education
531|tricher sur son voisin|to eye over one's neighbour's work|Education
532|principal, directeur (√©cole)|headmaster|Education
533|√©l√®ve dou√©|gifted pupil|Education
534|r√©ussir un examen haut la main|to pass a test with flying colors|Education
535|une mati√®re (scolaire)|a (school) subject|Education
536|une pause de 20 minutes|a 20-minute break|Education
537|une heure de cours|a teaching-hour|Education
538|passer dans la classe sup√©rieure|to pass the next grade|Education
539|travail de paperasse|paperwork|Education
540|passer un examen|to take an exam|Education
541|examen blanc|mock exam|Education
542|se pr√©parer √† un examen|to prepare for an exam|Education
543|√©chouer √† un examen|to flunk a test|Education
544|recaler (qqn)|to flunk (sone)|Education
545|√™tre re√ßu √† un examen avec mention|to pass a degree with distinction|Education
546|abandonner l'√©cole|to drop out of school|Education
547|un √©l√®ve d√©crocheur|a dropout|Education
548|obtenir une bourse|to get a scholarship|Education
549|entrer en fac de m√©decine|to go to a medical school|Education
550|faire des √©tudes de m√©decine|to study medicine|Education
551|remettre un √©v√®nement √† plus tard|to put off an event|Education
552|sortie scolaire|school trip|Education
553|faire des recherches sur (qqch)|to do research on (sthg)|Education
554|cour d'√©cole|schoolyard|Education
555|un √©l√®ve de terminale|[UK] a sixth-former|Education
556|m√©ticuleux|painstaking|Education
557|s√©cher un cours|to skip a lesson|Education
558|se voir accorder la possibilit√© de [...]|to be provided with an opportunity to [...]|Education
559|tricher|to cheat|Education
560|un tricheur|a cheater|Education
561|√™tre renvoy√©|to be expelled|Education
562|rouler sur un examen|to sail through an exam|Education
563|sauce (tomate)|dressing|Thanksgiving
564|chuckle|laughter|Thanksgiving
565|to gather|to get together|Thanksgiving
566|a feast|a banquet|Thanksgiving
567|to reach accross|to make efforts to join|Thanksgiving
568|one another|each other|Thanksgiving
569|to winnow away|to filter out and remove|Thanksgiving
570|widely viewed as|largely regarded as|Thanksgiving
571|twice|two times|Thanksgiving
572|to provide|to give|Thanksgiving
573|the bulk of|the biggest part of|Thanksgiving
574|to depict|to describe|Thanksgiving
575|to feature|to represent, show|Thanksgiving
576|subservient|submissive, docile|Thanksgiving
577|pilgrims|migrants arriving in America from England in 17th|Thanksgiving
578|to outnumber|to surpass in number|Thanksgiving
579|to crouch|almost to sit on the floor|Thanksgiving
580|a harvest|a crop|Thanksgiving
581|likely|probably|Thanksgiving
582|a deed|an [bad] action|Thanksgiving
583|settlers|colons|Thanksgiving
584|in retaliation for|in revenge for|Thanksgiving
585|to broker|to organize, negotiate|Thanksgiving
586|to grab|to seize|Thanksgiving
587|gauzy|transparent|Thanksgiving
588|willfully|deliberately|Thanksgiving
589|How [s.one] would have it|What [s.one] would like to believe|Thanksgiving
590|druthers|inclination, penchant|Thanksgiving
591|blissfully|ecstatically|Thanksgiving
592|bleached out|washed out|Thanksgiving
593|to abid|to respect|Thanksgiving
594|alt√©rer|alter|Thanksgiving
595|apprentissage en continu|lifelong learning|Thanksgiving
596|malaise|general feeling of discomfort|Business
597|stagflation|period of slow economic growth and high unemployment|Business
598|aftermath|the consequences of a significant unpleasant event|Business
599|hyperinflation|extremely high and accelerating inflation|Business
600|third-world countries|countries with lower economic development|Business
601|martial law|military control over civilian functions of government|Business
602|gleaming|shining brightly, describe something polished or new|Business
603|suburban area|residential area on the outskirts of the a city|Business
604|stagnation|lack of activity, growth, and development|Business
605|dispirited|having lost emthusiasm and hope|Business
606|fatalistic|believing that events are inevitable|Business
607|hollowed out|destroyed or weakened from within|Business
608|brimming|filled to the point of overflowing (with positive emotions and energy)|Business
609|rabais, ristourne|discount|Business
610|cha√Æne de montage|assembly line|Business
611|payer comptant|to pay cash|Business
612|p√©nurie de main d'oeuvre|labor shortage|Business
613|productivit√©|productivity|Business
614|soumettre sa candidature|to apply|Business
615|racheter|to buy out|Business
616|licencier|to lay off|Business
617|se mettre en gr√®ve|to go on strike|Business
618|service client|customer service|Business
619|repr√©sentant syndical|union representative|Business
620|commerƒáant|shopkeeper|Business
621|virer, mettre √† la porte|to fire|Business
622|se mettre √† son compte|to set up one's business|Business
623|d√©missionner|to resign|Business
624|en sureffectif|overstaffed|Business
625|contrat √† dur√©e ind√©termin√©e|permanent contract|Business
626|√©quipe de nuit|night shift|Business
627|service, d√©partement|department|Business
628|refondre, r√©organiser|to revamp|Business
629|concurrent|competitor|Business
630|fusion|merger|Business
631|faire faillite|to go bankrupt, bust|Business
632|embaucher|to hire, take on|Business
633|fiche de paie|pay slip|Business
634|faire des heures suppl√©mentaires|work overtime|Business
635|mettre la cl√© sous la porte|to go out of business, close up shop|Business
636|fait main|handmade|Business
637|artisan|craftsman|Business
638|ouvrier qualifi√©|skilled worker|Business
639|entreprise|business|Business
640|plein emploi|full employment|Business
641|un maire|a mayor|Politique
642|homme politique|politician|Politique
643|s'assurer une majorit√©|to secure a majority|Politique
644|d√©clencher des √©lections anticip√©es|to call an early election|Politique
645|(UK) les √©l√©ctions l√©gislatives|(UK) the general election|Politique
646|(US) les √©l√©ctions pr√©sidentielles|(US) the general election|Politique
647|les grands partis|mainstream parties|Politique
648|premier ministre|Prime Minister|Politique
649|le ministre de l'√©conomie et des finances|(UK) the Chancellor of the Exchequer|Politique
650|remaniement minist√©riel|Cabinet reshuffle|Politique
651|ministre des Affaires √©trang√®res|Foreign minister|Politique
652|pronncer un discours|to deliver a speech|Politique
653|une dictature|a dictatorship|Politique
654|museler, ba√Ælloner|to gag, muzzle|Politique
655|soci√©t√© civile|civil society|Politique
656|(UK) syndicats|(UK) trade unions|Politique
657|(US) syndicats|(US) labor unions|Politique
658|√©lections de mi-mandat|mid-term elections|Politique
659|minisre "frondeur"|rebellious minister|Politique
660|d√©missionner|resign, step down|Politique
661|officier en tant que|to serve as|Politique
662|opposer son veto √† (qqch)|to veto (sthg)|Politique
663|un projet de loi|a bill|Politique
664|un groupe de r√©flexion|a think-tank|Politique
665|(UK) un ministre|(UK) a Cabinet member|Politique
666|un directeur de cabinet|a chief of staff|Politique
667|imp√¥ts locaux|local taxes|Politique
668|cote de popularit√©|approval ratings|Politique
669|se pr√©senter √† une √©l√©ction|to run for election [office]|Politique
670|pr√™ter serment|to take the oath, be sworn in|Politique
671|rendre homage √† (qqn)|to pay tribute to (sone)|Politique
672|dirigeant|political leader|Politique
673|√©lection truqu√©e|rigged election|Politique
674|les allocations|social benefits|Politique
675|revaloriser|to scale up, raise, increase|Politique
676|l'allocation familliale|the family allowance|Politique
677|le gel de la production|the production freeze|Politique
678|un bras de fer|a tug of war|Politique
679|chancelant|teetering, wavering|Politique
680|tailored|customized|Politique
681|rote memorisation|repetition-based learning|Politique
682|impoverished|cash-strapped|Politique
683|unencumbered|unburdened|Politique
684|inquisitiveness|interest, curiosity|Politique
685|substantially|notably, significatly|Politique
686|authoritarian|dictatorial, strict|Politique
687|minimally supervised|lightly monitored|Politique
688|crime, criminality|la criminalit√©|${CR}
689|the crime rate|le taux de criminalit√©|${CR}
  690|organized crime|la criminalit√© organis√©e, le grand banditisme|${CR}
  691|white-collar crime|la criminalit√© en col blanc|${CR}
  692|juvenile delinquency|la d√©linquance juv√©nile|${CR}
  693|a juvenile delinquent, a young offender|un d√©linquant juv√©nile|${CR}
  694|petty crime|la petite d√©linquance|${CR}
  695|a crime, a felony|un crime|${CR}
  696|to commit a crime|commettre un crime|${CR}
  697|a criminal, a felon|un criminel|${CR}
  698|a criminal record|un casier judiciaire|${CR}
  699|an offense|un d√©lit, une infraction|${CR}
  700|a misdemeanour|une infraction (GB), un d√©lit (US)|${CR}
  701|an offender|un d√©linquant, un contrevenant|${CR}
  702|a repeat offender, a recidivist|un r√©cidiviste|${CR}
  703|murder|le meurtre|${CR}
  704|a murderer|un meurtrier|${CR}
  705|manslaughter|homicide|${CR}
  706|a serial killer|un tueur en s√©rie|${CR}
  707|theft|le vol|${CR}
  708|a thief, a robber|un voleur|${CR}
  709|to steal a watch|voler une montre|${CR}
  710|to rob sb of sth|voler qch √† qn|${CR}
  711|rape|le viol|${CR}
  712|armed robbery|vol √† main arm√©e|${CR}
  713|a burglary|un cambriolage|${CR}
  714|to mug sb, to attack sb|agresser qn|${CR}
  715|money-laundering|le blanchiment d‚Äôargent|${CR}
  716|to break a law|enfreindre une loi|${CR}
  717|lawful / unlawful|l√©gal / ill√©gal|${CR}
  718|a lawbreaker|un d√©linquant, une personne qui enfreint la loi|${CR}
  719|wrongdoing|des m√©faits|${CR}
  720|a wrongdoer|un malfaiteur|${CR}
  721|to flout the law|se moquer de la loi|${CR}
  722|a no-go area|une zone de non-droit|${CR}
  723|to obey the law|ob√©ir √† la loi|${CR}
  724|to abide by the law|respecter la loi|${CR}
  725|a law-abiding citizen|un citoyen respectueux des lois|${CR}
  726|the justice system|la justice|${CR}
  727|a court, a court of law|un tribunal|${CR}
  728|a judge|un juge|${CR}
  729|a lawyer, a barrister (GB), an attorney (US)|un avocat|${CR}
  730|the jury|le jury|${CR}
  731|to prosecute sb|poursuivre qn (en justice)|${CR}
  732|to bring a lawsuit against sb, sue sb|intenter un proc√®s √† qn, engager des poursuites contre qn|${CR}
  733|the prosecutor|le procureur|${CR}
  734|a suspect|un suspect|${CR}
  735|to charge sb with murder|accuser, inculper qn de meurtre|${CR}
  736|a charge|une accusation, un chef d‚Äôinculpation|${CR}
  737|to confess to a crime|avouer un crime|${CR}
  738|to confess to embezzling money|avouer avoir d√©tourn√© de l‚Äôargent|${CR}
  739|confession|un aveu|${CR}
  740|a defendant|un accus√©, un pr√©venu|${CR}
  741|a witness / an eye witness|un t√©moin / un t√©moin oculaire|${CR}
  742|a case|une affaire|${CR}
  743|a trial|un proc√®s|${CR}
  744|to be tried, stand trial|passer en jugement, √™tre jug√©|${CR}
  745|to await trial|√™tre en attente de jugement|${CR}
  746|the principle that a defendant is innocent until proven guilty|la pr√©somption d‚Äôinnocence|${CR}
  747|forensic evidence|preuves relev√©es lors d‚Äôune expertise|${CR}
  748|a culprit|un coupable|${CR}
  749|to acquit sb|acquitter qn|${CR}
  750|acquittal|acquittement|${CR}
  751|to find sb guilty|condamner qn, reconna√Ætre qn coupable|${CR}
  752|to convict sb of rape, murder|reconna√Ætre qn coupable de viol, meurtre|${CR}
  753|a conviction|une condamnation|${CR}
  754|a fine|une amende|${CR}
  755|to fine sb for sth|condamner qn √† une amende pour qch|${CR}
  756|to be sentenced to five years‚Äô imprisonment, five years in jail|√™tre condamn√© √† cinq ans de prison|${CR}
  757|a death sentence|une condamnation √† mort|${CR}
  758|a life sentence|une condamnation √† perp√©tuit√©|${CR}
  759|a suspended sentence|une condamnation avec sursis|${CR}
  760|to be sent to prison|√™tre mis en prison|${CR}
  761|to incarcerate, to imprison sb|incarc√©rer qn|${CR}
  762|the incarceration rate|le taux d‚Äôincarc√©ration|${CR}
  763|a cell|une cellule|${CR}
  764|a prisoner, an inmate, a detainee|un d√©tenu, un prisonnier|${CR}
  765|a prison officer, a prison warder (GB)|un gardien de prison|${CR}
  766|a high-security prison|une prison de haute s√©curit√©|${CR}
  767|solitary confinement|l‚Äôisolement carc√©ral|${CR}
  768|prison overcrowding|la surpopulation carc√©rale|${CR}
  769|a miscarriage of justice|une erreur judiciaire|${CR}
  770|to fabricate evidence|fabriquer des preuves|${CR}
  771|to be proved innocent, to be exonerated|√™tre innocent√©|${CR}
  772|to free, to release a prisoner|lib√©rer, rel√¢cher un prisonnier|${CR}
  773|to pardon a convict|gr√¢cier un condamn√©|${CR}
  774|to parole sb|mettre qn en libert√© conditionnelle|${CR}
  775|to be on parole|√™tre en libert√© conditionnelle|${CR}
  776|to report to the police|se pr√©senter √† la police|${CR}
  777|an electronic tag|un bracelet de surveillance √©lectronique|${CR}
  `.trim().split('\n').map(l=>{ const [id,f,e,c]=l.split('|'); return {id, french:f, english:e, chapter:c}; });

  const CHAPTER_EMOJIS = {
    [CD]:'üèõÔ∏è', [CG]:'üß¨', [CI]:'üß≥', [CIT]:'üåê', [CU]:'üíº', [CR]:'‚öñÔ∏è',
    'Politique':'üèõÔ∏è', 'Business':'üíº', 'Education':'üéì', 'Thanksgiving':'ü¶É'
  };



    // Utils & √©tat
    const $=id=>document.getElementById(id);
    const on=(el,ev,fn,opt)=>el&&el.addEventListener(ev,fn,opt||false);
    const DAY_MS=86400000, MIN_MS=60000, HOUR_MS=3600000;
    const clamp=(v,min,max)=>Math.max(min,Math.min(max,v));
    const nowMs=()=>Date.now();
    const isoDate=(d=new Date())=>`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;

    // SRS config (espacement adaptatif + Leitner)
    const SRS_CFG={
      startEase:2.3, minEase:1.3, maxEase:3.5,
      hardMult:1.2, easyBonus:1.15,
      easeAdj:{again:-0.25,hard:-0.15,good:+0.05,easy:+0.15},
      newStepsMin:[1,10],             // minutes (nouvelle carte)
      relearnStepsMin:[10,1440],      // minutes (r√©apprentissage apr√®s oubli)
      graduatingIvlDays:1,            // interval initial apr√®s apprentissage
      lapseResetFactor:0.5,           // r√©duction d'intervalle apr√®s oubli
      // Leitner: bornes d‚Äôintervalle par bo√Æte (en jours)
      boxBounds:{
        1:{min:0.08,max:1},   // 2h -> 1j
        2:{min:2,max:4},      // 2 -> 4j
        3:{min:5,max:12},     // 5 -> 12j
        4:{min:15,max:45},    // 15 -> 45j
        5:{min:45,max:120}    // 45 -> 120j
      }
    };

    const GradeNames={1:'again',2:'hard',3:'good',4:'easy'};
    const FAST_CHAR_MS=180, AUTO_ADVANCE_MS=120;

    const S={
      allCards:[], currentDeck:[], currentIndex:0, currentChapter:'Tout',
      availableChapters:['Tout'],
      elapsedSeconds:0, darkMode:false, currentTheme:'default', reverseMode:false,
      streak:0, maxStreak:0, answerStartAt:null,
      isRevealed:false, awaitingGrade:false, awaitingAdvance:false,
      dailyHistory:{}, sessionNewShown:0, seenCountInSession:0,
      searchIndex:[],
      adaptiveScheduler:null, // hook IA optionnel
      // Cycle unique par chapitre
      cycle: { chapter:'Tout', seen:{} } // seen: { [cardId]: true }
    };

    const els={
      burgerButton:$('burger-button'), sidebarMenu:$('sidebar-menu'), menuOverlay:$('menu-overlay'), closeMenuButton:$('close-menu-button'),
      menuChapters:$('menu-chapters'), resetOptions:$('reset-options'), resetDataButton:$('reset-data-button'),
      searchBar:$('search-bar'), searchResultsContainer:$('search-results-container'),
      reverseModeButton:$('reverse-mode-button'), darkModeToggle:$('dark-mode-toggle'), themeSelector:$('theme-selector'),
      currentChapterLabel:$('current-chapter-label'),
      flashcardContainer:$('flashcard-container'), cardFrenchWord:$('card-french-word'), cardEnglishWord:$('card-english-word'),
      cardScore:$('card-score'), messageArea:$('message-area'), answerInput:$('answer-input'), submitAnswerButton:$('submit-answer-button'),
      gradeBar:$('grade-bar'),
      timer:$('timer'), streakBadge:$('streak-badge'),
      progressText:$('progress-text'), progressBarFill:$('progress-bar-fill'), progressPercentage:$('progress-percentage'),
      statsContent:$('stats-content'), sparkline:$('sparkline'), sparkPath:$('sparkline-path'), sparkFill:$('sparkline-fill'), sparkLast:$('sparkline-last'), chartLegend:$('chart-legend'), chartTitle:$('chart-title')
    };

    // UI helpers
    function showMsg(text,cls,timeout=1600){els.messageArea.textContent=text;els.messageArea.className='w-full text-center h-6 text-sm font-medium '+(cls||'');if(timeout){setTimeout(()=>{if(els.messageArea.textContent===text)els.messageArea.textContent=''},timeout)}}
    function renderTimer(){const s=S.elapsedSeconds,h=String(s/3600|0).padStart(2,'0'),m=String((s%3600)/60|0).padStart(2,'0'),sec=String(s%60).padStart(2,'0');els.timer.textContent=`${h}:${m}:${sec}`}
    function notSeenInCycleList(base){ return base.filter(c=>!S.cycle.seen[String(c.id)]) }
    function renderProgressBar(){
      const total = baseListForCurrentChapter().length;
      const seenCycle = total - notSeenInCycleList(baseListForCurrentChapter()).length;
      const pct = total ? Math.min(100, Math.round(seenCycle * 100 / total)) : 0;
      els.progressText.textContent = `Cycle: ${seenCycle}/${total}`;
      els.progressBarFill.style.width = `${pct}%`;
      if (els.progressPercentage) els.progressPercentage.textContent = `${pct}%`;
    }
    function setSubmitVisible(v){els.submitAnswerButton.classList.toggle('hidden',!v)}
    function setInputDisabled(v){els.answerInput.disabled=!!v}
    function setGradeBarVisible(v){els.gradeBar.classList.toggle('hidden',!v)}
    function applyNeutralCardStyle(){const el=els.flashcardContainer;el.classList.remove('light-mode-card-neutral','dark-mode-card-neutral');el.classList.add(S.darkMode?'dark-mode-card-neutral':'light-mode-card-neutral')}
    function minutesToMs(m){return m*MIN_MS} function daysToMs(d){return d*DAY_MS}
    function formatInterval(ms){if(ms<MIN_MS) return `${Math.max(1,Math.round(ms/1000/10)*10)}s`; if(ms<60*MIN_MS) return `${Math.round(ms/MIN_MS)}m`; if(ms<DAY_MS) return `${Math.round(ms/(60*MIN_MS))}h`; const d=Math.round(ms/DAY_MS); return d<30?`${d}j`:`${Math.round(d/30)}mo`}

    function setMenuOpen(open){
      els.sidebarMenu.classList.toggle('menu-slide-in',open);
      els.sidebarMenu.classList.toggle('menu-slide-out',!open);
      document.body.classList.toggle('menu-open',open);
      els.menuOverlay.setAttribute('aria-hidden',String(!open));
      els.sidebarMenu.setAttribute('aria-hidden',String(!open));
      els.burgerButton.setAttribute('aria-expanded',String(!!open));
    }

    function setDarkMode(onMode){
      S.darkMode=!!onMode; document.body.classList.toggle('dark-mode',S.darkMode); document.body.classList.toggle('light-mode',!S.darkMode);
      els.darkModeToggle.innerHTML=S.darkMode?'‚òÄ':'üåô'; els.darkModeToggle.setAttribute('aria-pressed',String(S.darkMode));
      autoSave();
    }

    // Leitner helpers
    function clampToBoxBounds(intervalDays, box){
      const b=SRS_CFG.boxBounds[clamp(box,1,5)];
      if(!b) return intervalDays;
      return clamp(intervalDays, b.min, b.max);
    }
    function updateBox(prevBox, gName){
      const delta = gName==='again'?-1 : gName==='hard'?0 : gName==='good'?1 : 2;
      return clamp((prevBox||1)+delta,1,5);
    }
    function computeMasteryScore(c){
      const box = Number.isFinite(c.box)?c.box:1;
      const reps = Number.isFinite(c.reps)?c.reps:0;
      const lapses = Number.isFinite(c.lapses)?c.lapses:0;
      const base = 20*box + 10*Math.min(reps,5) - 15*lapses;
      return clamp(Math.round(base),0,100);
    }
    function masteryCategory(score){
      if(score<50) return '√Ä revoir souvent';
      if(score<80) return 'En progression';
      return 'Ma√Ætris√©';
    }

    // Mod√®le carte & scheduler
    function upgradeCardModel(c0){
      const c={...c0};
      c.ef=Number.isFinite(c.ef)?c.ef:SRS_CFG.startEase;
      c.box=Number.isFinite(c.box)?c.box:1;
      c.reps=Number.isFinite(c.reps)?c.reps:0;
      c.lapses=Number.isFinite(c.lapses)?c.lapses:0;

      c.intervalDays=Number.isFinite(c.intervalDays)?c.intervalDays:0;
      c.state=c.state||'new';
      c.stepIndex=Number.isFinite(c.stepIndex)?c.stepIndex:0;

      c.revCount=Number.isFinite(c.revCount)?c.revCount:0;
      c.okCount=Number.isFinite(c.okCount)?c.okCount:0;
      c.totalTimeMs=Number.isFinite(c.totalTimeMs)?c.totalTimeMs:0;
      c.lastScorePct=Number.isFinite(c.lastScorePct)?c.lastScorePct:null;
      c.lastGrade=Number.isFinite(c.lastGrade)?c.lastGrade:null;
      c.lastSeen=Number.isFinite(c.lastSeen)?c.lastSeen:0;
      c.nextDue=Number.isFinite(c.nextDue)?c.nextDue:0;
      c.lastLatency=Number.isFinite(c.lastLatency)?c.lastLatency:0;

      c.masteryScore=Number.isFinite(c.masteryScore)?c.masteryScore:computeMasteryScore(c);
      return c;
    }

    function computeNextIntervalDaysReview(card, gName){
      const prev = Math.max(card.intervalDays||1, 0.04);
      if(gName==='hard')  return Math.max(1, Math.round(prev * SRS_CFG.hardMult));
      if(gName==='good')  return Math.round(prev * (card.ef||SRS_CFG.startEase));
      if(gName==='easy')  return Math.round(prev * ((card.ef||SRS_CFG.startEase) + 0.15));
      return 0.25;
    }

    async function scheduleWithGrade(card, grade){
      const now=nowMs(); const gName=GradeNames[grade]||'good';
      const before = {...card};

      const deltaEase = SRS_CFG.easeAdj[gName]||0;
      card.ef = clamp((card.ef||SRS_CFG.startEase)+deltaEase, SRS_CFG.minEase, SRS_CFG.maxEase);
      card.box = updateBox(card.box||1, gName);

      if(gName==='again'){ card.reps=0; card.lapses=(card.lapses||0)+1; }
      else if(gName==='hard'){ card.reps = Math.max(1, (card.reps||0)); }
      else { card.reps=(card.reps||0)+1; }

      card.lastSeen = now;

      if(card.state==='new' || card.state==='learning'){
        if(gName==='again'){
          card.state='learning';
          card.stepIndex=0;
          card.nextDue=now+minutesToMs(SRS_CFG.newStepsMin[0]);
        } else if(gName==='hard'){
          card.state='learning';
          const idx = Math.max(0, card.stepIndex|0);
          const step = SRS_CFG.newStepsMin[idx] ?? SRS_CFG.newStepsMin.at(-1);
          card.stepIndex=idx;
          card.nextDue=now+minutesToMs(step);
        } else if(gName==='good'){
          const nextIdx=(card.stepIndex|0)+1;
          if(nextIdx < SRS_CFG.newStepsMin.length){
            card.state='learning';
            card.stepIndex=nextIdx;
            card.nextDue=now+minutesToMs(SRS_CFG.newStepsMin[nextIdx]);
          } else {
            card.state='review';
            card.intervalDays=SRS_CFG.graduatingIvlDays;
            card.intervalDays = clampToBoxBounds(card.intervalDays, card.box);
            card.nextDue=now+daysToMs(card.intervalDays);
          }
        } else if(gName==='easy'){
          card.state='review';
          const ivl = Math.max(1, Math.round(SRS_CFG.graduatingIvlDays * 3));
          card.intervalDays = clampToBoxBounds(ivl, card.box);
          card.nextDue=now+daysToMs(card.intervalDays);
        }
      } else if(card.state==='review'){
        if(gName==='again'){
          card.state='relearning';
          card.stepIndex=0;
          card.nextDue=now+minutesToMs(SRS_CFG.relearnStepsMin[0]);
        } else {
          let ivl = computeNextIntervalDaysReview(card, gName);
          ivl = clampToBoxBounds(ivl, card.box);
          card.intervalDays = ivl;
          card.nextDue = now + daysToMs(ivl);
        }
      } else if(card.state==='relearning'){
        if(gName==='again'){
          card.stepIndex=0;
          card.nextDue=now+minutesToMs(SRS_CFG.relearnStepsMin[0]);
        } else if(gName==='hard'){
          const idx=Math.max(0,card.stepIndex|0);
          const step=SRS_CFG.relearnStepsMin[idx]??SRS_CFG.relearnStepsMin.at(-1);
          card.stepIndex=idx;
          card.nextDue=now+minutesToMs(step);
        } else {
          const nextIdx=(card.stepIndex|0)+1;
          if(nextIdx < SRS_CFG.relearnStepsMin.length){
            card.stepIndex=nextIdx;
            card.nextDue=now+minutesToMs(SRS_CFG.relearnStepsMin[nextIdx]);
          } else {
            card.state='review';
            const reduced=Math.max(1,Math.round((card.intervalDays||1)*SRS_CFG.lapseResetFactor));
            card.intervalDays = clampToBoxBounds(reduced, card.box);
            card.nextDue=now+daysToMs(card.intervalDays);
          }
        }
      }

      // Hook IA optionnel
      if (typeof S.adaptiveScheduler === 'function'){
        try{
          const suggest = await S.adaptiveScheduler({card, stateBefore:before, rating:gName});
          if(suggest){
            if(Number.isFinite(suggest.box)) card.box = clamp(suggest.box,1,5);
            if(Number.isFinite(suggest.intervalDays) && suggest.intervalDays>0 && card.state==='review'){
              const mixed = 0.7*(card.intervalDays||1) + 0.3*suggest.intervalDays;
              card.intervalDays = clampToBoxBounds(mixed, card.box);
              card.nextDue = now + daysToMs(card.intervalDays);
            }
          }
        }catch(e){}
      }

      card.masteryScore = computeMasteryScore(card);
      return (card.nextDue - now);
    }

    // Similarit√© & grading auto
    const ARTICLES_TO_IGNORE=['a','an','the','un','une','des','le','la','les',"l'"];
    const STRIP_DIACRITICS=/[\u0300-\u036f]/g;
    const normalizeAnswer=s=>(s||'').toLowerCase().normalize('NFD').replace(STRIP_DIACRITICS,'').replace(/[_-]/g,' ').replace(/[^a-z' ]+/g,' ').replace(/\s+/g,' ').trim();
    const removeArticlesTokens=s=>s.split(' ').filter(w=>!ARTICLES_TO_IGNORE.includes(w)).join(' ');
    const expandAlternatives=s=>String(s).split(/[\/,]/).map(x=>x.trim()).filter(Boolean);
    function levenshtein(a,b){const n=a.length,m=b.length;if(!n)return m;if(!m)return n;const dp=Array(n+1).fill(null).map(()=>new Uint16Array(m+1));for(let j=0;j<=m;j++)dp[0][j]=j;for(let i=1;i<=n;i++){dp[i][0]=i;const ai=a.charCodeAt(i-1);for(let j=1;j<=m;j++){const cost=(ai===b.charCodeAt(j-1))?0:1;dp[i][j]=Math.min(dp[i-1][j]+1,dp[i][j-1]+1,dp[i-1][j-1]+cost)}}return dp[n][m]}
    function bestSimilarity(userNorm, correctFull){
      let bestSim=0, exact=false;
      for(const cand of expandAlternatives(correctFull)){
        const cNorm=normalizeAnswer(cand); if(!cNorm) continue;
        const uNoArt=removeArticlesTokens(userNorm), cNoArt=removeArticlesTokens(cNorm);
        if(uNoArt===cNoArt){ exact=true; bestSim=1; break; }
        const dist=levenshtein(userNorm,cNorm), sim=1-dist/Math.max(1,Math.max(userNorm.length,cNorm.length));
        if(sim>bestSim) bestSim=sim;
      }
      return {bestSim, exact};
    }
    function scorePctFor(grade, exact, sim, msPerChar){
      const base={1:35,2:60,3:85,4:94}[grade]||85; let delta=0;
      if(msPerChar<=FAST_CHAR_MS*0.6) delta+=4; else if(msPerChar<=FAST_CHAR_MS) delta+=2; else delta-=2;
      if(!exact){ if(sim<0.40) delta-=15; else if(sim<0.70) delta-=8; else if(sim<0.85) delta-=3; else if(sim<0.95) delta-=1; }
      return clamp(Math.round(base+delta),10,98);
    }
    function gradeFromTyped(userInput, correctFull, latencyMs){
      const uNorm=normalizeAnswer(userInput); if(!uNorm) return {grade:1,scorePct:35,exact:false};
      const {bestSim,exact}=bestSimilarity(uNorm,correctFull); const chars=uNorm.replace(/\s+/g,'').length||1; const msPerChar=latencyMs>0?latencyMs/chars:Infinity;
      if(exact){ const grade=(msPerChar<=FAST_CHAR_MS)?4:3; return {grade,scorePct:scorePctFor(grade,true,1,msPerChar),exact:true}; }
      if(bestSim>=0.90){ const grade=(msPerChar<=FAST_CHAR_MS)?4:3; return {grade,scorePct:scorePctFor(grade,false,bestSim,msPerChar),exact:false}; }
      if(bestSim>=0.70) return {grade:3,scorePct:scorePctFor(3,false,bestSim,msPerChar),exact:false};
      if(bestSim>=0.40) return {grade:2,scorePct:scorePctFor(2,false,bestSim,msPerChar),exact:false};
      return {grade:1,scorePct:scorePctFor(1,false,bestSim,msPerChar),exact:false};
    }

    // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
    // Cycle unique: deck = cartes non vues dans le cycle
    // tri: learning/relearning dues -> review dues (faible ma√Ætrise d'abord)
    // -> le reste (new + notDue) tri√© par ma√Ætrise puis √©ch√©ance
    // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
    function ensureCycleForCurrentChapter(){
      if (S.cycle.chapter !== S.currentChapter){
        S.cycle.chapter = S.currentChapter;
        S.cycle.seen = {};
      }
    }
    function resetCycleForCurrentChapter(){
      S.cycle.chapter = S.currentChapter;
      S.cycle.seen = {};
    }

    function buildScheduledDeck(list){
      ensureCycleForCurrentChapter();

      let base = [...list];
      let unseen = base.filter(c => !S.cycle.seen[String(c.id)]);

      let cycleReset = false;
      if (unseen.length === 0 && base.length > 0){
        // fin de cycle -> reset
        resetCycleForCurrentChapter();
        unseen = [...base];
        cycleReset = true;
      }

      const now = nowMs();
      const learningDue = [], reviewDue = [], learningNotDue = [], reviewNotDue = [], newCards = [];
      for (const c of unseen) {
        if (c.state === 'new') { newCards.push(c); continue; }
        const due = (c.nextDue || 0) <= now;
        if (c.state === 'learning' || c.state === 'relearning') {
          if (due) learningDue.push(c); else learningNotDue.push(c);
        } else { // review
          if (due) reviewDue.push(c); else reviewNotDue.push(c);
        }
      }

      learningDue.sort((a,b)=>(a.nextDue||0)-(b.nextDue||0));
      reviewDue.sort((a,b)=>{
        const ma=(a.masteryScore||0), mb=(b.masteryScore||0);
        if (ma!==mb) return ma-mb;
        return (a.nextDue||0)-(b.nextDue||0);
      });

      // Le reste: priorit√© aux faibles ma√Ætrises
      const others = [
        ...newCards, 
        ...learningNotDue, 
        ...reviewNotDue
      ].sort((a,b)=>{
        const ma=(a.masteryScore||0), mb=(b.masteryScore||0);
        if (ma!==mb) return ma-mb;
        return (a.nextDue||Infinity)-(b.nextDue||Infinity);
      });

      const deck = [...learningDue, ...reviewDue, ...others];

      // Deck garanti non vide si base non vide
      if (cycleReset) {
        showMsg('Nouveau cycle lanc√©', 'text-amber-500 dark:text-amber-400', 1400);
      }
      return deck;
    }

    function baseListForCurrentChapter(){ return (S.currentChapter==='Tout')?[...S.allCards]:S.allCards.filter(c=>c.chapter===S.currentChapter) }
    function rebuildDeck(){ S.currentDeck=buildScheduledDeck(baseListForCurrentChapter()); S.currentIndex=0 }

    // Chapitres dynamiques
    function computeAvailableChapters(){
      const set=new Set(S.allCards.map(c=>c.chapter));
      S.availableChapters=['Tout', ...Array.from(set).filter(Boolean).sort((a,b)=>a.localeCompare(b))];
    }
    function renderChapterButtons(){
      const frag=document.createDocumentFragment();
      for(const name of S.availableChapters){
        const b=document.createElement('button');
        b.dataset.chapter=name;
        const emoji = name==='Tout' ? 'üìö' : (CHAPTER_EMOJIS[name] || 'üìò');
        b.innerHTML=`${emoji} ${name}`;
        b.className='p-2 sm:p-3 rounded-lg shadow font-medium text-xs sm:text-sm transition-all duration-200 ease-in-out hover:opacity-80 w-full truncate chapter-button-default';
        frag.appendChild(b);
      }
      els.menuChapters.innerHTML=''; els.menuChapters.appendChild(frag); updateActiveChapterButtons();
    }
    function updateActiveChapterButtons(){
      [...els.menuChapters.children].forEach(btn=>{
        btn.classList.remove('chapter-button-active','chapter-button-default');
        btn.classList.add(btn.dataset.chapter===S.currentChapter?'chapter-button-active':'chapter-button-default');
      });
    }
    function renderResetOptions(){ els.resetOptions.innerHTML=S.availableChapters.map(n=>`<option value="${n}">${n}</option>`).join('') }

    // Rendu carte
    function updateCardScoreUI(newPct, oldPct){
      const hasOld=Number.isFinite(oldPct); const delta=hasOld?(newPct-oldPct):null; const sign=(delta!=null)?(delta>=0?'+':'‚àí'):''; const abs=(delta!=null)?Math.abs(delta):null;
      els.cardScore.textContent=hasOld?`${newPct}% (${sign}${abs})`:`${newPct}%`;
    }
    function renderCard(focus=1){
      els.messageArea.textContent=''; els.answerInput.value=''; S.answerStartAt=null; S.isRevealed=false; S.awaitingGrade=false; S.awaitingAdvance=false;
      setGradeBarVisible(false); setSubmitVisible(true); setInputDisabled(false); applyNeutralCardStyle();
      if(!S.currentDeck.length||S.currentIndex>=S.currentDeck.length){
        els.cardFrenchWord.textContent='Aucune carte √† afficher.'; els.cardEnglishWord.textContent=''; els.cardEnglishWord.classList.add('hidden'); els.cardScore.textContent='--%'; return;
      }
      const card=S.currentDeck[S.currentIndex];
      const promptEl=S.reverseMode?els.cardEnglishWord:els.cardFrenchWord, translationEl=S.reverseMode?els.cardFrenchWord:els.cardEnglishWord;
      els.cardFrenchWord.textContent=card.french; els.cardEnglishWord.textContent=card.english; promptEl.classList.remove('hidden'); translationEl.classList.add('hidden');

      els.cardScore.textContent=Number.isFinite(card.lastScorePct)?`${card.lastScorePct}%`:'--%';
      const cat = masteryCategory(card.masteryScore||0);
      els.cardScore.title = `Ma√Ætrise: ${card.masteryScore||0}% ‚Ä¢ Bo√Æte: ${card.box||1} ‚Ä¢ Facilit√©: ${(card.ef||SRS_CFG.startEase).toFixed(2)} ‚Ä¢ ${cat}`;

      if(focus) els.answerInput.focus({preventScroll:true});
      els.currentChapterLabel.textContent=S.currentChapter;
    }

    // Notation & enregistrement
    function registerOutcome(card, grade, scorePct, latencyMs){
      card.revCount=(card.revCount||0)+1; if(grade>=3) card.okCount=(card.okCount||0)+1; card.totalTimeMs=(card.totalTimeMs||0)+(latencyMs||0);
      card.lastScorePct=clamp(Math.round(scorePct),0,100); card.lastGrade=grade; card.lastLatency=latencyMs||0;
      if(grade>=3){ S.streak++; S.maxStreak=Math.max(S.maxStreak,S.streak); } else { if(S.streak!==0) S.streak=0; }
      els.streakBadge.textContent=`üî• ${S.streak}`;
      const d=isoDate(); const rec=S.dailyHistory[d]||{rev:0,ok:0,ms:0}; rec.rev+=1; if(grade>=3) rec.ok+=1; rec.ms+=(latencyMs||0); S.dailyHistory[d]=rec;
    }
    async function onGrade(grade,opts={}){
      if(!S.currentDeck.length) return 0;
      const card=S.currentDeck[S.currentIndex]; const latency=opts.latencyMs||0; const oldPct=Number.isFinite(card.lastScorePct)?card.lastScorePct:null; const preState=card.state;
      const scorePct=Number.isFinite(opts.scorePct)?opts.scorePct:({1:35,2:60,3:85,4:95}[grade]);

      const nextMs=await scheduleWithGrade(card,grade);
      registerOutcome(card,grade,scorePct,latency);
      if(preState==='new') S.sessionNewShown++;

      // Marquer la carte comme "vue dans le cycle" (unicit√©)
      S.cycle.seen[String(card.id)] = true;

      updateCardScoreUI(scorePct,oldPct);

      const labels={1:'Encore',2:'Difficile',3:'Bien',4:'Facile'};
      if(opts.showFeedback!==false) showMsg(`${labels[grade]} ‚Äî ${formatInterval(nextMs)}`, grade>=3?'text-emerald-500 dark:text-emerald-400':'text-red-500 dark:text-red-400', 1200);

      rebuildDeck(); renderStats(); renderSparkline(); renderProgressBar(); autoSave();
      if(opts.autoAdvance!==false){ setTimeout(nextCard, AUTO_ADVANCE_MS); } else { S.awaitingAdvance=true; setTimeout(()=>{ showMsg('ENTER pour continuer','text-sky-500 dark:text-sky-400',1400); }, 150); }
      return nextMs;
    }

    // Saisie & ENTER
    function revealTranslation(){ const trEl=S.reverseMode?els.cardFrenchWord:els.cardEnglishWord; trEl.classList.remove('hidden'); S.isRevealed=true; }
    function handleSubmitAnswer(){
      if(els.answerInput.disabled) return; if(!S.currentDeck.length) return;
      const user=els.answerInput.value.trim(); const cur=S.currentDeck[S.currentIndex];
      if(!user){
        if(!S.isRevealed){ revealTranslation(); S.awaitingGrade=true; setGradeBarVisible(true); setSubmitVisible(false); setInputDisabled(true); showMsg('R√©v√©l√© ‚Äî 1 Encore, 2 Diff., 3 Bien, 4 Facile','text-sky-500 dark:text-sky-400',2000); }
        else { showMsg('1 Encore, 2 Diff., 3 Bien, 4 Facile','text-sky-500 dark:text-sky-400',1200); }
        return;
      }
      const latency=S.answerStartAt?(Date.now()-S.answerStartAt):0; revealTranslation();
      const correct=(S.reverseMode?cur.french:cur.english).trim(); const {grade,scorePct}=gradeFromTyped(user,correct,latency);
      const oldPct=Number.isFinite(cur.lastScorePct)?cur.lastScorePct:null; setSubmitVisible(false); setInputDisabled(true); setGradeBarVisible(false);
      onGrade(grade,{scorePct,latencyMs:latency,autoAdvance:false,showFeedback:false}).then(nextMs=>{
        const delta=(oldPct!=null)?(scorePct-oldPct):null; const deltaTxt=(delta!=null)?` (${delta>=0?'+':'‚àí'}${Math.abs(delta)}%)`:''; const good=(grade>=3);
        showMsg(`${good?'Bonne r√©ponse !':'Mauvaise r√©ponse !'}${deltaTxt}${nextMs?` ‚Äî ${formatInterval(nextMs)}`:''}`, good?'text-emerald-500 dark:text-emerald-400':'text-red-500 dark:text-red-400',1600);
        S.awaitingAdvance=true;
      });
    }
    function nextCard(){ S.seenCountInSession++; if(!S.currentDeck.length){ renderCard(); return; } S.currentIndex=0; renderCard(); renderProgressBar(); autoSave(); }

    // Sauvegarde
    let saveT=null;
    function saveData(){ 
      try{ 
        // s√©rialiser seen comme tableau d‚Äôids pour compacit√©
        const seenArray = Object.keys(S.cycle.seen||{});
        localStorage.setItem('flashcardAppData', JSON.stringify({
          allCards:S.allCards, elapsedSeconds:S.elapsedSeconds, currentChapter:S.currentChapter, darkMode:S.darkMode, currentTheme:S.currentTheme, reverseMode:S.reverseMode,
          streak:S.streak, maxStreak:S.maxStreak, dailyHistory:S.dailyHistory, sessionNewShown:S.sessionNewShown, seenCountInSession:S.seenCountInSession,
          cycle:{ chapter:S.cycle.chapter, seen:seenArray }
        })); 
      }catch(e){} 
    }
    function autoSave(){ clearTimeout(saveT); saveT=setTimeout(saveData,250); }
    function loadData(){
      const s=localStorage.getItem('flashcardAppData'); if(!s) return false;
      try{
        const d=JSON.parse(s);
        S.allCards=(d.allCards&&d.allCards.length?d.allCards:cardsRaw).map(upgradeCardModel);
        S.elapsedSeconds=d.elapsedSeconds||0; S.currentChapter=d.currentChapter||'Tout';
        S.darkMode=!!d.darkMode; document.body.classList.toggle('dark-mode',S.darkMode); document.body.classList.toggle('light-mode',!S.darkMode);
        els.darkModeToggle.innerHTML=S.darkMode?'‚òÄ':'üåô'; els.darkModeToggle.setAttribute('aria-pressed',String(S.darkMode));
        S.currentTheme=d.currentTheme||'default'; els.themeSelector&&(els.themeSelector.value=S.currentTheme);
        S.reverseMode=!!d.reverseMode; S.streak=d.streak||0; S.maxStreak=d.maxStreak||0; S.dailyHistory=d.dailyHistory||{}; S.sessionNewShown=d.sessionNewShown||0; S.seenCountInSession=d.seenCountInSession||0;
        // Cycle
        const cycleSeenArray = (d.cycle && Array.isArray(d.cycle.seen)) ? d.cycle.seen : [];
        S.cycle = { chapter: (d.cycle?.chapter)||S.currentChapter, seen: Object.fromEntries(cycleSeenArray.map(id=>[String(id),true])) };
        // recalcul ma√Ætrise si manquante
        S.allCards.forEach(c=>{ if(!Number.isFinite(c.masteryScore)) c.masteryScore=computeMasteryScore(c); });
        return true;
      }catch(e){ return false }
    }

    // Recherche & chapitres
    function buildSearchIndex(){ S.searchIndex=S.allCards.map(c=>({id:c.id,french_lc:c.french.toLowerCase(),english_lc:c.english.toLowerCase(),chapter:c.chapter,ref:c})) }
    function filterCardsForSearch(q){
      els.searchResultsContainer.innerHTML=''; const query=(q||'').trim().toLowerCase(); if(!query) return;
      const res=[]; for(const c of S.searchIndex){ if(c.french_lc.includes(query)||c.english_lc.includes(query)) { res.push(c.ref); if(res.length>=8) break; } }
      if(!res.length){ els.searchResultsContainer.innerHTML='<p class="p-2">Aucun r√©sultat</p>'; return; }
      const hoverCls=S.darkMode?'hover:bg-gray-700':'hover:bg-gray-200';
      els.searchResultsContainer.innerHTML=res.map(card=>`<div class="p-2 cursor-pointer rounded ${hoverCls}" data-id="${card.id}">${card.french} ‚Äî ${card.english} (${card.chapter})</div>`).join('');
    }

    // Met une carte en t√™te du deck en √©vitant les doublons
    function putCardAtFront(deck, card) {
      const idStr = String(card.id);
      const rest = deck.filter(c => String(c.id) !== idStr);
      return [card, ...rest];
    }

    // Saute √† une carte par id (et bascule de chapitre si besoin)
    function jumpToCard(cardId, opts = {}) {
      const card = S.allCards.find(c => String(c.id) === String(cardId));
      if (!card) { showMsg('Carte introuvable', 'text-red-500', 1500); return; }

      const switchChapter = opts.switchChapter !== false;
      if (switchChapter && S.currentChapter !== card.chapter) {
        S.currentChapter = card.chapter;
        resetCycleForCurrentChapter();
        rebuildDeck();
        updateActiveChapterButtons();
        els.currentChapterLabel.textContent = S.currentChapter;
      } else if (!S.currentDeck.length) {
        rebuildDeck();
      }

      // Respect du cycle: si d√©j√† vue et d'autres non vues existent, on bloque le jump
      const base = baseListForCurrentChapter();
      const unseen = base.filter(c=>!S.cycle.seen[String(c.id)]);
      if (S.cycle.seen[String(card.id)] && unseen.length > 0) {
        showMsg('Cette carte a d√©j√† √©t√© vue dans ce cycle. Terminez le cycle pour la revoir.', 'text-amber-500 dark:text-amber-400', 2200);
        return;
      }

      S.currentDeck = putCardAtFront(S.currentDeck, card);
      S.currentIndex = 0;
      renderCard(1);
      autoSave();
    }

    // Events
    on(els.burgerButton,'click',()=>setMenuOpen(true));
    on(els.menuOverlay,'click',()=>setMenuOpen(false));
    on(els.closeMenuButton,'click',()=>setMenuOpen(false));

    on(els.menuChapters,'click',e=>{
      const btn=e.target.closest('button[data-chapter]'); if(!btn) return;
      const ch=btn.dataset.chapter; if(!ch||ch===S.currentChapter) { setMenuOpen(false); return; }
      // changement de chapitre => reset du cycle + reset session
      S.currentChapter=ch; resetCycleForCurrentChapter(); S.sessionNewShown=0; S.seenCountInSession=0;
      rebuildDeck(); renderCard(0); renderProgressBar(); updateActiveChapterButtons(); els.currentChapterLabel.textContent=S.currentChapter; autoSave();
      setMenuOpen(false);
    });

    on(els.resetDataButton,'click',()=>{
      const chapter=els.resetOptions.value||'Tout';
      const resetOne=c=>{
        const n=upgradeCardModel({id:c.id,french:c.french,english:c.english,chapter:c.chapter});
        Object.assign(c,n);
      };
      S.allCards.forEach(c=>{ if(chapter==='Tout'||c.chapter===chapter) resetOne(c); });
      if(chapter==='Tout'){ S.seenCountInSession=0; S.sessionNewShown=0; S.streak=0; S.maxStreak=0; S.dailyHistory={}; }
      // Reset cycle pour le chapitre choisi si c'est le courant
      if (chapter==='Tout' || chapter===S.currentChapter) resetCycleForCurrentChapter();

      rebuildDeck(); renderCard(0); renderStats(); renderSparkline(); renderProgressBar(); autoSave();
      showMsg('R√©initialis√©','text-orange-500 dark:text-yellow-400',1200);
    });

    on(els.darkModeToggle,'click',()=>setDarkMode(!S.darkMode));
    on(els.reverseModeButton,'click',()=>{S.reverseMode=!S.reverseMode; renderCard(0); autoSave()});
    on(els.themeSelector,'change',()=>autoSave());

    on(els.searchBar,'input',e=>{filterCardsForSearch(e.target.value)});
    on(els.searchResultsContainer,'click',e=>{
      const item=e.target.closest('[data-id]'); if(!item) return;
      const id = String(item.dataset.id);
      jumpToCard(id, { switchChapter: true });
      els.searchBar.value=''; els.searchResultsContainer.innerHTML='';
      setMenuOpen(false);
    });
    on(els.searchBar,'keydown',e=>{
      if(e.key==='Enter'){
        const first=els.searchResultsContainer.querySelector('[data-id]');
        if(first){
          jumpToCard(first.getAttribute('data-id'), { switchChapter: true });
          els.searchBar.value=''; els.searchResultsContainer.innerHTML='';
          setMenuOpen(false);
          e.preventDefault();
        }
      }
    });

    on(els.flashcardContainer,'click',()=>{
      if(!S.isRevealed){
        if(!els.answerInput.value.trim()){
          revealTranslation(); S.awaitingGrade=true; setGradeBarVisible(true); setSubmitVisible(false); setInputDisabled(true);
          showMsg('R√©v√©l√© ‚Äî 1 Encore, 2 Diff., 3 Bien, 4 Facile','text-sky-500 dark:text-sky-400',2000);
        }
      } else if(S.awaitingAdvance){ nextCard(); }
    });

    on(els.submitAnswerButton,'click',handleSubmitAnswer);
    on(els.answerInput,'input',()=>{ if(!S.answerStartAt && els.answerInput.value.trim().length>0) S.answerStartAt=Date.now(); });

    on(els.gradeBar,'click',e=>{
      const btn=e.target.closest('button[data-grade]'); if(!btn) return;
      const g=parseInt(btn.dataset.grade,10); if(S.awaitingGrade&&S.currentDeck.length) onGrade(g,{autoAdvance:true});
    });

    on(document,'keydown',e=>{
      const inField=document.activeElement===els.answerInput||document.activeElement===els.searchBar;
      if(e.key==='Enter'){ e.preventDefault(); if(S.awaitingAdvance){ nextCard(); return; } handleSubmitAnswer(); return; }
      if(inField) return;
      if(e.key===' '){ e.preventDefault(); if(S.awaitingAdvance){ nextCard(); } else if(!S.isRevealed && !els.answerInput.value.trim()){ revealTranslation(); S.awaitingGrade=true; setGradeBarVisible(true); setSubmitVisible(false); setInputDisabled(true); showMsg('R√©v√©l√© ‚Äî 1 Encore, 2 Diff., 3 Bien, 4 Facile','text-sky-500 dark:text-sky-400',2000); } }
      if(e.key==='1'){e.preventDefault(); if(S.awaitingGrade&&S.currentDeck.length) onGrade(1,{autoAdvance:true});}
      if(e.key==='2'){e.preventDefault(); if(S.awaitingGrade&&S.currentDeck.length) onGrade(2,{autoAdvance:true});}
      if(e.key==='3'){e.preventDefault(); if(S.awaitingGrade&&S.currentDeck.length) onGrade(3,{autoAdvance:true});}
      if(e.key==='4'){e.preventDefault(); if(S.awaitingGrade&&S.currentDeck.length) onGrade(4,{autoAdvance:true});}
    });

    // Stats & sparkline
    function renderStats(){
      const total = S.allCards.length;
      const reviewed = S.allCards.filter(c=>(c.revCount||0)>0).length;
      const newRemain = S.allCards.filter(c=>c.state==='new').length;
      const dueNow = S.allCards.filter(c=>(c.state!=='new')&&(c.nextDue||0)<=nowMs()).length;

      const totalReviews=Object.values(S.dailyHistory).reduce((s,r)=>s+(r.rev||0),0);
      const okReviews=Object.values(S.dailyHistory).reduce((s,r)=>s+(r.ok||0),0);
      const acc=totalReviews?Math.round(okReviews*100/totalReviews):0;
      const timeSum=Object.values(S.dailyHistory).reduce((s,r)=>s+(r.ms||0),0);
      const avgLatency=totalReviews?Math.round(timeSum/totalReviews):0;
      const avgScore=(i=>i.length?Math.round(i.reduce((a,b)=>a+b,0)/i.length):0)(S.allCards.map(c=>c.lastScorePct).filter(Number.isFinite));
      const avgInterval=(i=>i.length?Math.round(i.reduce((a,b)=>a+b,0)/i.length):0)(S.allCards.filter(c=>c.state==='review').map(c=>c.intervalDays||0));
      const avgEase=(i=>i.length?Math.round(i.reduce((a,b)=>a+b,0)/i.length*100)/100:0)(S.allCards.map(c=>c.ef||SRS_CFG.startEase));
      const today=isoDate(); const todayReviews=(S.dailyHistory[today]?.rev)||0;

      const cats = { low:0, mid:0, high:0 };
      const boxes = {1:0,2:0,3:0,4:0,5:0};
      for(const c of S.allCards){
        const s=c.masteryScore||0;
        if(s<50) cats.low++; else if(s<80) cats.mid++; else cats.high++;
        const b=clamp(c.box||1,1,5); boxes[b]++;
      }

      const mastered=S.allCards.filter(c=>(c.masteryScore||0)>=80).length;
      const fmt=ms=>ms<1000?`${ms}ms`:`${(ms/1000).toFixed(1)}s`;
      els.statsContent.innerHTML=`
        <div class="grid grid-cols-2 gap-y-1 gap-x-4">
          <div class="text-gray-500 dark:text-gray-400">Total de mots</div><div class="text-right font-semibold">${total}</div>
          <div class="text-gray-500 dark:text-gray-400">Mots revus</div><div class="text-right font-semibold">${reviewed}</div>
          <div class="text-gray-500 dark:text-gray-400">Nouvelles restantes</div><div class="text-right font-semibold">${newRemain}</div>
          <div class="text-gray-500 dark:text-gray-400">√Ä revoir maintenant</div><div class="text-right font-semibold">${dueNow}</div>
          <div class="text-gray-500 dark:text-gray-400">Total r√©visions</div><div class="text-right font-semibold">${totalReviews}</div>
          <div class="text-gray-500 dark:text-gray-400">Pr√©cision</div><div class="text-right font-semibold">${acc}%</div>
          <div class="text-gray-500 dark:text-gray-400">Temps moyen</div><div class="text-right font-semibold">${fmt(avgLatency)}</div>
          <div class="text-gray-500 dark:text-gray-400">Score moyen (saisie)</div><div class="text-right font-semibold">${avgScore}%</div>
          <div class="text-gray-500 dark:text-gray-400">Intervalle moyen</div><div class="text-right font-semibold">${avgInterval}j</div>
          <div class="text-gray-500 dark:text-gray-400">Facilit√© moyenne</div><div class="text-right font-semibold">${avgEase}</div>

          <div class="col-span-2 mt-2 border-t border-gray-200 dark:border-gray-700"></div>

          <div class="text-gray-500 dark:text-gray-400">Ma√Ætrise faible (&lt;50)</div><div class="text-right font-semibold">${cats.low}</div>
          <div class="text-gray-500 dark:text-gray-400">En progression (50‚Äì79)</div><div class="text-right font-semibold">${cats.mid}</div>
          <div class="text-gray-500 dark:text-gray-400">Ma√Ætris√©s (‚â•80)</div><div class="text-right font-semibold">${cats.high}</div>

          <div class="col-span-2 mt-2 border-t border-gray-200 dark:border-gray-700"></div>

          <div class="text-gray-500 dark:text-gray-400">Bo√Æte 1</div><div class="text-right font-semibold">${boxes[1]}</div>
          <div class="text-gray-500 dark:text-gray-400">Bo√Æte 2</div><div class="text-right font-semibold">${boxes[2]}</div>
          <div class="text-gray-500 dark:text-gray-400">Bo√Æte 3</div><div class="text-right font-semibold">${boxes[3]}</div>
          <div class="text-gray-500 dark:text-gray-400">Bo√Æte 4</div><div class="text-right font-semibold">${boxes[4]}</div>
          <div class="text-gray-500 dark:text-gray-400">Bo√Æte 5</div><div class="text-right font-semibold">${boxes[5]}</div>

          <div class="col-span-2 mt-2 border-t border-gray-200 dark:border-gray-700"></div>
          <div class="text-gray-500 dark:text-gray-400">R√©visions aujourd‚Äôhui</div><div class="text-right font-semibold">${todayReviews}</div>
        </div>`;
    }
    function daysBack(n){const a=[],t=new Date();for(let i=n-1;i>=0;i--){const d=new Date(t);d.setDate(t.getDate()-i);a.push(isoDate(d))}return a}
    function renderSparkline(){
      const svg=els.sparkline, path=els.sparkPath, fill=els.sparkFill, dot=els.sparkLast, legend=els.chartLegend; if(!svg||!path||!fill||!dot||!legend) return;
      const w=svg.clientWidth||260, h=svg.clientHeight||70, pad=6, days=daysBack(14), vals=days.map(d=>(S.dailyHistory[d]?.rev)||0), maxV=Math.max(1,...vals), dx=(w-2*pad)/(vals.length-1||1);
      const pts=vals.map((v,i)=>[pad+i*dx, h-pad - (v/maxV)*(h-2*pad-12)]);
      if(!pts.length){path.setAttribute('d','');fill.setAttribute('d','');return}
      const d='M '+pts.map(p=>p.join(',')).join(' L '); path.setAttribute('d',d);
      const first=pts[0], last=pts[pts.length-1]; fill.setAttribute('d', d+` L ${last[0]},${h-pad} L ${first[0]},${h-pad} Z`); dot.setAttribute('cx',String(last[0])); dot.setAttribute('cy',String(last[1]));
      const total14=vals.reduce((a,b)=>a+b,0), days7=days.slice(-7), rev7=days7.reduce((a,d)=>a+((S.dailyHistory[d]?.rev)||0),0), ok7=days7.reduce((a,d)=>a+((S.dailyHistory[d]?.ok)||0),0), acc7=rev7?Math.round(ok7*100/rev7):0;
      legend.textContent=`${total14} r√©visions ‚Ä¢ ${acc7}%/7j`;
    }

    // Init
    function initUI(){
      computeAvailableChapters();
      renderChapterButtons();
      renderResetOptions();
      rebuildDeck();
      renderCard(0);
      renderProgressBar();
      renderStats(); renderSparkline();
      setInterval(()=>{S.elapsedSeconds++; renderTimer(); if(S.elapsedSeconds%15===0) autoSave();},1000);
    }

    (()=>{
      const loaded=loadData();
      if(!loaded){ S.allCards=cardsRaw.map(upgradeCardModel); S.currentChapter='Tout'; }
      else { S.allCards=S.allCards.map(upgradeCardModel); }
      buildSearchIndex();
      computeAvailableChapters();
      document.body.classList.toggle('dark-mode',S.darkMode);
      document.body.classList.toggle('light-mode',!S.darkMode);
      els.darkModeToggle.innerHTML=S.darkMode?'‚òÄ':'üåô';
      initUI();
    })();
  </script>
</body>
</html>
