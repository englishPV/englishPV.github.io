<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Flashcards 9:16</title>
  <style>
    :root {
      --bg: #0b1020;
      --surface: #12172b;
      --card: #161c33;
      --muted: #8aa0d3;
      --text: #e6ecff;
      --primary: #6366f1;
      --primary-600: #5457e6;
      --green: #22c55e;
      --blue: #3b82f6;
      --amber: #f59e0b;
      --red: #ef4444;
      --ring: #e5e7eb;
      --border: #232a48;
 
      /* Variables globales UI (tailles, arrondis) */
      --fs-term: 20px;
      /* Front (recto) - un peu plus grand qu'avant */
      --fs-def: 24px;
      /* Back (verso) */
      --fs-front-list: 16px;
      /* Liste cartes: front */
      --fs-back-list: 18px;
      /* Liste cartes: back */
      --radius-md: 14px;
      /* Arrondi par d√©faut */
    }
 
    :root[data-theme="light"] {
      --bg: linear-gradient(180deg, #f8fafc 0%, #eef2f7 100%);
      --surface: #ffffff;
      --card: #ffffff;
      --text: #0f172a;
      /* Texte principal fonc√© */
      --muted: #475569;
      /* Texte secondaire lisible */
      --primary: #3b82f6;
      --primary-600: #2563eb;
      --border: #e2e8f0;
    }
 
    * {
      box-sizing: border-box
    }
 
    html,
    body {
      height: 100%
    }
 
    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
      font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      overflow: hidden;
      /* jamais de scroll vertical global */
    }
 
    .wrapper {
      height: 100dvh;
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
    }
 
    .phone {
      aspect-ratio: 9/16;
      height: 100%;
      width: auto;
      max-width: 100%;
      max-height: 100%;
      display: grid;
      grid-template-rows: 52px 1fr 52px 64px;
      /* top, main, actions, revision */
      background: transparent;
      /* fusion avec le fond */
      border-radius: 0;
      border: none;
      box-shadow: none;
      overflow: hidden;
      /* emp√™che tout scroll interne */
      position: relative;
      min-height: 0;
      /* pour les enfants flex */
      touch-action: pan-y;
      /* √©vite les overscroll */
    }
 
    .topbar {
      display: flex;
      align-items: center;
      padding: 0 10px;
      background: linear-gradient(180deg, rgba(255, 255, 255, 0.06), rgba(255, 255, 255, 0));
      border-bottom: 1px solid rgba(255, 255, 255, 0.06);
    }
 
    .topbar .back {
      appearance: none;
      border: 0;
      outline: 0;
      background: transparent;
      color: var(--text);
      padding: 8px 10px;
      margin-right: 4px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      font-weight: 700;
    }
 
    .topbar .back:hover {
      background: rgba(255, 255, 255, 0.06)
    }
 
    .topbar .title {
      font-weight: 800;
      font-size: 16px;
      letter-spacing: .2px;
      margin-left: 2px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
 
    .topbar .spacer {
      flex: 1
    }
 
    main#view {
      min-height: 0;
      overflow: hidden;
      /* AUCUN scroll vertical */
      padding: 8px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      justify-content: flex-start;
      /* pour tout tenir d'un coup d'oeil */
    }
 
    /* Cards (conteneurs UI) */
    .card {
      background: linear-gradient(180deg, rgba(255, 255, 255, 0.02), rgba(0, 0, 0, 0.10)), var(--card);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 10px;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.25), inset 0 0 0 1px rgba(255, 255, 255, 0.04);
    }
 
    .section-title {
      font-weight: 800;
      font-size: 13px;
      color: #c9d4ff;
      letter-spacing: .3px;
      margin: 0 0 6px 0;
    }
 
    .kpi {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }
 
    .kpi .k {
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 8px;
    }
 
    .k .label {
      color: var(--muted);
      font-size: 11px
    }
 
    .k .value {
      font-weight: 900;
      font-size: 16px;
      margin-top: 2px
    }
 
    /* Deck list (pagination pour rester sans scroll) */
    .deck-wrap {
      display: flex;
      align-items: center;
      gap: 8px;
    }
 
    .navbtn {
      appearance: none;
      border: 1px solid var(--border);
      outline: 0;
      background: rgba(255, 255, 255, 0.04);
      color: #e8edff;
      padding: 8px 10px;
      border-radius: 10px;
      font-weight: 800;
      cursor: pointer;
      min-width: 44px;
    }
 
    .navbtn:disabled {
      opacity: .4;
      cursor: not-allowed
    }
 
    .decks {
      display: grid;
      grid-template-columns: 1fr;
      gap: 8px;
      flex: 1;
    }
 
    .deck-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: linear-gradient(180deg, rgba(255, 255, 255, 0.02), rgba(0, 0, 0, 0.12));
      cursor: pointer;
    }
 
    .deck-item:hover {
      outline: 1px solid rgba(255, 255, 255, 0.08)
    }
 
    .deck-meta {
      color: var(--muted);
      font-size: 12px
    }
 
    .chip {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: rgba(255, 255, 255, 0.04);
      border: 1px solid var(--border);
      border-radius: 999px;
      padding: 6px 10px;
      font-size: 12px;
      color: #dbe4ff;
      cursor: pointer;
      user-select: none;
    }
 
    .chip.toggle {
      opacity: .75
    }
 
    .chip.toggle.active {
      opacity: 1;
      border-color: #6b7cff;
      box-shadow: inset 0 0 0 1px rgba(107, 124, 255, .35)
    }
 
    .legend {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 6px;
      margin-top: 6px
    }
 
    .legend-item {
      display: flex;
      align-items: center;
      gap: 6px;
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 6px 8px;
      font-size: 12px;
      color: #dbe4ff;
    }
 
    .dot {
      width: 10px;
      height: 10px;
      border-radius: 50%
    }
 
    .dot.red {
      background: var(--red)
    }
 
    .dot.amber {
      background: var(--amber)
    }
 
    .dot.blue {
      background: var(--blue)
    }
 
    .dot.green {
      background: var(--green)
    }
 
    /* Diagramme */
    .chart-wrap {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 200px
    }
 
    canvas#gradeChart {
      width: 180px;
      height: 180px
    }
 
    /* Filtres */
    .filters {
      display: grid;
      gap: 8px;
    }
 
    .filter-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px
    }
 
    .presets {
      display: flex;
      flex-wrap: wrap;
      gap: 6px
    }
 
    /* Bottom actions (Cartes / Param√®tres) */
    .bottom-actions {
      display: none;
      padding: 8px 10px;
      border-top: 1px solid rgba(255, 255, 255, 0.06);
      background: linear-gradient(180deg, rgba(255, 255, 255, 0), rgba(255, 255, 255, 0.04));
      gap: 8px;
      grid-template-columns: 1fr 1fr;
    }
 
    .bottom-actions .action {
      appearance: none;
      border: 1px solid var(--border);
      outline: 0;
      background: rgba(255, 255, 255, 0.04);
      color: #e8edff;
      width: 100%;
      padding: 10px;
      border-radius: 12px;
      font-weight: 800;
      cursor: pointer;
      font-size: 14px;
    }
 
    .bottom-actions .action:hover {
      border-color: rgba(255, 255, 255, 0.12)
    }
 
    /* Revision sticky bar */
    .revision-bar {
      padding: 8px 10px calc(8px + env(safe-area-inset-bottom));
      border-top: 1px solid rgba(255, 255, 255, 0.08);
      background: linear-gradient(180deg, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.15)), rgba(10, 15, 35, 0.7);
      backdrop-filter: blur(8px) saturate(140%);
      display: none;
    }
 
    .rev-btn {
      appearance: none;
      border: 0;
      outline: 0;
      width: 100%;
      background: linear-gradient(180deg, var(--primary), var(--primary-600));
      color: white;
      padding: 12px 14px;
      border-radius: 12px;
      font-weight: 900;
      letter-spacing: .3px;
      cursor: pointer;
      box-shadow: 0 10px 30px rgba(99, 102, 241, 0.35);
      font-size: 14px;
    }
 
    .rev-btn[disabled] {
      opacity: .5;
      cursor: not-allowed;
      box-shadow: none
    }
 
    /* Review view */
    .review-wrap {
      height: 100%;
      display: flex;
      flex-direction: column;
    }
 
    .review-top {
      display: flex;
      align-items: center;
      justify-content: space-between;
      color: var(--muted);
      font-size: 12px;
    }
 
    .review-card {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 14px;
      border: 1px dashed var(--border);
      background: linear-gradient(180deg, rgba(255, 255, 255, 0.02), rgba(0, 0, 0, 0.10));
      padding: 12px;
      text-align: center;
    }
 
    .review-actions {
      margin-top: auto;
      padding-bottom: calc(6px + env(safe-area-inset-bottom));
    }
 
    .btn {
      appearance: none;
      border: 1px solid var(--border);
      outline: 0;
      background: rgba(255, 255, 255, 0.04);
      color: #e8edff;
      padding: 10px;
      border-radius: 12px;
      font-weight: 900;
      cursor: pointer;
      width: 100%;
      font-size: 14px;
    }
 
    .row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 6px
    }
 
    .btn.red {
      background: rgba(239, 68, 68, .12);
      border-color: rgba(239, 68, 68, .35);
      color: #fecaca
    }
 
    .btn.amber {
      background: rgba(245, 158, 11, .12);
      border-color: rgba(245, 158, 11, .35);
      color: #fde68a
    }
 
    .btn.blue {
      background: rgba(59, 130, 246, .12);
      border-color: rgba(59, 130, 246, .35);
      color: #bfdbfe
    }
 
    .btn.green {
      background: rgba(34, 197, 94, .12);
      border-color: rgba(34, 197, 94, .35);
      color: #bbf7d0
    }
 
    /* Cards view (sans scroll, pagination) */
    .cards-wrap {
      display: flex;
      flex-direction: column;
      gap: 8px;
      height: 100%
    }
 
    .cards-top {
      display: flex;
      align-items: center;
      justify-content: space-between;
      color: var(--muted);
      font-size: 12px
    }
 
    .viewer {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 1px solid var(--border);
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.03);
      padding: 12px;
      text-align: center;
    }
 
    .viewer .front {
      font-weight: 900;
      font-size: 20px
    }
 
    .viewer .back {
      color: #d9e6ff;
      opacity: .95;
      font-size: 15px;
      margin-top: 6px
    }
 
    .viewer-actions {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 6px
    }
 
    .small {
      font-size: 12px;
      color: var(--muted)
    }
 
    /* Recap */
    .recap {
      display: flex;
      flex-direction: column;
      gap: 8px
    }
 
    .recap h2 {
      margin: 0;
      font-size: 18px
    }
 
    .recap .subtitle {
      color: var(--muted);
      margin-top: -2px;
      font-size: 12px
    }
 
    .recap .grid2 {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 6px
    }
 
    .stat {
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 8px
    }
 
    .label {
      color: var(--muted);
      font-size: 11px
    }
 
    .val {
      font-weight: 900;
      font-size: 16px;
      margin-top: 2px
    }
 
    .cta {
      margin-top: 4px
    }
 
    /* Helpers */
    .muted {
      color: var(--muted)
    }
 
    .hidden {
      display: none !important
    }
 
    .center {
      text-align: center
    }
 
    .mt6 {
      margin-top: 6px
    }
 
    .mt8 {
      margin-top: 8px
    }
 
    .scroll-y {
      overflow: auto;
      -webkit-overflow-scrolling: touch;
      overscroll-behavior: contain;
      touch-action: pan-y;
    }
 
    .list {
      display: flex;
      flex-direction: column;
      gap: 8px
    }
 
    .stack {
      display: flex;
      flex-direction: column;
      gap: 6px
    }
 
    .face-label {
      font-size: 11px;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: .3px
    }
 
    .flexcol {
      display: flex;
      flex-direction: column;
      min-height: 0
    }
 
    .row-4 {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 8px;
      width: 100%
    }
 
    /* Texte Q/R */
    .term {
      font-size: var(--fs-term) !important;
      font-weight: 600
    }
 
    .definition {
      font-size: var(--fs-def) !important;
      font-weight: 900
    }
 
    /* Liste des cartes (vue Cartes) */
    .card-item .front {
      font-size: var(--fs-front-list);
      font-weight: 600
    }
 
    .card-item .back {
      font-size: var(--fs-back-list);
      font-weight: 800;
      color: var(--text);
      opacity: .95
    }
 
    /* Arrondis pilot√©s par variable */
    .card,
    .deck-item,
    .review-card,
    .btn,
    .chip,
    .action,
    .viewer,
    .card-item {
      border-radius: var(--radius-md) !important;
    }
 
    .legend-item {
      cursor: pointer;
      user-select: none;
      transition: opacity .15s ease, filter .15s ease
    }
 
    .legend-item.inactive {
      opacity: .45;
      filter: grayscale(20%)
    }
 
    /* Assure la lisibilit√© en th√®me clair */
    :root[data-theme="light"] .definition,
    :root[data-theme="light"] .card-item .back {
      color: var(--text) !important;
      opacity: 1 !important;
    }
 
    :root[data-theme="light"] .muted {
      color: var(--muted) !important;
    }
 
    :root[data-theme="light"] .review-card {
      border-color: var(--border) !important;
      background: #ffffff !important;
    }
 
    :root[data-theme="light"] .btn,
    :root[data-theme="light"] .chip {
      color: var(--text) !important;
    }
 
    /* Wheel (contr√¥le de taille) */
    .wheel {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 12px;
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      background: rgba(255, 255, 255, 0.04);
      touch-action: none;
      user-select: none;
      cursor: ns-resize;
    }
 
    .wheel .name {
      font-weight: 800
    }
 
    .wheel .hint {
      color: var(--muted);
      font-size: 12px
    }
 
    .wheel .wheel-value {
      margin-left: auto;
      font-weight: 900
    }
  </style>
</head>
<body>
  <div class="wrapper">
    <div class="phone" id="app">
      <header class="topbar">
        <button class="back" id="backBtn" title="Retour"> <span aria-hidden="true">‚Üê</span> <span>Retour</span> </button>
        <div class="title" id="title">Deck</div>
        <div class="spacer"></div>
      </header>
 
      <main id="view"></main>
 
      <div class="bottom-actions" id="bottomActions">
        <button class="action" id="cardsBtn">Cartes</button>
        <button class="action" id="settingsBtn">Param√®tres</button>
      </div>
 
      <footer class="revision-bar" id="revisionBar">
        <button id="startReviewBtn" class="rev-btn">R√©vision ‚Ä¢ 10 cartes</button>
      </footer>
    </div>
  </div>
  <script>
    // ------------------ Donn√©es & stockage ------------------
    const STORAGE_KEY = 'flash9x16_data_v3';
 
    // === ZONE DE COLLAGE DES DONN√âES BRUTES ===
    // Cat√©gories (constantes)
    const CD = "Democracy",
      CG = "Genetics",
      CI = "Immigration",
      CIT = "Relations internationales",
      CU = "Travail",
      CR = "Crime";
 
    // Emoji par chapitre (optionnel pour l‚Äôaffichage)
    const CHAPTER_EMOJIS = {
      [CD]: 'üèõÔ∏è',
      [CG]: 'üß¨',
      [CI]: 'üß≥',
      [CIT]: 'üåê',
      [CU]: 'üíº',
      [CR]: '‚öñÔ∏è',
      'Politique': 'üèõÔ∏è',
      'Business': 'üíº',
      'Education': 'üéì',
      'Thanksgiving': 'ü¶É'
    };
 
    // Collez ici votre longue liste (id|fran√ßais|anglais|${CHAP})
    const cardsRawText = `
0|monarchie|monarchy|${CD}
1|monarque de droit divin|a monarch by divine right|${CD}
2|souverain|sovereign|${CD}
3|aristocratie|aristocracy|${CD}
4|oligarchie|oligarchy|${CD}
5|dictateur|a dictator|${CD}
6|dictature|dictatorship|${CD}
7|autoritaire|authoritarian|${CD}
8|autoritarisme|authoritarianism|${CD}
9|totalitaire|totalitarian|${CD}
10|totalitarisme|totalitarianism|${CD}
11|homme fort|a strongman|${CD}
12|tyran|a tyrant, an autocrat|${CD}
13|despote|a despot|${CD}
14|despote √©clair√©|an enlightened despot|${CD}
15|junte militaire|a military junta|${CD}
16|coup d'√âtat|a coup, a coup d'√©tat|${CD}
17|gouvernement autoritaire|a regime|${CD}
18|r√©gime de Vichy / de Pinochet|the Vichy / Pinochet regime|${CD}
19|r√©gime r√©pressif|a repressive regime|${CD}
20|r√©gime politique|a political system|${CD}
21|se d√©mocratiser|to become more democratic|${CD}
22|prendre le pouvoir|to take, seize power|${CD}
23|arriver au pouvoir|to come to power|${CD}
24|arriver au pouvoir (d√©mocratiquement)|to come into office|${CD}
25|√™tre au pouvoir|to be in power|${CD}
26|rester au pouvoir|to remain, stay in power|${CD}
27|s'accrocher au pouvoir|to cling to power|${CD}
28|bonne gouvernance|good governance|${CD}
29|mal administrer, mal g√©rer|to misrule, mismanage|${CD}
30|mauvaise administration|misrule|${CD}
31|mauvaise gestion|mismanagement|${CD}
32|tenir un dirigeant pour responsable|to hold a leader to account|${CD}
33|√™tre responsable devant les √©lecteurs|to be accountable to the electorate|${CD}
34|responsabilit√©|accountability|${CD}
35|corruption|corruption, sleaze, bribery|${CD}
36|corrompu|corrupt|${CD}
37|pot-de-vin|a bribe|${CD}
38|acheter, soudoyer qn|to bribe sb|${CD}
39|√©tat de droit, r√®gne de la loi|the rule of law|${CD}
40|multipartisme|multi-party system|${CD}
41|syst√®me de parti unique|single-party system|${CD}
42|√©lections libres et r√©guli√®res|free and fair elections|${CD}
43|fraude √©lectorale|vote rigging, ballot rigging, electoral fraud|${CD}
44|l'√©lection √©tait truqu√©e|the election was rigged|${CD}
45|opposant politique|a political opponent|${CD}
46|dissident|a dissident|${CD}
47|b√¢illonner / museler la presse / l'opposition|to gag / muzzle the press / the opposition|${CD}
48|d√©clarer l'√©tat d'urgence|to declare a state of emergency|${CD}
49|bafouer la constitution|to trample the constitution|${CD}
50|censurer|to censor|${CD}
51|censure|censorship|${CD}
52|bloquer / restreindre l'acc√®s √† internet|to block / restrict internet access|${CD}
53|contourner la censure|to circumvent, bypass censorship|${CD}
54|droits de l'homme|human rights|${CD}
55|atteintes aux droits de l'homme|human rights abuses, violations|${CD}
56|crime contre l'humanit√©|a crime against humanity|${CD}
57|devoir d'ing√©rence|the duty to interfere, to intervene|${CD}
58|association de d√©fense des droits de l'homme|human Rights lobby|${CD}
59|pass√© de la Chine en mati√®re de droits de l'homme|China's human rights record|${CD}
60|m√©contentement, malaise|discontent|${CD}
61|provoquer des troubles|to spark unrest|${CD}
62|agitation|turmoil|${CD}
63|bouleversement|an upheaval|${CD}
64|fomenter des troubles|to stir up trouble|${CD}
65|insurg√©|an insurgent|${CD}
66|insurrection|an insurgency|${CD}
67|manifestation|a demonstration, a protest march|${CD}
68|manifestant|a demonstrator, a protester|${CD}
69|organiser / participer √† un rassemblement|to hold / attend a rally|${CD}
70|√©meute|a riot|${CD}
71|√©meutier, casseur|a rioter|${CD}
72|des √©meutes ont √©clat√©|riots broke out|${CD}
73|CRS|anti-riot police|${CD}
74|cocktail Molotov|a petrol bomb, a Molotov cocktail|${CD}
75|gaz lacrymog√®ne|tear gas|${CD}
76|heurt, affrontement|a clash|${CD}
77|√©chauffour√©e|a skirmish|${CD}
78|complot|a plot|${CD}
79|comploteur|a plotter|${CD}
80|se r√©volter|to revolt|${CD}
81|se rebeller|to rebel|${CD}
82|rebelle|a rebel|${CD}
83|r√©bellion, r√©volte|a rebellion|${CD}
84|d√©jouer les autorit√©s|to defy the authorities|${CD}
85|soul√®vement|an uprising|${CD}
86|se soulever contre|to rise up against|${CD}
87|renverser un dictateur|to overthrow, to topple a dictator|${CD}
88|√©vincer un dictateur|to oust a dictator|${CD}
89|renversement d'un dictateur|the overthrow of a dictator|${CD}
90|d√©poser un dirigeant|to depose a ruler|${CD}
91|s'effondrer|to collapse|${CD}
92|restaurer la d√©mocratie|to restore democracy|${CD}
93|chute d'un gouvernement|the downfall of a government|${CD}
94|r√©pression brutale|ruthless repression|${CD}
95|r√©primer une r√©bellion|to put down, to suppress a rebellion|${CD}
96|r√©primer, √©touffer la contestation|to quell the protests|${CD}
97|mesures de r√©pression|crackdown, clampdown|${CD}
98|mettre les gens en prison|to send people to prison|${CD}
99|passer qn √† tabac|to beat sb up|${CD}
100|g√®ne|a gene|${CG}
101|cellule|a cell|${CG}
102|cellules-souches|stem cells|${CG}
103|recherche sur les cellules souches|stem-cell research|${CG}
104|g√©nome humain|the human genome|${CG}
105|cartographie du g√©nome|genome mapping|${CG}
106|carte g√©n√©tique|gene map, genetic map|${CG}
107|s√©quence g√©n√©tique|gene sequence|${CG}
108|s√©quen√ßage|sequencing|${CG}
109|√©pissage du g√®ne|gene splicing|${CG}
110|patrimoine h√©r√©ditaire|gene pool|${CG}
111|g√©n√©ticien|a geneticist|${CG}
112|eug√©nisme|eugenics|${CG}
113|eug√©niste, partisan de l'eug√©nisme|a eugenicist|${CG}
114|ADN|DNA|${CG}
115|test g√©n√©tique|a DNA test|${CG}
116|empreinte g√©n√©tique|a DNA print, genetic print|${CG}
117|analyse ADN|DNA analysis|${CG}
118|pr√©l√®vement d'ADN|a DNA sample|${CG}
119|profil g√©n√©tique|genetic make-up, genetic profile|${CG}
120|analyse de l'empreinte g√©n√©tique|genetic profiling, DNA fingerprinting|${CG}
121|d√©pistage g√©n√©tique|genetic screening|${CG}
122|subir un pr√©l√®vement d'ADN|to be DNA-swabbed|${CG}
123|manipulations g√©n√©tiques, g√©nie g√©n√©tique|genetic engineering|${CG}
124|transg√©nique|transgenic|${CG}
125|organisme g√©n√©tiquement modifi√©|a genetically modified organism|${CG}
126|OGM|GMOs|${CG}
127|aliments contenant des OGM|GM food|${CG}
128|pommes de terres g√©n√©tiquement modifi√©es|GM potatoes|${CG}
129|produits transg√©niques|biotech products|${CG}
130|semence, graines|seed|${CG}
131|soja|soyabeans|${CG}
132|colza|rapeseed|${CG}
133|ma√Øs|maize (GB), corn (US)|${CG}
134|bl√©|wheat|${CG}
135|culture, r√©colte|a crop|${CG}
136|essais sur le terrain|field trials, crop trials|${CG}
137|culture OGM|a GM crop|${CG}
138|rendement|yield|${CG}
139|fili√®re agroalimentaire|agribusiness|${CG}
140|augmenter, am√©liorer les rendements|to improve yields|${CG}
141|r√©sistant aux maladies|resistant to disease|${CG}
142|insecticide / pesticide / herbicide|insecticide / pesticide / herbicide|${CG}
143|polliniser|to pollinate|${CG}
144|pollinisation crois√©e|cross-pollination|${CG}
145|contaminer|to contaminate|${CG}
146|contamination|contamination|${CG}
147|maladie g√©n√©tique|a genetic disease|${CG}
148|g√®ne d√©fectueux|a faulty gene|${CG}
149|g√®ne manquant|a missing gene|${CG}
150|h√©r√©ditaire|hereditary|${CG}
151|chromosome X / Y|an X / Y chromosome|${CG}
152|clonage|cloning|${CG}
153|conseil g√©n√©tique|genetic counselling|${CG}
154|entreprise pharmaceutique|a pharmaceutical company|${CG}
155|th√©rapie g√©nique|gene therapy|${CG}
156|traitement g√©nique|genetic treatment|${CG}
157|√† des fins th√©rapeutiques|for therapeutic purposes|${CG}
158|agriculture au service de la m√©decine|pharming|${CG}
159|jouer √† l'apprenti-sorcier|to play God|${CG}
160|toucher √† la nature|to tamper with nature|${CG}
161|principe de pr√©caution|the precautionary principle, the safety-first principle|${CG}
162|√©tiquette|a label|${CG}
163|√©tiquetter|to label|${CG}
164|√©tiquetage|labelling|${CG}
165|avertir|to warn|${CG}
166|avertissement|a warning|${CG}
167|dont l'origine peut √™tre √©tablie|traceable|${CG}
168|tra√ßabilit√©|traceability|${CG}
169|effets √† long terme|long-term effects|${CG}
170|cha√Æne alimentaire|the food chain|${CG}
171|s√©curit√© alimentaire|food security|${CG}
172|lobby OGM|the pro-GM lobby|${CG}
173|militants contre les OGM|anti-GM activists|${CG}
174|campagne contre les OGM|an anti-GM campaign|${CG}
175|√©tranger|a foreigner|${CI}
176|inconnu|a stranger|${CI}
177|nationalit√©|nationality|${CI}
178|ressortissant √©tranger|a foreign national|${CI}
179|personnes de nationalit√© fran√ßaise|French citizens|${CI}
180|√©migrer en Nouvelle-Z√©lande|to emigrate to New Zealand|${CI}
181|immigrer en France|to immigrate to France|${CI}
182|vague d'immigration|a wave of immigration|${CI}
183|immigration √† grande √©chelle / de masse|large-scale / mass immigration|${CI}
184|exode|an exodus|${CI}
185|nouvel arrivant|a newcomer|${CI}
186|pays natal, pays d'origine|native country, home country|${CI}
187|patrie|homeland|${CI}
188|pays d'accueil|a host country|${CI}
189|pays d'adoption|an adoptive country, a country of adoption|${CI}
190|accueillir|to welcome|${CI}
191|accueillant|welcoming|${CI}
192|politique migratoire|immigration policy|${CI}
193|immigration choisie|selective immigration, controlled immigration|${CI}
194|flux migratoires|migration flows|${CI}
195|passager clandestin|a stowaway|${CI}
196|immigration clandestine, irr√©guli√®re|illegal immigration|${CI}
197|immigration sauvage|uncontrolled immigration|${CI}
198|immigrant clandestin, sans-papiers|an illegal immigrant, an illegal alien, an undocumented alien|${CI}
199|il est en situation irr√©guli√®re|his papers are not in order|${CI}
200|fronti√®re|a border, a frontier|${CI}
201|fermer ses fronti√®res|to close one's borders|${CI}
202|contr√¥les aux fronti√®res|border controls|${CI}
203|contr√¥les d'identit√©|identity checks|${CI}
204|centre de r√©tention (administrative)|a holding centre, a detention facility|${CI}
205|passeport|a passport|${CI}
206|carte d'identit√©|an identity card|${CI}
207|visa|a visa|${CI}
208|r√©fugi√©|a refugee|${CI}
209|personne d√©plac√©e|a displaced person|${CI}
210|apatride|a stateless person|${CI}
211|se r√©fugier|to take refuge, take shelter|${CI}
212|demander l'asile politique|to seek political asylum|${CI}
213|demandeur d'asile|an asylum-seeker|${CI}
214|fuir la pers√©cution / la mis√®re|to flee persecution / destitution|${CI}
215|√©chapper √† la pauvret√©|to escape poverty|${CI}
216|chercher de meilleures conditions de vie|to be in search of better living conditions|${CI}
217|trafic des √™tres humains|human trafficking|${CI}
218|contrebandier, passeur|a smuggler|${CI}
219|passeurs d'immigrants clandestins|people-smugglers|${CI}
220|r√©seau de passeurs|a smuggling ring|${CI}
221|faux passeport|a fake passport|${CI}
222|reconduire qn √† la fronti√®re|to escort sb back to the border|${CI}
223|renvoyer un immigrant dans son pays d'origine|to send an immigrant back to his native country|${CI}
224|expulser qn|to deport sb|${CI}
225|√™tre refoul√© √† la fronti√®re|to be turned away at the border|${CI}
226|√™tre expuls√©|to be ordered out of the country|${CI}
227|s'exiler|to go into exile|${CI}
228|exil√©|an exile|${CI}
229|exiler, bannir qn|to exile, banish sb|${CI}
230|s'expatrier|to expatriate oneself|${CI}
231|expatri√©|an expatriate, an expat|${CI}
232|passer √† l'Ouest / √† l'ennemi|to defect to the West / to the enemy|${CI}
233|fuite des cerveaux / afflux des cerveaux|brain drain / brain gain|${CI}
234|partir de rien|to start from scratch|${CI}
235|travail au noir|moonlighting|${CI}
236|atelier clandestin|a sweatshop|${CI}
237|exploiter les travailleurs immigr√©s|to exploit migrant workers|${CI}
238|permis de travail, carte de travail|a work permit|${CI}
239|permis de s√©jour, carte de s√©jour|a residence permit, a resident permit|${CI}
240|travailleur migrant|a migrant worker|${CI}
241|travailleur invit√© (disposant d'un visa temporaire)|a guest worker|${CI}
242|s'int√©grer|to become integrated|${CI}
243|bien s'int√©grer dans une soci√©t√©|to integrate well into a society|${CI}
244|insertion sociale|social integration|${CI}
245|r√©gulariser la situation des clandestins|to regularise the status of illegal immigrants|${CI}
246|r√©gularisation|regularisation|${CI}
247|se faire naturaliser britannique, √™tre naturalis√© britannique, obtenir la nationalit√© britannique|to be granted British citizenship, to become a British citizen|${CI}
248|quota|a quota|${CI}
249|regroupement familial|family reunion, reunification|${CI}
250|qn qui abuse du syst√®me des prestations sociales|a benefit cheat|${CI}
251|fraude aux prestations sociales|benefit fraud|${CI}
252|parasite|a freeloader|${CI}
253|mariage blanc|a sham marriage, a marriage of convenience|${CI}
254|inonder|to flood|${CI}
255|√™tre envahi par les √©trangers|to be swamped with foreigners|${CI}
256|arriv√©e massive, afflux de travailleurs|the influx of workers|${CI}
257|endiguer l'afflux d'immigr√©s|to stem the flow of immigrants|${CI}
258|limiter / freiner l'immigration|to restrict / curb immigration|${CI}
259|parti d'extr√™me-droite|a far-right party|${CI}
260|faire fuir les immigrants|to scare immigrants away|${CI}
261|emp√™cher les ind√©sirables d'entrer|to keep out undesirables|${CI}
262|x√©nophobie|xenophobia|${CI}
263|x√©nophobe|xenophobic|${CI}
264|avoir un grand-p√®re n√© √† l'√©tranger|to have a foreign-born grandfather|${CI}
265|jeunes gens d'origine asiatique / portugaise|young men of Asian / Portuguese descent|${CI}
266|Fran√ßais de naissance|a native of France|${CI}
267|New Yorkais de souche|a born and bred New Yorker|${CI}
268|il est fran√ßais de souche|he's of French origin, of French extraction|${CI}
269|Maghreb|North Africa|${CI}
270|Maghr√©bins|North Africans|${CI}
271|pakistanais / du Bangladesh|Pakistani / Bangladeshi|${CI}
272|hispanophone / parlant le Hindi|Spanish-speaking / Hindi-speaking|${CI}
273|diaspora|diaspora|${CI}
274|affaires √©trang√®res|foreign affairs|${CIT}
275|relations ext√©rieures|foreign relations|${CIT}
276|communaut√© internationale|the international community|${CIT}
277|probl√®me mondial, plan√©taire|a global issue|${CIT}
278|√âtat souverain|a sovereign state|${CIT}
279|souverainet√©|sovereignty|${CIT}
280|√âtat-nation|a nation-state|${CIT}
281|fronti√®re|a border, a frontier|${CIT}
282|droit international|international law|${CIT}
283|g√©opolitique|geopolitics|${CIT}
284|sc√®ne internationale|the international stage, the international scene, the world stage|${CIT}
285|jouer un r√¥le dans qch|to play a role, a part in sth|${CIT}
286|occidental / oriental|western / eastern|${CIT}
287|politique √©trang√®re, ext√©rieure|foreign policy|${CIT}
288|ambassadeur|an ambassador|${CIT}
289|ambassade|an embassy|${CIT}
290|attach√© culturel / commercial / militaire|a cultural / commercial / military attach√©|${CIT}
291|envoy√©, √©missaire|an envoy, an emissary|${CIT}
292|diplomate|a diplomat|${CIT}
293|diplomatie|diplomacy|${CIT}
294|rompre / reprendre les relations|to break off / resume diplomatic relations|${CIT}
295|relations tendues|tense, strained relations|${CIT}
296|r√©chauffement|a thaw|${CIT}
297|refroidissement|a chill, a cooling off|${CIT}
298|rappeler un ambassadeur|to recall an ambassador|${CIT}
299|normaliser les relations|to normalize relations|${CIT}
300|grande puissance|a great power|${CIT}
301|superpuissance / hyperpuissance|a superpower / a hyperpower|${CIT}
302|h√©g√©monie|hegemony|${CIT}
303|imp√©rialisme|imperialism|${CIT}
304|imp√©rialiste|imperialistic|${CIT}
305|expansionisme|expansionism|${CIT}
306|unilat√©ralisme / multilat√©ralisme|unilateralism / multilateralism|${CIT}
307|bilat√©ral / multilat√©ral|bilateral / multilateral|${CIT}
308|bipolaire / multipolaire|bipolar / multipolar|${CIT}
309|bloc|a bloc|${CIT}
310|√©quilibre des forces|balance of power|${CIT}
311|syst√®me onusien|the UN system|${CIT}
312|√âtat-membre, pays membre|a member state|${CIT}
313|membre fondateur|a founding member, founder member|${CIT}
314|cotisation|a contribution|${CIT}
315|discuter / voter une r√©solution|to debate / to pass a resolution|${CIT}
316|appliquer une r√©solution|to implement, enforce a resolution|${CIT}
317|autoriser l'usage de la force|to authorize the use of force|${CIT}
318|embargo|an embargo|${CIT}
319|majorit√© des deux-tiers|a two-thirds majority|${CIT}
320|maintenir la paix|to maintain peace|${CIT}
321|op√©ration de maintien de la paix|a peace-keeping operation|${CIT}
322|soldat de la paix|a peacekeeper|${CIT}
323|casque bleu|a blue helmet|${CIT}
324|devoir d'ing√©rence|the duty to interfere, to intervene|${CIT}
325|intervention militaire|military intervention|${CIT}
326|OTAN|NATO, the North Atlantic Treaty Organization|${CIT}
327|n√©gocier|to negotiate|${CIT}
328|n√©gociations, pourparlers, discussions|negotiations, talks|${CIT}
329|table des n√©gociations|negotiating table|${CIT}
330|table ronde|a round table|${CIT}
331|faire une d√©claration|to make, issue, deliver a statement|${CIT}
332|communiqu√©|a communiqu√©|${CIT}
333|sous l'√©gide de|under the aegis of|${CIT}
334|r√©union au sommet, sommet|a summit (meeting)|${CIT}
335|porte-parole|a spokesman, spokeswoman, spokesperson|${CIT}
336|homologue|a counterpart, an opposite number|${CIT}
337|impasse|a stalemate, a deadlock, a standoff, an impasse|${CIT}
338|aboutir √† une impasse|to reach a stalemate|${CIT}
339|sortir d'une impasse|to break a stalemate|${CIT}
340|ultimatum|an ultimatum|${CIT}
341|m√©diateur|a mediator|${CIT}
342|n√©gocier un accord|to broker an agreement|${CIT}
343|surmonter un obstacle|to overcome an obstacle|${CIT}
344|volont√© politique|political will|${CIT}
345|compromis|a compromise|${CIT}
346|transiger|to compromise|${CIT}
347|faire une concession|to make a concession|${CIT}
348|s'engager √† faire qch|to commit oneself to doing sth|${CIT}
349|promettre de faire, s'engager √† faire qch|to pledge to do sth|${CIT}
350|signer / ratifier un trait√©|to sign / ratify a treaty|${CIT}
351|protocole|a protocol|${CIT}
352|accord|an agreement, an accord|${CIT}
353|conclure un accord|to reach a settlement|${CIT}
354|stipuler|to stipulate|${CIT}
355|parvenir √† un consensus|to reach a consensus|${CIT}
356|interdire|to prohibit, to ban|${CIT}
357|mettre son v√©to √† une d√©cision|to veto a decision|${CIT}
358|Union Europ√©enne, l'UE|the European Union, the EU|${CIT}
359|directive europ√©enne|an EU directive|${CIT}
360|adh√©rer √† l'UE|to join the EU|${CIT}
361|demander son adh√©sion √† l'UE|to apply to join the EU, to apply for EU membership|${CIT}
362|pourparlers d'adh√©sion|membership negotiations|${CIT}
363|organisation non-gouvernementale, ONG|a non-governmental organization, an NGO|${CIT}
364|droits de l'homme|human rights|${CIT}
365|violations des droits de l'homme|human rights abuses, violations|${CIT}
366|faire respecter un principe|to uphold a principle|${CIT}
367|pass√© de la Chine en mati√®re de droits de l'homme|China's human Rights record|${CIT}
368|d√©colonisation|decolonization|${CIT}
369|obtenir l'ind√©pendance, devenir ind√©pendant|to achieve, gain, attain independence|${CIT}
370|ancienne colonie|a former colony|${CIT}
371|puissance coloniale|a colonial power|${CIT}
372|du travail|work|${CU}
373|un travail, un emploi|a job|${CU}
374|une profession, une activit√© professionnelle|an occupation|${CU}
375|les professions lib√©rales|the professions|${CU}
376|une carri√®re|a career|${CU}
377|le monde du travail|the world of work|${CU}
378|√™tre au travail|to be at work|${CU}
379|le lieu de travail|the workplace|${CU}
380|travailler chez soi|to work from home|${CU}
381|travailler √† temps partiel OU √† mi-temps|to work part time|${CU}
382|travailler √† plein temps|to work full time|${CU}
383|la classe ouvri√®re|the working class|${CU}
384|la population active|the working population|${CU}
385|la vie active|the working life|${CU}
386|conditions de travail|working conditions|${CU}
387|atelier|a workshop|${CU}
388|usine|a factory, a plant|${CU}
389|atelier clandestin (o√π la main d'≈ìuvre est exploit√©e)|a sweatshop|${CU}
390|travailler beaucoup|to work hard|${CU}
391|√™tre travailleur|to be hard-working|${CU}
392|travailleur acharn√©, bourreau de travail|a hard worker, a workaholic|${CU}
393|permis de travail|a work permit|${CU}
394|√™tre / ne pas √™tre de service OU de garde|to be on duty / off duty|${CU}
395|ch√¥mage|unemployment, joblessness|${CU}
396|√™tre au ch√¥mage|to be unemployed, jobless, out of work|${CU}
397|taux de ch√¥mage|unemployment rate, jobless rate|${CU}
398|ch√¥meurs|the unemployed, the jobless|${CU}
399|ch√¥mage de longue dur√©e|long-term unemployment|${CU}
400|ch√¥mage des jeunes|youth unemployment|${CU}
401|allocation ch√¥mage|unemployment benefit|${CU}
402|toucher le ch√¥mage|to be on the dole (GB), to be on welfare (US)|${CU}
403|march√© du travail, de l'emploi|job market, labour market|${CU}
404|contrat √† dur√©e d√©termin√©e, CDD|a fixed-term contract|${CU}
405|contrat √† dur√©e ind√©termin√©e, CDI|an open-ended contract|${CU}
406|flexibilit√© de l'emploi|job flexibility|${CU}
407|avoir des horaires flexibles|work flexitime (GB) flextime (US)|${CU}
408|s√©curit√© / pr√©carit√© de l'emploi|job security / insecurity|${CU}
409|stage|an internship, a work placement|${CU}
410|stagiaire|an intern, a trainee|${CU}
411|travailleur pr√©caire|a casual worker|${CU}
412|petit boulot|an odd job, a casual job|${CU}
413|boulot d'√©t√©|a summer job|${CU}
414|int√©rimaire|a temporary worker|${CU}
415|faire de l'int√©rim|to temp, to work as a temp|${CU}
416|employer|to employ|${CU}
417|employeur|an employer|${CU}
418|employ√©|an employee|${CU}
419|changer de travail|to change jobs|${CU}
420|embaucher un travailleur|to hire, to take on a worker|${CU}
421|recruter|to recruit|${CU}
422|p√©riode d'essai|a trial period|${CU}
423|poste|a post, a position|${CU}
424|nommer qn √† un poste|to appoint sb to a post|${CU}
425|muter qn|to transfer sb|${CU}
426|poste √† responsabilit√©(s)|a responsible job|${CU}
427|emploi subalterne|a menial job|${CU}
428|demandeur d'emploi|a job-seeker|${CU}
429|agence P√¥le emploi|a Jobcenter (GB)|${CU}
430|CV, curriculum vitae|a curriculum vitae, a CV, a r√©sum√© (US)|${CU}
431|exp√©rience professionnelle|work experience|${CU}
432|comp√©tences|skills|${CU}
433|√™tre candidat √† un emploi, faire une demande d'emploi|to apply for a job|${CU}
434|candidat √† un poste|an applicant|${CU}
435|entretien d'embauche|a job interview|${CU}
436|offre d'emploi|a job offer, a job vacancy, a job opportunity|${CU}
437|travail OU main d'≈ìuvre|labour|${CU}
438|main d'≈ìuvre f√©minine / travail des enfants|female labour / child labour|${CU}
439|normes en mati√®re d'emploi|labour standards|${CU}
440|main d'≈ìuvre|manpower, workforce|${CU}
441|personnel|staff, personnel|${CU}
442|coll√®gue, camarade de travail|a colleague, a co-worker, a workmate|${CU}
443|ressources humaines|human resources|${CU}
444|travail qualifi√© / peu qualifi√© / non qualifi√©|a skilled / low-skilled / an unskilled job|${CU}
445|ouvrier sp√©cialis√©, OS|an unskilled worker|${CU}
446|ouvrier|a blue-collar worker|${CU}
447|employ√© de bureau|a white-collar worker|${CU}
448|fonctionnaire|a state employee, a civil servant|${CU}
449|salari√© du secteur public|a public-sector employee|${CU}
450|haut fonctionnaire|a high-ranking civil servant|${CU}
451|√™tre ind√©pendant, travailler √† son compte|to be self-employed|${CU}
452|travailleurs ind√©pendants|the self-employed|${CU}
453|honoraires|fees|${CU}
454|paie, paye|pay|${CU}
455|salaire|salary|${CU}
456|salaire (d'ouvrier)|wages|${CU}
457|gagner de l'argent|to earn money, to make money|${CU}
458|gagner sa vie|to earn a living, to earn one's living, to make a living|${CU}
459|Que fait-il dans la vie ?|What does he do for a living?|${CU}
460|travail mal pay√©|a badly-paid job, a low-paid job|${CU}
461|travail bien pay√©|a well-paid job, a highly-paid job|${CU}
462|salari√©|a wage-earner|${CU}
463|prime|a bonus|${CU}
464|avantage (en nature), avantage annexe|a perk, a fringe benefit|${CU}
465|voiture de fonction|a company car|${CU}
466|salaire au rendement|performance-related pay|${CU}
467|√™tre employ√© par une entreprise|to be on a company's payroll|${CU}
468|vacances|holiday, vacation (US)|${CU}
469|cong√©s pay√©s|paid holiday|${CU}
470|√™tre en vacances|to be on holiday|${CU}
471|jour f√©ri√©|a bank holiday|${CU}
472|√™tre en cong√© maladie|to be on sick leave|${CU}
473|prendre deux jours de cong√©|to take two days off|${CU}
474|r√©duction du temps de travail, RTT|reduction of working hours|${CU}
475|les 35 heures, la semaine de 35 heures|the 35-hour working week|${CU}
476|supprimer des emplois|to cut jobs|${CU}
477|faire des coupes sombres, claires dans la main d'≈ìuvre|to slash, to axe jobs|${CU}
478|pertes d'emploi, suppressions d'emploi|job losses|${CU}
479|rationaliser|to streamline|${CU}
480|d√©graisser ses effectifs|to downsize|${CU}
481|licencier des salari√©s|to lay off workers, to make workers redundant|${CU}
482|licenciement (√©conomique)|a redundancy|${CU}
483|d√©part volontaire|a voluntary redundancy|${CU}
484|plan social|a redundancy plan|${CU}
485|indemnit√© de licenciement, prime de d√©part|redundancy payment, severance pay, severance package|${CU}
486|parachute dor√©|a golden parachute, a golden handshake|${CU}
487|renvoyer, licencier, cong√©dier qn|to dismiss sb|${CU}
488|mettre √† la porte, renvoyer, virer|to fire, to sack, to give sb the sack|${CU}
489|√™tre renvoy√©|to get the sack|${CU}
490|conflit social|an industrial dispute|${CU}
491|se mettre / √™tre en gr√®ve|to go on strike / be on strike|${CU}
492|gr√©viste|a striker|${CU}
493|direction et les salari√©s|management and workers|${CU}
494|d√©l√©gu√© syndical|a shop steward|${CU}
495|syndicat|a (trade) union|${CU}
496|revendication|a claim|${CU}
497|revendications salariales|wage claims, wage demands|${CU}
498|augmentation de salaire|a payrise (GB), a payraise (US)|${CU}
499|reprendre le travail|to resume work|${CU}
500|prendre sa retraite|to retire|${CU}
501|d√©missionner|to resign, to step down|${CU}
502|retrait√©|a pensioner, an old age pensioner, a retiree (US)|${CU}
503|retraite|retirement|${CU}
504|partir en pr√©-retraite|to take early retirement|${CU}
505|√¢ge de la retraite|retirement age|${CU}
506|bien r√©ussir √† l'√©cole|to do well at school|Education
507|lire l'anglais couramment|to read English fluently|Education
508|√™tre bon en sport|to be good at sports|Education
509|faire l'√©cole buissonni√®re|to play truant|Education
510|absent√©isme|truancy|Education
511|suivre un cours d'anglais|to take a class in English|Education
512|donner du travail √† la maison|to set homework|Education
513|rendre un travail|to hand in a piece of work|Education
514|les subtilit√©s de la langue anglaise|the intricacies of the English language|Education
515|se lancer|to get started|Education
516|se conformer √† une r√®gle|to obey a rule|Education
517|ob√©ir √† (qqn)|to obey (sone)|Education
518|avoir des difficult√©s en maths|to have difficulty with maths|Education
519|donner un coup de main √† (qqn)|to give (sone) a hand|Education
520|obtenir un dipl√¥me|to graduate|Education
521|une salle de classe|a classroom|Education
522|une le√ßon|a class|Education
523|rattraper un cours loup√©|to catch up a missed lesson|Education
524|√©valuer|to assess, appraise|Education
525|le programme scolaire|the school curriculum|Education
526|√©tudiant de premier cycle|undergraduate|Education
527|indisciplin√©|unruly|Education
528|incontr√¥lable|unmanageable|Education
529|b√¢cler ses devoirs|to dash off one's work|Education
530|obtenir une bonne note|to get a good mark|Education
531|tricher sur son voisin|to eye over one's neighbour's work|Education
532|principal, directeur (√©cole)|headmaster|Education
533|√©l√®ve dou√©|gifted pupil|Education
534|r√©ussir un examen haut la main|to pass a test with flying colors|Education
535|une mati√®re (scolaire)|a (school) subject|Education
536|une pause de 20 minutes|a 20-minute break|Education
537|une heure de cours|a teaching-hour|Education
538|passer dans la classe sup√©rieure|to pass the next grade|Education
539|travail de paperasse|paperwork|Education
540|passer un examen|to take an exam|Education
541|examen blanc|mock exam|Education
542|se pr√©parer √† un examen|to prepare for an exam|Education
543|√©chouer √† un examen|to flunk a test|Education
544|recaler (qqn)|to flunk (sone)|Education
545|√™tre re√ßu √† un examen avec mention|to pass a degree with distinction|Education
546|abandonner l'√©cole|to drop out of school|Education
547|un √©l√®ve d√©crocheur|a dropout|Education
548|obtenir une bourse|to get a scholarship|Education
549|entrer en fac de m√©decine|to go to a medical school|Education
550|faire des √©tudes de m√©decine|to study medicine|Education
551|remettre un √©v√®nement √† plus tard|to put off an event|Education
552|sortie scolaire|school trip|Education
553|faire des recherches sur (qqch)|to do research on (sthg)|Education
554|cour d'√©cole|schoolyard|Education
555|un √©l√®ve de terminale|[UK] a sixth-former|Education
556|m√©ticuleux|painstaking|Education
557|s√©cher un cours|to skip a lesson|Education
558|se voir accorder la possibilit√© de [...]|to be provided with an opportunity to [...]|Education
559|tricher|to cheat|Education
560|un tricheur|a cheater|Education
561|√™tre renvoy√©|to be expelled|Education
562|rouler sur un examen|to sail through an exam|Education
563|sauce (tomate)|dressing|Thanksgiving
564|chuckle|laughter|Thanksgiving
565|to gather|to get together|Thanksgiving
566|a feast|a banquet|Thanksgiving
567|to reach accross|to make efforts to join|Thanksgiving
568|one another|each other|Thanksgiving
569|to winnow away|to filter out and remove|Thanksgiving
570|widely viewed as|largely regarded as|Thanksgiving
571|twice|two times|Thanksgiving
572|to provide|to give|Thanksgiving
573|the bulk of|the biggest part of|Thanksgiving
574|to depict|to describe|Thanksgiving
575|to feature|to represent, show|Thanksgiving
576|subservient|submissive, docile|Thanksgiving
577|pilgrims|migrants arriving in America from England in 17th|Thanksgiving
578|to outnumber|to surpass in number|Thanksgiving
579|to crouch|almost to sit on the floor|Thanksgiving
580|a harvest|a crop|Thanksgiving
581|likely|probably|Thanksgiving
582|a deed|an [bad] action|Thanksgiving
583|settlers|colons|Thanksgiving
584|in retaliation for|in revenge for|Thanksgiving
585|to broker|to organize, negotiate|Thanksgiving
586|to grab|to seize|Thanksgiving
587|gauzy|transparent|Thanksgiving
588|willfully|deliberately|Thanksgiving
589|How [s.one] would have it|What [s.one] would like to believe|Thanksgiving
590|druthers|inclination, penchant|Thanksgiving
591|blissfully|ecstatically|Thanksgiving
592|bleached out|washed out|Thanksgiving
593|to abid|to respect|Thanksgiving
594|alt√©rer|alter|Thanksgiving
595|apprentissage en continu|lifelong learning|Thanksgiving
596|malaise|general feeling of discomfort|Business
597|stagflation|period of slow economic growth and high unemployment|Business
598|aftermath|the consequences of a significant unpleasant event|Business
599|hyperinflation|extremely high and accelerating inflation|Business
600|third-world countries|countries with lower economic development|Business
601|martial law|military control over civilian functions of government|Business
602|gleaming|shining brightly, describe something polished or new|Business
603|suburban area|residential area on the outskirts of the a city|Business
604|stagnation|lack of activity, growth, and development|Business
605|dispirited|having lost emthusiasm and hope|Business
606|fatalistic|believing that events are inevitable|Business
607|hollowed out|destroyed or weakened from within|Business
608|brimming|filled to the point of overflowing (with positive emotions and energy)|Business
609|rabais, ristourne|discount|Business
610|cha√Æne de montage|assembly line|Business
611|payer comptant|to pay cash|Business
612|p√©nurie de main d'oeuvre|labor shortage|Business
613|productivit√©|productivity|Business
614|soumettre sa candidature|to apply|Business
615|racheter|to buy out|Business
616|licencier|to lay off|Business
617|se mettre en gr√®ve|to go on strike|Business
618|service client|customer service|Business
619|repr√©sentant syndical|union representative|Business
620|commerƒáant|shopkeeper|Business
621|virer, mettre √† la porte|to fire|Business
622|se mettre √† son compte|to set up one's business|Business
623|d√©missionner|to resign|Business
624|en sureffectif|overstaffed|Business
625|contrat √† dur√©e ind√©termin√©e|permanent contract|Business
626|√©quipe de nuit|night shift|Business
627|service, d√©partement|department|Business
628|refondre, r√©organiser|to revamp|Business
629|concurrent|competitor|Business
630|fusion|merger|Business
631|faire faillite|to go bankrupt, bust|Business
632|embaucher|to hire, take on|Business
633|fiche de paie|pay slip|Business
634|faire des heures suppl√©mentaires|work overtime|Business
635|mettre la cl√© sous la porte|to go out of business, close up shop|Business
636|fait main|handmade|Business
637|artisan|craftsman|Business
638|ouvrier qualifi√©|skilled worker|Business
639|entreprise|business|Business
640|plein emploi|full employment|Business
641|un maire|a mayor|Politique
642|homme politique|politician|Politique
643|s'assurer une majorit√©|to secure a majority|Politique
644|d√©clencher des √©lections anticip√©es|to call an early election|Politique
645|(UK) les √©l√©ctions l√©gislatives|(UK) the general election|Politique
646|(US) les √©l√©ctions pr√©sidentielles|(US) the general election|Politique
647|les grands partis|mainstream parties|Politique
648|premier ministre|Prime Minister|Politique
649|le ministre de l'√©conomie et des finances|(UK) the Chancellor of the Exchequer|Politique
650|remaniement minist√©riel|Cabinet reshuffle|Politique
651|ministre des Affaires √©trang√®res|Foreign minister|Politique
652|pronncer un discours|to deliver a speech|Politique
653|une dictature|a dictatorship|Politique
654|museler, ba√Ælloner|to gag, muzzle|Politique
655|soci√©t√© civile|civil society|Politique
656|(UK) syndicats|(UK) trade unions|Politique
657|(US) syndicats|(US) labor unions|Politique
658|√©lections de mi-mandat|mid-term elections|Politique
659|minisre "frondeur"|rebellious minister|Politique
660|d√©missionner|resign, step down|Politique
661|officier en tant que|to serve as|Politique
662|opposer son veto √† (qqch)|to veto (sthg)|Politique
663|un projet de loi|a bill|Politique
664|un groupe de r√©flexion|a think-tank|Politique
665|(UK) un ministre|(UK) a Cabinet member|Politique
666|un directeur de cabinet|a chief of staff|Politique
667|imp√¥ts locaux|local taxes|Politique
668|cote de popularit√©|approval ratings|Politique
669|se pr√©senter √† une √©l√©ction|to run for election [office]|Politique
670|pr√™ter serment|to take the oath, be sworn in|Politique
671|rendre homage √† (qqn)|to pay tribute to (sone)|Politique
672|dirigeant|political leader|Politique
673|√©lection truqu√©e|rigged election|Politique
674|les allocations|social benefits|Politique
675|revaloriser|to scale up, raise, increase|Politique
676|l'allocation familliale|the family allowance|Politique
677|le gel de la production|the production freeze|Politique
678|un bras de fer|a tug of war|Politique
679|chancelant|teetering, wavering|Politique
680|tailored|customized|Politique
681|rote memorisation|repetition-based learning|Politique
682|impoverished|cash-strapped|Politique
683|unencumbered|unburdened|Politique
684|inquisitiveness|interest, curiosity|Politique
685|substantially|notably, significatly|Politique
686|authoritarian|dictatorial, strict|Politique
687|minimally supervised|lightly monitored|Politique
688|crime, criminality|la criminalit√©|${CR}
689|the crime rate|le taux de criminalit√©|${CR}
690|organized crime|la criminalit√© organis√©e, le grand banditisme|${CR}
691|white-collar crime|la criminalit√© en col blanc|${CR}
692|juvenile delinquency|la d√©linquance juv√©nile|${CR}
693|a juvenile delinquent, a young offender|un d√©linquant juv√©nile|${CR}
694|petty crime|la petite d√©linquance|${CR}
695|a crime, a felony|un crime|${CR}
696|to commit a crime|commettre un crime|${CR}
697|a criminal, a felon|un criminel|${CR}
698|a criminal record|un casier judiciaire|${CR}
699|an offense|un d√©lit, une infraction|${CR}
700|a misdemeanour|une infraction (GB), un d√©lit (US)|${CR}
701|an offender|un d√©linquant, un contrevenant|${CR}
702|a repeat offender, a recidivist|un r√©cidiviste|${CR}
703|murder|le meurtre|${CR}
704|a murderer|un meurtrier|${CR}
705|manslaughter|homicide|${CR}
706|a serial killer|un tueur en s√©rie|${CR}
707|theft|le vol|${CR}
708|a thief, a robber|un voleur|${CR}
709|to steal a watch|voler une montre|${CR}
710|to rob sb of sth|voler qch √† qn|${CR}
711|rape|le viol|${CR}
712|armed robbery|vol √† main arm√©e|${CR}
713|a burglary|un cambriolage|${CR}
714|to mug sb, to attack sb|agresser qn|${CR}
715|money-laundering|le blanchiment d‚Äôargent|${CR}
716|to break a law|enfreindre une loi|${CR}
717|lawful / unlawful|l√©gal / ill√©gal|${CR}
718|a lawbreaker|un d√©linquant, une personne qui enfreint la loi|${CR}
719|wrongdoing|des m√©faits|${CR}
720|a wrongdoer|un malfaiteur|${CR}
721|to flout the law|se moquer de la loi|${CR}
722|a no-go area|une zone de non-droit|${CR}
723|to obey the law|ob√©ir √† la loi|${CR}
724|to abide by the law|respecter la loi|${CR}
725|a law-abiding citizen|un citoyen respectueux des lois|${CR}
726|the justice system|la justice|${CR}
727|a court, a court of law|un tribunal|${CR}
728|a judge|un juge|${CR}
729|a lawyer, a barrister (GB), an attorney (US)|un avocat|${CR}
730|the jury|le jury|${CR}
731|to prosecute sb|poursuivre qn (en justice)|${CR}
732|to bring a lawsuit against sb, sue sb|intenter un proc√®s √† qn, engager des poursuites contre qn|${CR}
733|the prosecutor|le procureur|${CR}
734|a suspect|un suspect|${CR}
735|to charge sb with murder|accuser, inculper qn de meurtre|${CR}
736|a charge|une accusation, un chef d‚Äôinculpation|${CR}
737|to confess to a crime|avouer un crime|${CR}
738|to confess to embezzling money|avouer avoir d√©tourn√© de l‚Äôargent|${CR}
739|confession|un aveu|${CR}
740|a defendant|un accus√©, un pr√©venu|${CR}
741|a witness / an eye witness|un t√©moin / un t√©moin oculaire|${CR}
742|a case|une affaire|${CR}
743|a trial|un proc√®s|${CR}
744|to be tried, stand trial|passer en jugement, √™tre jug√©|${CR}
745|to await trial|√™tre en attente de jugement|${CR}
746|the principle that a defendant is innocent until proven guilty|la pr√©somption d‚Äôinnocence|${CR}
747|forensic evidence|preuves relev√©es lors d‚Äôune expertise|${CR}
748|a culprit|un coupable|${CR}
749|to acquit sb|acquitter qn|${CR}
750|acquittal|acquittement|${CR}
751|to find sb guilty|condamner qn, reconna√Ætre qn coupable|${CR}
752|to convict sb of rape, murder|reconna√Ætre qn coupable de viol, meurtre|${CR}
753|a conviction|une condamnation|${CR}
754|a fine|une amende|${CR}
755|to fine sb for sth|condamner qn √† une amende pour qch|${CR}
756|to be sentenced to five years‚Äô imprisonment, five years in jail|√™tre condamn√© √† cinq ans de prison|${CR}
757|a death sentence|une condamnation √† mort|${CR}
758|a life sentence|une condamnation √† perp√©tuit√©|${CR}
759|a suspended sentence|une condamnation avec sursis|${CR}
760|to be sent to prison|√™tre mis en prison|${CR}
761|to incarcerate, to imprison sb|incarc√©rer qn|${CR}
762|the incarceration rate|le taux d‚Äôincarc√©ration|${CR}
763|a cell|une cellule|${CR}
764|a prisoner, an inmate, a detainee|un d√©tenu, un prisonnier|${CR}
765|a prison officer, a prison warder (GB)|un gardien de prison|${CR}
766|a high-security prison|une prison de haute s√©curit√©|${CR}
767|solitary confinement|l‚Äôisolement carc√©ral|${CR}
768|prison overcrowding|la surpopulation carc√©rale|${CR}
769|a miscarriage of justice|une erreur judiciaire|${CR}
770|to fabricate evidence|fabriquer des preuves|${CR}
771|to be proved innocent, to be exonerated|√™tre innocent√©|${CR}
772|to free, to release a prisoner|lib√©rer, rel√¢cher un prisonnier|${CR}
773|to pardon a convict|gr√¢cier un condamn√©|${CR}
774|to parole sb|mettre qn en libert√© conditionnelle|${CR}
775|to be on parole|√™tre en libert√© conditionnelle|${CR}
776|to report to the police|se pr√©senter √† la police|${CR}
777|an electronic tag|un bracelet de surveillance √©lectronique|${CR}
`.trim();
 
    // Parsing de la liste brute -> structure homog√®ne
    const flashcardData = cardsRawText
      .split(/\r?\n/)
      .map(l => {
        const parts = l.split('|');
        if (parts.length === 4) {
          const [id, f, e, c] = parts;
          return {
            id: id.trim(),
            front: f.trim(), // c√¥t√© FR par d√©faut (recto)
            back: e.trim(), // c√¥t√© EN par d√©faut (verso)
            chapter: c.trim() // nom du chapitre (¬´ Democracy ¬ª, ¬´ Crime ¬ª, etc.)
          };
        }
        return null;
      })
      .filter(Boolean);
 
    // Helpers pour construire les chapitres √† partir de la liste brute
    function slugify(s) {
      return s.toLowerCase()
        .normalize('NFD').replace(/[\u0300-\u036f]/g, '')
        .replace(/[^a-z0-9]+/g, '-').replace(/(^-|-$)/g, '');
    }
 
    function emojiFor(title) {
      return CHAPTER_EMOJIS[title] || '';
    }
 
    function buildChaptersFromFlashcards(list) {
      const byChap = {};
      list.forEach(row => {
        const name = row.chapter || 'Sans cat√©gorie';
        (byChap[name] = byChap[name] || []).push(row);
      });
 
      const chapters = Object.keys(byChap).map(name => {
        const id = 'chap-' + slugify(name);
        const cards = byChap[name].map(row => ({
          id: `${slugify(name)}-${row.id}`,
          front: row.front,
          back: row.back,
          grade: 'unseen',
          timesReviewed: 0,
          lastReviewed: 0,
          lastMs: 0,
          avgMs: 0,
          perfEma: 0.5,
          ef: 2.5,
          intervalDays: 0,
          dueAt: 0,
          streak: 0,
          successes: 0,
          failures: 0
        }));
        return {
          id,
          title: name,
          // vous pouvez afficher l‚Äôemoji dans le titre ou en description
          description: emojiFor(name) ? `${emojiFor(name)} ${name}` : name,
          settings: {
            sessionSize: 10,
            dailyGoal: 10,
            reviewOrder: 'front-first'
          },
          filters: {
            grades: {
              unseen: true,
              echec: true,
              difficile: true,
              bien: true,
              facile: true
            }
          },
          stats: {
            gradeCounts: {
              unseen: cards.length,
              echec: 0,
              difficile: 0,
              bien: 0,
              facile: 0
            },
            totalReviews: 0,
            dailyReviews: {},
            dailyChanges: {},
            dailyDurMs: {},
            dailyDurCount: {}
          },
          cards
        };
      });
 
      return {
        chapters,
        app: {
          currentChapterId: chapters[0]?.id || null
        }
      };
    }
 
    let data = loadData();
 
    function loadData() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (raw) {
          return JSON.parse(raw);
        }
      } catch (e) {
        console.warn('Storage parse error', e);
      }
      // Si rien en storage, on construit depuis la liste coll√©e
      return buildChaptersFromFlashcards(flashcardData);
    }
 
 
    function saveData() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    }
    // ------------------ Utilitaires ------------------
    const $ = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));
    const ChartHit = {}; // { [canvasId]: { cx, cy, innerR, outerR, arcs:[{key,start,end}] } }
    const todayKey = () => {
      const d = new Date();
      const y = d.getFullYear();
      const m = (d.getMonth() + 1).toString().padStart(2, '0');
      const dd = d.getDate().toString().padStart(2, '0');
      return `${y}-${m}-${dd}`;
    };
 
    function clamp(n, min, max) {
      return Math.max(min, Math.min(max, n));
    }
 
    function formatDuration(ms) {
      const sec = Math.round(ms / 1000);
      const m = Math.floor(sec / 60);
      const s = sec % 60;
      return `${m}:${s.toString().padStart(2,'0')}`;
    }
 
    function avg(a) {
      if (!a || !a.length) return 0;
      return a.reduce((x, y) => x + y, 0) / a.length;
    }
 
    function pickN(arr, n) {
      const copy = arr.slice();
      for (let i = copy.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [copy[i], copy[j]] = [copy[j], copy[i]];
      }
      return copy.slice(0, n);
    }
 
    function deepClone(o) {
      return JSON.parse(JSON.stringify(o));
    }
    // ------------------ √âtat UI + Navigation ------------------
    const State = {
      view: 'deck', // 'deck' | 'chapter' | 'cards' | 'review' | 'recap' | 'settings'
      chapterId: null,
      review: null, // { chapterId, queue:[ids], index, flipped, answers:[], start, end }
      cardsIndex: 0
    };
    const Nav = {
      stack: [],
      push() {
        this.stack.push(deepClone({
          view: State.view,
          chapterId: State.chapterId,
          review: State.review,
          cardsIndex: State.cardsIndex
        }));
      },
      back() {
        if (this.stack.length === 0) return;
        const prev = this.stack.pop();
        State.view = prev.view;
        State.chapterId = prev.chapterId;
        State.review = prev.review;
        State.cardsIndex = prev.cardsIndex || 0;
        renderByState(false);
      },
      clear() {
        this.stack = [];
      }
    };
    // ------------------ √âl√©ments DOM persistants ------------------
    const backBtn = $('#backBtn');
    const titleEl = $('#title');
    const bottomActions = $('#bottomActions');
    const revisionBar = $('#revisionBar');
    const startReviewBtn = $('#startReviewBtn');
    backBtn.addEventListener('click', () => {
      // Si on quitte une r√©vision en cours, demander une confirmation
      if (State.view === 'review' && State.review && State.review.end == null) {
        if (!confirm('Quitter la r√©vision en cours ?')) return;
      }
 
      if (State.view !== 'chapter') {
        // Toujours ramener √† la vue Statistiques du chapitre courant
        if (State.chapterId) {
          return goChapter(State.chapterId, false);
        }
        // S'il n'y a pas de chapitre, fallback deck
        return goDeck(false);
      } else {
        // D√©j√† dans statistiques -> menu des decks
        return goDeck(false);
      }
    });
    $('#cardsBtn').addEventListener('click', () => goCards(State.chapterId));
    $('#settingsBtn').addEventListener('click', () => openSettings(State.chapterId));
    startReviewBtn.addEventListener('click', () => startReview(State.chapterId));
    // ------------------ Rendu (views) ------------------
    function setTopbar({
      showBack,
      title
    }) {
      backBtn.classList.toggle('hidden', !showBack);
      titleEl.textContent = title;
    }
 
    function setBottomVisibility({
      actions = false,
      revision = false,
      sessionSize = 10,
      enabled = true,
      available = 0
    }) {
      bottomActions.style.display = actions ? 'grid' : 'none';
      revisionBar.style.display = revision ? 'block' : 'none';
      const sessionPlan = Math.min(sessionSize, Math.max(available, 0) || sessionSize);
      startReviewBtn.textContent = `R√©vision ‚Ä¢ ${sessionPlan} cartes${revision ? ` ‚Ä¢ ${available} dispo` : ''}`;
      startReviewBtn.disabled = !enabled || available === 0;
    }
 
    function renderByState(push = true) {
      if (State.view === 'deck') goDeck(push);
      else if (State.view === 'chapter') goChapter(State.chapterId, push);
      else if (State.view === 'cards') goCards(State.chapterId, push);
      else if (State.view === 'review') goReview(push);
      else if (State.view === 'recap') goRecap(push);
      else if (State.view === 'settings') openSettings(State.chapterId, push);
    }
    // --- Vues
    function goDeck(push = true) {
      if (push) Nav.push();
      State.view = 'deck';
      State.chapterId = null;
      setTopbar({
        showBack: false,
        title: 'Deck'
      });
      setBottomVisibility({
        actions: false,
        revision: false
      });
      renderDeck();
    }
 
    function renderDeck() {
      const v = $('#view');
      const chapters = data.chapters;
      const showEmoji = data.app?.prefs?.showEmoji !== false;
 
      v.innerHTML = `
        <div class="card flexcol" style="flex:1;">
          <div class="section-title">Chapitres</div>
          <div id="deckList" class="scroll-y" style="flex:1; min-height:0; padding-right:4px;">
            <div class="list">
              ${chapters.map(ch => {
                const gc = ch.stats?.gradeCounts || {};
                const nonVus = gc.unseen ?? 0;
                const echec = gc.echec ?? 0;
                const diff = gc.difficile ?? 0;
                const bien = gc.bien ?? 0;
                const facile = gc.facile ?? 0;
                const total = ch.cards?.length ?? 0;
                const emoji = showEmoji ? emojiFor(ch.title) : '';
                return `
                <div class="deck-item" data-id="${ch.id}">
                  <div style="min-width:0">
                    <div style="font-weight:900; white-space:nowrap; overflow:hidden; text-overflow:ellipsis">
                      ${emoji ? `<span style="margin-right:6px">${emoji}</span>` : ''}${ch.title}
                    </div>
                    <div class="deck-meta">${ch.description || ''}</div>
                    <div class="mt6" style="display:flex; flex-wrap:wrap; gap:6px">
                      <span class="chip">Non vus: ${nonVus}/${total}</span>
                      <span class="chip" title="√âchec">‚õî ${echec}</span>
                      <span class="chip" title="Difficile">‚ö†Ô∏è ${diff}</span>
                      <span class="chip" title="Bien">üëç ${bien}</span>
                      <span class="chip" title="Facile">‚úÖ ${facile}</span>
                    </div>
                  </div>
                  <div class="muted" style="font-size:18px">‚Ä∫</div>
                </div>
              `;}).join('')}
            </div>
          </div>
        </div>
      `;
 
      $$('.deck-item').forEach(el => {
        el.addEventListener('click', () => {
          const id = el.getAttribute('data-id');
          goChapter(id);
        });
      });
    }
 
 
    function goChapter(chapterId, push = true) {
      if (push) Nav.push();
      State.view = 'chapter';
      State.chapterId = chapterId;
      const chap = getChapter(chapterId);
      const available = countAvailable(chap);
      setTopbar({
        showBack: true,
        title: chap?.title || 'Chapitre'
      });
      setBottomVisibility({
        actions: true,
        revision: true,
        sessionSize: chap.settings.sessionSize,
        enabled: (chap.cards && chap.cards.length > 0),
        available
      });
      renderChapter(chapterId);
    }
 
    function renderChapter(chapterId) {
      const v = $('#view');
      const chap = getChapter(chapterId);
      const gc = chap.stats.gradeCounts;
      const sel = chap.filters.grades || {};
 
      const unseen = gc.unseen ?? 0;
      const echec = gc.echec ?? 0;
      const diff = gc.difficile ?? 0;
      const bien = gc.bien ?? 0;
      const facile = gc.facile ?? 0;
 
      const today = getTodayCount(chap);
      const week = getWeekCount(chap);
      const success = getSuccessRate(chap);
      const avg7 = get7DayAvgMs(chap);
 
      v.innerHTML = `
        <div class="card" style="flex:1; display:flex; flex-direction:column;">
          <div class="section-title">Statistiques</div>
          <div class="kpi">
            <div class="k"><div class="label">Cartes non vues</div><div class="value">${unseen}</div></div>
            <div class="k"><div class="label">Total cartes</div><div class="value">${chap.cards.length}</div></div>
          </div>
 
          <div class="chart-wrap">
            <canvas id="gradeChart" width="180" height="180" aria-label="Diagramme des scores"></canvas>
          </div>
 
          <div class="legend" id="legend">
            <div class="legend-item ${sel.echec ? '' : 'inactive'}" data-key="echec" role="button" tabindex="0"><span class="dot red"></span> √âchec: ${echec}</div>
            <div class="legend-item ${sel.difficile ? '' : 'inactive'}" data-key="difficile" role="button" tabindex="0"><span class="dot amber"></span> Difficile: ${diff}</div>
            <div class="legend-item ${sel.bien ? '' : 'inactive'}" data-key="bien" role="button" tabindex="0"><span class="dot blue"></span> Bien: ${bien}</div>
            <div class="legend-item ${sel.facile ? '' : 'inactive'}" data-key="facile" role="button" tabindex="0"><span class="dot green"></span> Facile: ${facile}</div>
          </div>
 
          <div class="kpi mt8">
            <div class="k"><div class="label">Aujourd'hui</div><div class="value">${today}</div></div>
            <div class="k"><div class="label">Cette semaine</div><div class="value">${week}</div></div>
          </div>
          <div class="kpi mt8">
            <div class="k"><div class="label">Taux de r√©ussite</div><div class="value">${success}%</div></div>
            <div class="k"><div class="label">Temps moyen (7j)</div><div class="value">${avg7? (Math.round(avg7/100)/10)+'s':'‚Äî'}</div></div>
          </div>
 
          <div class="mt8 muted" style="font-size:12px">
            Filtres actifs: <b>${activeGradesLabel(sel)}</b>
          </div>
        </div>
        `;
 
      const counts = {
        echec,
        difficile: diff,
        bien,
        facile
      };
 
      // Dessiner le camembert (segments non s√©lectionn√©s att√©nu√©s)
      drawGradeChart('gradeChart', counts, sel);
 
      // Clic sur camembert (toujours support√©)
      const canvas = $('#gradeChart');
      canvas.style.cursor = 'pointer';
      canvas.onclick = (ev) => handleChartClick(ev, 'gradeChart', chap, counts);
 
      // Clic sur la l√©gende pour filtrer
      $$('#legend .legend-item').forEach(el => {
        const key = el.getAttribute('data-key');
        el.addEventListener('click', () => handleLegendClick(key, chap));
        el.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            handleLegendClick(key, chap);
          }
        });
      });
      // Mettre √† jour le bouton de r√©vision (cartes dispo selon filtre)
      updateRevisionBarForChapter(chap);
    }
 
 
 
    function updateRevisionBarForChapter(chap) {
      const available = countAvailable(chap);
      setBottomVisibility({
        actions: true,
        revision: true,
        sessionSize: chap.settings.sessionSize,
        enabled: available > 0,
        available
      });
    }
 
    function goCards(chapterId, push = true) {
      if (push) Nav.push();
      State.view = 'cards';
      State.chapterId = chapterId;
      const chap = getChapter(chapterId);
      setTopbar({
        showBack: true,
        title: `${chap.title} ‚Ä¢ Cartes`
      });
      setBottomVisibility({
        actions: false,
        revision: false
      });
      renderCards(chapterId);
    }
 
    function renderCards(chapterId) {
      const v = $('#view');
      const chap = getChapter(chapterId);
      const sel = chap.filters.grades || {};
      const pool = chap.cards.filter(c => sel[(c.grade || 'unseen')]);
 
      v.innerHTML = `
        <div class="card flexcol" style="flex:1;">
          <div class="section-title">Cartes disponibles</div>
          <div class="muted" style="font-size:12px; margin-bottom:6px">
            Filtres actifs: ${activeGradesLabel(sel)} ‚Ä¢ ${pool.length} carte(s)
          </div>
          <div id="cardsScroll" class="scroll-y" style="flex:1; min-height:0; padding-right:4px;">
            <div class="list">
              ${pool.map(c => `
                <div class="card-item">
                  <div style="min-width:0">
                    <div class="front" style="white-space:nowrap; overflow:hidden; text-overflow:ellipsis">${c.front}</div>
                    <div class="back mt4" style="white-space:nowrap; overflow:hidden; text-overflow:ellipsis">${c.back}</div>
                    <div class="mt4" style="font-size:12px; color:#c7d2fe">
                      Note: ${labelForGrade(c.grade)} ‚Ä¢ Temps moyen: ${c.avgMs ? (Math.round(c.avgMs/100)/10)+'s' : '‚Äî'}
                    </div>
                  </div>
                </div>
              `).join('')}
            </div>
          </div>
        </div>
      `;
    }
 
 
    function goReview(push = true) {
      if (push) Nav.push();
      State.view = 'review';
      const r = State.review;
      const chap = getChapter(r.chapterId);
      setTopbar({
        showBack: true,
        title: 'R√©vision'
      });
      setBottomVisibility({
        actions: false,
        revision: false
      });
      renderReview();
    }
 
    function renderReview() {
      const v = $('#view');
      const r = State.review;
      const chap = getChapter(r.chapterId);
      const total = r.queue.length;
      const current = getCurrentCard();
      const idx = r.index + 1;
 
      // Ordre d‚Äôaffichage (Face‚ÜíDos par d√©faut, sinon Dos‚ÜíFace)
      const frontFirst = chap.settings.reviewOrder !== 'back-first';
      const prompt = frontFirst ? current.front : current.back;
      const frontIsAnswer = !frontFirst; // si on commence par le dos, la r√©ponse est le recto
 
      v.innerHTML = `
        <div class="review-wrap">
          <div class="review-top">
            <div>${chap.title}</div>
            <div>${idx} / ${total}</div>
          </div>
 
          <div class="review-card">
            <div>
              ${!r.flipped
                ? `<div class="term">${prompt}</div>`
                : `
                  <div class="stack">
                    <div class="${frontIsAnswer ? 'definition' : 'term'}">${current.front}</div>
                    <div class="${frontIsAnswer ? 'term' : 'definition'}">${current.back}</div>
                  </div>
                `
              }
            </div>
          </div>
 
          <div class="review-actions" id="reviewActions">
            ${!r.flipped
              ? `<button class="btn" id="flipBtn">Retourner</button>`
              : `
                <div class="row-4">
                  <button class="btn red" id="grade_echec">√âchec</button>
                  <button class="btn amber" id="grade_difficile">Difficile</button>
                  <button class="btn blue" id="grade_bien">Bien</button>
                  <button class="btn green" id="grade_facile">Facile</button>
                </div>
              `
            }
          </div>
        </div>
        `;
 
      if (!r.flipped) {
        $('#flipBtn').addEventListener('click', () => {
          r.flipped = true;
          renderReview();
        });
      } else {
        $('#grade_echec').addEventListener('click', () => submitGrade('echec'));
        $('#grade_difficile').addEventListener('click', () => submitGrade('difficile'));
        $('#grade_bien').addEventListener('click', () => submitGrade('bien'));
        $('#grade_facile').addEventListener('click', () => submitGrade('facile'));
      }
    }
 
 
    function goRecap(push = true) {
      if (push) Nav.push();
      State.view = 'recap';
      setTopbar({
        showBack: true,
        title: 'R√©capitulatif'
      });
      setBottomVisibility({
        actions: false,
        revision: false
      });
      renderRecap();
    }
 
    function renderRecap() {
      const v = $('#view');
      const r = State.review;
      const chap = getChapter(r.chapterId);
      const totalSession = r.answers.length;
      const duration = r.end - r.start;
      const avgPerCard = totalSession ? duration / totalSession : 0;
      const todayChange = getTodayChange(chap);
      const todayReviews = getTodayCount(chap);
      v.innerHTML = `
        <div class="card recap" style="flex:1">
          <div>
            <h2>R√©capitulatif</h2>
            <div class="subtitle">${chap.title}</div>
          </div>
          <div class="grid2">
            <div class="stat">
              <div class="label">R√©visions/jour (7j)</div>
              <div class="val">${get7DayAverage(chap)}</div>
            </div>
            <div class="stat">
              <div class="label">Changement de classe aujourd'hui</div>
              <div class="val">${todayChange.total>0 ? Math.round( (todayChange.changed / todayChange.total)*100 ) : 0}%</div>
            </div>
            <div class="stat">
              <div class="label">Objectif quotidien</div>
              <div class="val">${chap.settings.dailyGoal}</div>
            </div>
            <div class="stat">
              <div class="label">R√©visions aujourd'hui</div>
              <div class="val">${todayReviews}/${chap.settings.dailyGoal}</div>
            </div>
          </div>
          <div class="grid2">
            <div class="stat">
              <div class="label">Total r√©visions (session)</div>
              <div class="val">${totalSession}</div>
            </div>
            <div class="stat">
              <div class="label">Dur√©e (session)</div>
              <div class="val">${formatDuration(duration)}</div>
            </div>
            <div class="stat">
              <div class="label">Temps moyen/carte</div>
              <div class="val">${formatDuration(avgPerCard)}</div>
            </div>
          </div>
          <div class="cta">
            <button class="btn" id="continueBtn">Continuer</button>
          </div>
        </div>
      `;
      $('#continueBtn').addEventListener('click', () => {
        // Relance une nouvelle session avec les m√™mes filtres
        startReview(r.chapterId);
      });
    }
    // ------------------ Logique R√©vision ------------------
    function startReview(chapterId) {
      if (!chapterId) return;
      const chap = getChapter(chapterId);
      const sel = chap.filters.grades;
      const pool = chap.cards.filter(c => sel[(c.grade || 'unseen')]);
      const size = Math.min(chap.settings.sessionSize, pool.length);
 
      if (size <= 0) {
        alert('Aucune carte disponible avec les filtres s√©lectionn√©s.');
        return;
      }
 
      const queue = buildSmartQueue(chap, pool, size).map(c => c.id);
 
      State.review = {
        chapterId,
        queue,
        index: 0,
        flipped: false,
        answers: [],
        start: Date.now(),
        end: null,
        cardStart: Date.now()
      };
      goReview();
    }
 
 
    function buildSmartQueue(chap, pool, size) {
      const now = Date.now();
      // Poids de base selon le grade courant
      const baseWMap = {
        unseen: 6,
        echec: 5,
        difficile: 3.5,
        bien: 2,
        facile: 1
      };
 
      const scored = pool.map(c => {
        const g = c.grade || 'unseen';
        const baseW = baseWMap[g] ?? 1;
 
        // √âch√©ance: si en retard, boost; si √† venir, l√©g√®re p√©nalisation
        let dueBoost = 1;
        if (c.dueAt && c.dueAt > 0) {
          const delta = now - c.dueAt; // >0 si en retard
          if (delta > 0) {
            const overdueDays = delta / 864e5;
            dueBoost = 1 + Math.min(3, overdueDays); // jusqu‚Äô√† x4
          } else {
            // pas en retard: pas prioritaire, mais pas exclu
            dueBoost = 0.85;
          }
        } else {
          // jamais planifi√©: priorit√© l√©g√®re
          dueBoost = 1.15;
        }
 
        // Performance moyenne (plus la perf est basse, plus on priorise)
        const ema = (typeof c.perfEma === 'number') ? c.perfEma : 0.5;
        const perfBoost = 1 + (1 - ema) * 1.6; // 1..2.6
 
        // Streak: longues s√©ries de succ√®s => l√©ger downweight; s√©ries d‚Äô√©checs => upweight
        const s = c.streak || 0;
        const streakAdj = s >= 3 ? (1 / (1 + 0.12 * (s - 2))) : (s < 0 ? (1 + 0.18 * Math.min(8, Math.abs(s))) : 1);
 
        // Temps moyen (plus c‚Äôest long, plus on priorise)
        const t = c.avgMs || 0;
        const timeBoost = 1 + Math.min(2, t / 3000); // max x3
 
        // L√©g√®re randomisation
        const jitter = 0.9 + Math.random() * 0.2;
 
        const weight = baseW * dueBoost * perfBoost * streakAdj * timeBoost * jitter;
        return {
          card: c,
          weight
        };
      });
 
      scored.sort((a, b) => b.weight - a.weight);
      return scored.slice(0, size).map(x => x.card);
    }
 
 
    function getCurrentCard() {
      const r = State.review;
      const chap = getChapter(r.chapterId);
      const id = r.queue[r.index];
      return chap.cards.find(c => c.id === id);
    }
 
    function submitGrade(nextGrade) {
      const r = State.review;
      const chap = getChapter(r.chapterId);
      const card = getCurrentCard();
      const now = Date.now();
 
      // 1) Dur√©e de r√©ponse
      const duration = Math.max(0, now - (r.cardStart || now));
 
      // 2) Comptages grades chapitre
      const prevGrade = card.grade || 'unseen';
      const next = nextGrade;
 
      const wasZeroBeforeNext = (chap.stats.gradeCounts[next] || 0) === 0;
 
      if (prevGrade !== next) {
        decrementGrade(chap, prevGrade);
        incrementGrade(chap, next);
      }
      if (prevGrade === next && prevGrade === 'unseen') {
        decrementGrade(chap, 'unseen');
        incrementGrade(chap, next);
      }
 
      // 3) Progression carte (EMA perf, E‚ÄëFactor, intervalle, streak)
      const alpha = 0.3; // EMA lissage
      const q01 = gradeNorm01(next);
      card.perfEma = (1 - alpha) * (card.perfEma ?? 0.5) + alpha * q01;
 
      scheduleNext(card, next, now);
 
      // 4) Temps / succ√®s / √©checs
      card.lastReviewed = now;
      card.lastMs = duration;
      card.avgMs = card.avgMs ? Math.round(card.avgMs * 0.7 + duration * 0.3) : duration;
      card.timesReviewed = (card.timesReviewed || 0) + 1;
      if (isSuccess(next)) card.successes += 1;
      else card.failures += 1;
 
      // 5) Stats globales jour (d√©j√† pr√©sentes)
      chap.stats.totalReviews += 1;
      const tk = todayKey();
      chap.stats.dailyReviews[tk] = (chap.stats.dailyReviews[tk] || 0) + 1;
      chap.stats.dailyDurMs[tk] = (chap.stats.dailyDurMs[tk] || 0) + duration;
      chap.stats.dailyDurCount[tk] = (chap.stats.dailyDurCount[tk] || 0) + 1;
      const dc = chap.stats.dailyChanges[tk] || {
        changed: 0,
        total: 0
      };
      dc.total += 1;
      if (prevGrade !== next) dc.changed += 1;
      chap.stats.dailyChanges[tk] = dc;
 
      // 6) Auto-s√©lection filtre si premi√®re apparition de cette note (si fonction d√©j√† en place)
      if (wasZeroBeforeNext && next !== 'unseen') {
        chap.filters.grades[next] = true;
      }
 
      // 7) Traces session et navigation
      r.answers.push({
        cardId: card.id,
        prev: prevGrade,
        next,
        ms: duration
      });
 
      if (r.index < r.queue.length - 1) {
        r.index += 1;
        r.flipped = false;
        r.cardStart = Date.now();
        saveData();
        renderReview();
      } else {
        r.end = Date.now();
        saveData();
        goRecap();
      }
    }
 
 
    function decrementGrade(chap, g) {
      if (!(g in chap.stats.gradeCounts)) return;
      chap.stats.gradeCounts[g] = Math.max(0, (chap.stats.gradeCounts[g] || 0) - 1);
    }
 
    function incrementGrade(chap, g) {
      chap.stats.gradeCounts[g] = (chap.stats.gradeCounts[g] || 0) + 1;
    }
    // ------------------ Helpers Chapitre/Stats ------------------
    function getChapter(id) {
      return data.chapters.find(c => c.id === id);
    }
 
    function labelForGrade(g) {
      return ({
        unseen: 'Non vu',
        echec: '√âchec',
        difficile: 'Difficile',
        bien: 'Bien',
        facile: 'Facile'
      })[g] || g;
    }
 
    function getTodayCount(chap) {
      const tk = todayKey();
      return chap.stats.dailyReviews[tk] || 0;
    }
 
    function getTodayChange(chap) {
      const tk = todayKey();
      const x = chap.stats.dailyChanges[tk] || {
        changed: 0,
        total: 0
      };
      return x;
    }
 
    function get7DayAverage(chap) {
      const days = [];
      const base = new Date();
      for (let i = 6; i >= 0; i--) {
        const d = new Date(base);
        d.setDate(base.getDate() - i);
        const y = d.getFullYear();
        const m = String(d.getMonth() + 1).padStart(2, '0');
        const dd = String(d.getDate()).padStart(2, '0');
        const key = `${y}-${m}-${dd}`;
        days.push(chap.stats.dailyReviews[key] || 0);
      }
      return Math.round(avg(days));
    }
 
    function getWeekCount(chap) {
      // Somme des 7 derniers jours (aujourd'hui inclus)
      const base = new Date();
      let sum = 0;
      for (let i = 0; i < 7; i++) {
        const d = new Date(base);
        d.setDate(base.getDate() - i);
        const y = d.getFullYear();
        const m = String(d.getMonth() + 1).padStart(2, '0');
        const dd = String(d.getDate()).padStart(2, '0');
        const key = `${y}-${m}-${dd}`;
        sum += (chap.stats.dailyReviews[key] || 0);
      }
      return sum;
    }
 
    function getSuccessRate(chap) {
      const gc = chap.stats.gradeCounts || {};
      const good = (gc.bien || 0) + (gc.facile || 0);
      const attempt = good + (gc.echec || 0) + (gc.difficile || 0);
      if (attempt === 0) return 0;
      return Math.round((good / attempt) * 100);
    }
 
    function get7DayAvgMs(chap) {
      if (!chap.stats.dailyDurMs || !chap.stats.dailyDurCount) return 0;
      const base = new Date();
      let sum = 0,
        cnt = 0;
      for (let i = 0; i < 7; i++) {
        const d = new Date(base);
        d.setDate(base.getDate() - i);
        const y = d.getFullYear();
        const m = String(d.getMonth() + 1).padStart(2, '0');
        const dd = String(d.getDate()).padStart(2, '0');
        const key = `${y}-${m}-${dd}`;
        const s = chap.stats.dailyDurMs[key] || 0;
        const c = chap.stats.dailyDurCount[key] || 0;
        sum += s;
        cnt += c;
      }
      return cnt ? Math.round(sum / cnt) : 0;
    }
 
    function activeGradesLabel(sel) {
      const keys = Object.keys(sel || {}).filter(k => sel[k]);
      if (keys.length === 0) return 'Aucun';
      if (keys.length === 5) return 'Tous';
      const map = {
        unseen: 'Jamais',
        echec: '√âchec',
        difficile: 'Difficile',
        bien: 'Bien',
        facile: 'Facile'
      };
      return keys.map(k => map[k] || k).join(' + ');
    }
 
 
    function countAvailable(chap) {
      const sel = chap.filters.grades;
      return chap.cards.filter(c => sel[(c.grade || 'unseen')]).length;
    }
    // ------------------ Diagramme donut ------------------
    function drawGradeChart(canvasId, counts, activeKeys = null) {
      const el = document.getElementById(canvasId);
      if (!el) return;
      const ctx = el.getContext('2d');
      const w = el.width,
        h = el.height;
      ctx.clearRect(0, 0, w, h);
 
      const centerX = w / 2,
        centerY = h / 2;
      const outerR = Math.min(w, h) / 2 - 6;
      const innerR = outerR * 0.65;
 
      const segments = [{
        key: 'echec',
        color: getComputedStyle(document.documentElement).getPropertyValue('--red').trim()
      }, {
        key: 'difficile',
        color: getComputedStyle(document.documentElement).getPropertyValue('--amber').trim()
      }, {
        key: 'bien',
        color: getComputedStyle(document.documentElement).getPropertyValue('--blue').trim()
      }, {
        key: 'facile',
        color: getComputedStyle(document.documentElement).getPropertyValue('--green').trim()
      }];
      const total = segments.reduce((s, seg) => s + (counts[seg.key] || 0), 0);
 
      const arcs = [];
      if (total === 0) {
        ctx.beginPath();
        ctx.arc(centerX, centerY, outerR, 0, Math.PI * 2);
        ctx.arc(centerX, centerY, innerR, 0, Math.PI * 2, true);
        ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--ring');
        ctx.globalAlpha = 0.25;
        ctx.fill();
        ctx.globalAlpha = 1;
        ctx.fillStyle = '#cbd5e1';
        ctx.font = 'bold 12px ui-sans-serif, system-ui';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText('Aucune donn√©e', centerX, centerY);
 
        ChartHit[canvasId] = {
          cx: centerX,
          cy: centerY,
          innerR,
          outerR,
          arcs: []
        };
        return;
      }
 
      let startAngle = -Math.PI / 2;
      segments.forEach(seg => {
        const value = counts[seg.key] || 0;
        if (value <= 0) return;
        const angle = (value / total) * Math.PI * 2;
        const endAngle = startAngle + angle;
 
        const isActive = !activeKeys || !!activeKeys[seg.key];
 
        ctx.beginPath();
        ctx.arc(centerX, centerY, outerR, startAngle, endAngle);
        ctx.arc(centerX, centerY, innerR, endAngle, startAngle, true);
        ctx.fillStyle = seg.color;
        ctx.globalAlpha = isActive ? 0.9 : 0.22;
        ctx.fill();
        ctx.globalAlpha = 1;
 
        arcs.push({
          key: seg.key,
          start: startAngle,
          end: endAngle
        });
        startAngle = endAngle;
      });
 
      // Centre label
      ctx.fillStyle = '#dbeafe';
      ctx.font = 'bold 18px ui-sans-serif, system-ui';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.fillText(total.toString(), centerX, centerY - 4);
      ctx.fillStyle = '#8aa0d3';
      ctx.font = '10px ui-sans-serif, system-ui';
      ctx.fillText('r√©ponses', centerX, centerY + 10);
 
      // Enregistrer la hitmap
      ChartHit[canvasId] = {
        cx: centerX,
        cy: centerY,
        innerR,
        outerR,
        arcs
      };
    }
 
    function toggleFilterKey(chap, key) {
      const sel = chap.filters.grades;
      const total = Object.keys(sel).length;
      const active = Object.keys(sel).filter(k => sel[k]);
      const isSelected = !!sel[key];
 
      if (active.length === total) {
        Object.keys(sel).forEach(k => sel[k] = false);
        sel[key] = true;
      } else if (active.length === 1 && isSelected) {
        sel[key] = true;
      } else {
        sel[key] = !isSelected;
        if (Object.keys(sel).filter(k => sel[k]).length === 0) {
          sel[key] = true;
        }
      }
    }
 
    function handleChartClick(evt, canvasId, chap, countsRef) {
      const map = ChartHit[canvasId];
      if (!map || !map.arcs || map.arcs.length === 0) return;
 
      const rect = evt.target.getBoundingClientRect();
      const scaleX = evt.target.width / rect.width;
      const scaleY = evt.target.height / rect.height;
      const x = (evt.clientX - rect.left) * scaleX;
      const y = (evt.clientY - rect.top) * scaleY;
 
      const dx = x - map.cx;
      const dy = y - map.cy;
      const r = Math.hypot(dx, dy);
      if (r < map.innerR || r > map.outerR) return;
 
      let a = Math.atan2(dy, dx);
      while (a < -Math.PI / 2) a += 2 * Math.PI;
      while (a > 3 * Math.PI / 2) a -= 2 * Math.PI;
 
      const hit = map.arcs.find(s => a >= s.start && a <= s.end);
      if (!hit) return;
 
      toggleFilterKey(chap, hit.key);
      saveData();
      renderChapter(chap.id);
    }
 
    function handleLegendClick(key, chap) {
      toggleFilterKey(chap, key);
      saveData();
      renderChapter(chap.id);
    }
 
    function applyTheme() {
      const theme = (data?.app?.theme) || 'dark';
      document.documentElement.setAttribute('data-theme', theme);
    }
 
    function applyUI() {
      const p = data.app.prefs || {};
      // Tailles de police
      document.documentElement.style.setProperty('--fs-term', (p.fsTerm || 20) + 'px');
      document.documentElement.style.setProperty('--fs-def', (p.fsDef || 24) + 'px');
      document.documentElement.style.setProperty('--fs-front-list', (p.fsFrontList || 16) + 'px');
      document.documentElement.style.setProperty('--fs-back-list', (p.fsBackList || 18) + 'px');
      // Arrondis
      document.documentElement.style.setProperty('--radius-md', (p.radius || 14) + 'px');
      // Accent (met √† jour --primary)
      const palette = {
        indigo: ['#6366f1', '#5457e6'],
        blue: ['#3b82f6', '#2563eb'],
        teal: ['#14b8a6', '#0d9488'],
        emerald: ['#10b981', '#059669'],
        rose: ['#f43f5e', '#e11d48'],
        amber: ['#f59e0b', '#d97706'],
        violet: ['#8b5cf6', '#7c3aed']
      };
      const acc = palette[p.accent] || palette.indigo;
      document.documentElement.style.setProperty('--primary', acc[0]);
      document.documentElement.style.setProperty('--primary-600', acc[1]);
    }
 
    // Mise √† jour des donn√©es
    function upgradeData() {
      data.app = data.app || {};
      if (!('theme' in data.app)) data.app.theme = 'dark';
      data.app.prefs = data.app.prefs || {};
      // Pr√©f√©rences UI par d√©faut
      if (typeof data.app.prefs.fsTerm !== 'number') data.app.prefs.fsTerm = 22; // px
      if (typeof data.app.prefs.fsDef !== 'number') data.app.prefs.fsDef = 24; // px
      if (!data.app.prefs.accent) data.app.prefs.accent = 'indigo'; // palette
      if (typeof data.app.prefs.showEmoji !== 'boolean') data.app.prefs.showEmoji = true;
 
      data.chapters.forEach(ch => {
        ch.cards.forEach(c => {
          if (typeof c.perfEma !== 'number') c.perfEma = 0.5; // moyenne mobile exp des notes (0..1)
          if (typeof c.ef !== 'number') c.ef = 2.5; // E‚ÄëFactor (SM‚Äë2), min 1.3
          if (typeof c.intervalDays !== 'number') c.intervalDays = 0; // intervalle en jours
          if (typeof c.dueAt !== 'number') c.dueAt = 0; // timestamp prochain passage
          if (typeof c.streak !== 'number') c.streak = 0; // s√©rie (+ succ√®s / - √©checs), born√©e
          if (typeof c.successes !== 'number') c.successes = 0;
          if (typeof c.failures !== 'number') c.failures = 0;
        });
      });
      saveData();
    }
    // ------------------ Param√®tres (placeholder) ------------------
    function openSettings(chapterId, push = true) {
      if (push) Nav.push();
      const chap = getChapter(chapterId);
      const v = $('#view');
      State.view = 'settings';
      setTopbar({
        showBack: true,
        title: `${chap.title} ‚Ä¢ Param√®tres`
      });
      setBottomVisibility({
        actions: false,
        revision: false
      });
      v.innerHTML = `
        <div class="card flexcol" style="flex:1;">
        <div class="section-title">Pr√©f√©rences</div>
        <div class="scroll-y" style="flex:1; min-height:0; padding:4px;">
 
          <div class="section-title">Apparence</div>
          <div class="mt6 muted" style="font-size:13px">
            ‚Ä¢ Th√®me: <b id="themeLbl">${data.app.theme==='light'?'Clair':'Sombre'}</b> ‚Äî <button class="btn" id="toggleTheme">Basculer</button><br>
            ‚Ä¢ Couleur d'accent: <b id="accentLbl">${data.app.prefs.accent}</b><br>
            <div style="display:flex; gap:6px; flex-wrap:wrap; margin-top:6px;">
              ${['indigo','blue','teal','emerald','rose','amber','violet'].map(k=>`
                <button class="chip" data-accent="${k}" ${data.app.prefs.accent===k?'style="outline:2px solid var(--primary)"':''}>${k}</button>
              `).join('')}
            </div>
          </div>
 
          <div class="section-title" style="margin-top:10px">Typographie</div>
           <div class="card" id="typoPreview" style="margin-bottom:8px; padding:10px">
            <div class="term">Exemple recto (Front)</div>
            <div class="definition" style="margin-top:6px">Exemple verso (Back)</div>
            <div class="muted" style="font-size:12px; margin-top:6px">La pr√©visualisation refl√®te vos r√©glages en temps r√©el.</div>
          </div>
          <div class="wheel mt6" id="wheelFsTerm"><div class="name">Recto (Front)</div><div class="hint">Glissez ‚Üë‚Üì</div><div class="wheel-value"></div></div>
          <div class="wheel mt6" id="wheelFsDef"><div class="name">Verso (Back)</div><div class="hint">Glissez ‚Üë‚Üì</div><div class="wheel-value"></div></div>
 
          <div class="section-title" style="margin-top:10px">Session & Objectif</div>
          <div class="wheel mt6" id="wheelSession"><div class="name">Taille session</div><div class="hint">Glissez ‚Üë‚Üì</div><div class="wheel-value"></div></div>
          <div class="wheel mt6" id="wheelGoal"><div class="name">Objectif quotidien</div><div class="hint">Glissez ‚Üë‚Üì</div><div class="wheel-value"></div></div>
 
        </div>
        </div>
      `;
 
      const P = data.app.prefs;
 
      const refreshTheme = () => {
        const theme = data.app.theme === 'light' ? 'Clair' : 'Sombre';
        $('#themeLbl').textContent = theme;
      };
 
      $('#toggleTheme').onclick = () => {
        data.app.theme = data.app.theme === 'light' ? 'dark' : 'light';
        saveData();
        applyTheme();
        refreshTheme();
      };
 
      $$('[data-accent]').forEach(b => {
        b.onclick = () => {
          P.accent = b.getAttribute('data-accent');
          saveData();
          applyUI();
          openSettings(chapterId, false); // Re-render to update outline
        };
      });
 
      bindWheel($('#wheelFsTerm'), {
        get: () => P.fsTerm,
        set: (v) => {
          P.fsTerm = v
        },
        min: 12,
        max: 44,
        step: 1,
        unit: 'px'
      });
      bindWheel($('#wheelFsDef'), {
        get: () => P.fsDef,
        set: (v) => {
          P.fsDef = v
        },
        min: 14,
        max: 52,
        step: 1,
        unit: 'px'
      });
 
      bindWheel($('#wheelSession'), {
        get: () => chap.settings.sessionSize,
        set: (v) => {
          chap.settings.sessionSize = v
        },
        min: 5,
        max: 200,
        step: 5,
        unit: ' cartes'
      });
      bindWheel($('#wheelGoal'), {
        get: () => chap.settings.dailyGoal,
        set: (v) => {
          chap.settings.dailyGoal = v
        },
        min: 5,
        max: 500,
        step: 5,
        unit: ' cartes'
      });
    }
 
    function syncFromRawFlashcards() {
      if (!Array.isArray(flashcardData) || flashcardData.length === 0) return;
      const byTitle = {};
      data.chapters.forEach(ch => byTitle[ch.title] = ch);
 
      // Index des cartes existantes par id pour chaque chapitre
      const ensureChapter = (title) => {
        if (byTitle[title]) return byTitle[title];
        // Cr√©er un nouveau chapitre
        const id = 'chap-' + slugify(title);
        const newChap = {
          id,
          title,
          description: emojiFor(title) ? `${emojiFor(title)} ${title}` : title,
          settings: {
            sessionSize: 10,
            dailyGoal: 10,
            reviewOrder: 'front-first'
          },
          filters: {
            grades: {
              unseen: true,
              echec: true,
              difficile: true,
              bien: true,
              facile: true
            }
          },
          stats: {
            gradeCounts: {
              unseen: 0,
              echec: 0,
              difficile: 0,
              bien: 0,
              facile: 0
            },
            totalReviews: 0,
            dailyReviews: {},
            dailyChanges: {},
            dailyDurMs: {},
            dailyDurCount: {}
          },
          cards: []
        };
        data.chapters.push(newChap);
        byTitle[title] = newChap;
        return newChap;
      };
 
      let added = 0;
      flashcardData.forEach(row => {
        const title = row.chapter || 'Sans cat√©gorie';
        const ch = ensureChapter(title);
        const cardId = `${slugify(title)}-${row.id}`;
        if (!ch.cards.find(c => c.id === cardId)) {
          ch.cards.push({
            id: cardId,
            front: row.front,
            back: row.back,
            grade: 'unseen',
            timesReviewed: 0,
            lastReviewed: 0,
            lastMs: 0,
            avgMs: 0,
            perfEma: 0.5,
            ef: 2.5,
            intervalDays: 0,
            dueAt: 0,
            streak: 0,
            successes: 0,
            failures: 0
          });
          ch.stats.gradeCounts.unseen += 1;
          added++;
        }
      });
 
      if (added > 0) {
        // S‚Äôassurer que le chapitre courant est coh√©rent
        if (!data.app.currentChapterId && data.chapters[0]) {
          data.app.currentChapterId = data.chapters[0].id;
        }
        saveData();
      }
    }
 
    function bindWheel(node, {
      get,
      set,
      min,
      max,
      step = 1,
      unit = 'px',
      onApply
    }) {
      const valueEl = node.querySelector('.wheel-value');
      const render = () => {
        valueEl.textContent = get() + (unit || '');
      };
      const clampv = (v) => Math.max(min, Math.min(max, v));
      let startY = null,
        startV = null;
 
      const commit = () => {
        saveData();
        applyUI();
        if (onApply) onApply();
      };
 
      const setVal = (v) => {
        set(clampv(v));
        render();
      };
 
      const pd = (e) => {
        e.preventDefault();
        e.stopPropagation();
      };
 
      node.addEventListener('pointerdown', (e) => {
        startY = e.clientY;
        startV = get();
        node.setPointerCapture?.(e.pointerId);
        pd(e);
      });
      node.addEventListener('pointermove', (e) => {
        if (startY == null) return;
        const dy = startY - e.clientY;
        const delta = Math.round(dy / 6) * step; // 6px ~ 1 step
        setVal(startV + delta);
        pd(e);
      });
      const end = (e) => {
        if (startY != null) commit();
        startY = null;
        startV = null;
        pd(e);
      };
      node.addEventListener('pointerup', end);
      node.addEventListener('pointercancel', end);
 
      // Molette (desktop)
      node.addEventListener('wheel', (e) => {
        e.preventDefault();
        const dir = e.deltaY > 0 ? -step : step;
        setVal(get() + dir);
        commit();
      }, {
        passive: false
      });
 
      render();
    }
 
    function gradeQuality5(g) {
      switch (g) {
        case 'facile':
          return 5;
        case 'bien':
          return 4;
        case 'difficile':
          return 2;
        case 'echec':
          return 1;
        default:
          return 0;
      }
    }
 
    function gradeNorm01(g) {
      switch (g) {
        case 'facile':
          return 1.0;
        case 'bien':
          return 0.75;
        case 'difficile':
          return 0.35;
        case 'echec':
          return 0.0;
        default:
          return 0.5;
      }
    }
 
    function isSuccess(g) {
      return g === 'facile' || g === 'bien';
    }
 
    // Planification SM‚Äë2 simplifi√©e + streak
    function scheduleNext(card, grade, now = Date.now()) {
      const q = gradeQuality5(grade);
      // E‚ÄëFactor
      let EF = card.ef || 2.5;
      EF = EF + (0.1 - (5 - q) * (0.08 + (5 - q) * 0.02));
      if (EF < 1.3) EF = 1.3;
      card.ef = EF;
 
      // Intervalle (jours) + due date
      if (q < 3) { // mauvaise r√©ponse (√©chec/difficile)
        card.intervalDays = (grade === 'echec') ? 0.02 : 0.5; // ~30 min ou 12h
        card.dueAt = now + card.intervalDays * 864e5;
        card.streak = (card.streak <= 0 ? card.streak - 1 : -1);
      } else { // bonne r√©ponse (bien/facile)
        let next;
        if (card.intervalDays < 1e-6) next = 1;
        else if (card.intervalDays < 1.5) next = 6;
        else next = Math.round(card.intervalDays * EF);
        card.intervalDays = next;
        card.dueAt = now + next * 864e5;
        card.streak = (card.streak >= 0 ? card.streak + 1 : 1);
      }
      // Borne le streak
      card.streak = Math.max(-8, Math.min(12, card.streak));
    }
 
    // ------------------ Init ------------------
    function init() {
      upgradeData();
      applyTheme();
      applyUI();
      syncFromRawFlashcards();
      Nav.clear();
      goDeck(false);
    }
    init();
  </script>
</body>
</html>
