/* --- VARIABLES & THEME --- */
:root {
  --bg: #0b1020; --surface: #12172b; --card: #161c33; --text: #e6ecff; --muted: #8aa0d3;
  --primary: #6366f1; --primary-600: #5457e6; --green: #22c55e; --blue: #3b82f6; --amber: #f59e0b; --red: #ef4444;
  --border: #232a48;
  --fs-term: 20px; --fs-def: 24px; --radius-md: 14px;
  --btn-neutral-bg: rgba(255,255,255,.06); --btn-neutral-fg: #e6ecff; --btn-neutral-bd: #232a48; --btn-neutral-bg-h: rgba(255,255,255,.10);
  --btn-soft-primary-bg: color-mix(in srgb,var(--primary) 22%,transparent); --btn-soft-primary-bg-h: color-mix(in srgb,var(--primary) 34%,transparent);
  --btn-soft-primary-fg: #dbe4ff; --btn-soft-primary-bd: color-mix(in srgb,var(--primary) 55%,transparent);
  --btn-soft-red-bg: rgba(239,68,68,.18); --btn-soft-red-bg-h: rgba(239,68,68,.28); --btn-soft-red-fg: #fecaca; --btn-soft-red-bd: rgba(239,68,68,.45);
  --btn-soft-amber-bg: rgba(245,158,11,.18); --btn-soft-amber-bg-h: rgba(245,158,11,.28); --btn-soft-amber-fg: #fde68a; --btn-soft-amber-bd: rgba(245,158,11,.45);
  --btn-soft-blue-bg: rgba(59,130,246,.18); --btn-soft-blue-bg-h: rgba(59,130,246,.28); --btn-soft-blue-fg: #bfdbfe; --btn-soft-blue-bd: rgba(59,130,246,.45);
  --btn-soft-green-bg: rgba(34,197,94,.18); --btn-soft-green-bg-h: rgba(34,197,94,.28); --btn-soft-green-fg: #bbf7d0; --btn-soft-green-bd: rgba(34,197,94,.45);
  --btn-solid-primary-bg: var(--primary); --btn-solid-primary-bg-h: var(--primary-600); --btn-solid-primary-fg: #fff; --btn-solid-primary-bd: var(--primary-600);
}
[data-theme="light"] {
  --bg: linear-gradient(180deg,#f8fafc 0%,#eef2f7 100%); --surface: #fff; --card: #fff; --text: #0f172a; --muted: #475569;
  --primary: #3b82f6; --primary-600: #2563eb; --border: #cbd5e1;
  --btn-neutral-bg: #f1f5f9; --btn-neutral-fg: #0f172a; --btn-neutral-bd: #cbd5e1; --btn-neutral-bg-h: #e2e8f0;
  --btn-soft-primary-bg: color-mix(in srgb,var(--primary) 14%,white 86%); --btn-soft-primary-bg-h: color-mix(in srgb,var(--primary) 22%,white 78%);
  --btn-soft-primary-fg: color-mix(in srgb,var(--primary) 78%,black 22%); --btn-soft-primary-bd: color-mix(in srgb,var(--primary) 35%,white 65%);
  --btn-soft-red-bg: #fee2e2; --btn-soft-red-bg-h: #fecaca; --btn-soft-red-fg: #991b1b; --btn-soft-red-bd: #fca5a5;
  --btn-soft-amber-bg: #fef3c7; --btn-soft-amber-bg-h: #fde68a; --btn-soft-amber-fg: #92400e; --btn-soft-amber-bd: #fcd34d;
  --btn-soft-blue-bg: #dbeafe; --btn-soft-blue-bg-h: #bfdbfe; --btn-soft-blue-fg: #1e3a8a; --btn-soft-blue-bd: #93c5fd;
  --btn-soft-green-bg: #dcfce7; --btn-soft-green-bg-h: #bbf7d0; --btn-soft-green-fg: #14532d; --btn-soft-green-bd: #86efac;
}
[data-theme="light"] :is(.definition,.card-item .back){color:var(--text)!important;opacity:1!important}
[data-theme="light"] .muted{color:#475569!important}
[data-theme="light"] .legend-item{color:#0f172a!important;border-color:#e2e8f0!important;background:0 0!important}
[data-theme="light"] :is(.revision-bar,.review-actions-bar){background:rgba(241,245,249,.9)!important;border-top:1px solid #e2e8f0!important}
[data-theme="light"] .btn--ghost{--btn-bg-h:rgba(0,0,0,.06)}

/* --- RESET & LAYOUT --- */
* { box-sizing: border-box; }
html, body { height: 100%; }
body { margin: 0; background: var(--bg); color: var(--text); font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif; overflow: hidden; font-size: 17px; -webkit-font-smoothing: antialiased; }
.wrapper { height: 100dvh; width: 100%; display: flex; align-items: center; justify-content: center; padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left); }
.phone { aspect-ratio: 9/16; height: 100%; width: auto; max-width: 100%; max-height: 100%; display: grid; grid-template-rows: var(--row-top,52px) var(--row-main,1fr) var(--row-actions,52px) var(--row-rev,64px); position: relative; min-height: 0; touch-action: pan-y; overflow: hidden; }
@media(min-width: 1024px) { .phone { aspect-ratio: auto; width: 100%; height: 100dvh; } .topbar, main#view, .bottom-actions, .revision-bar { max-width: 1200px; margin: 0 auto; width: 100%; } main#view { padding: 16px 20px; } }

/* --- COMPONENTS --- */
.topbar { position: sticky; top: 0; z-index: 10; display: flex; align-items: center; padding: 0 10px; }
.topbar .back { appearance: none; border: 0; outline: 0; background: 0 0; color: var(--text); padding: 8px 10px; margin-right: 4px; border-radius: 10px; display: flex; align-items: center; gap: 8px; cursor: pointer; font-weight: 700; }
.topbar .back:hover { background: rgba(255,255,255,.06); }
.topbar .title { font-weight: 800; font-size: 16px; margin-left: 2px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; cursor: pointer; }
.spacer { flex: 1; }

main#view { min-height: 0; height: 100%; display: flex; flex-direction: column; overflow: hidden; padding: 8px; gap: 10px; }
.hidden { display: none!important; }
.muted { color: var(--muted); }
.center { text-align: center; }
.mt6 { margin-top: 6px; }
.mt8 { margin-top: 8px; }
.scroll-y { overflow: auto; -webkit-overflow-scrolling: touch; overscroll-behavior: contain; touch-action: pan-y; } .scroll-lock { overflow: hidden; touch-action: none!important; }
.list, .flexcol { display: flex; flex-direction: column; gap: 8px; min-height: 0; } .stack { display: flex; flex-direction: column; gap: 6px; }
.row { display: grid; grid-template-columns: 1fr 1fr; gap: 6px; }
.grid2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
.row-4 { display: grid; grid-template-columns: repeat(4,1fr); gap: 8px; }
.input { width: 100%; padding: 8px 10px; border-radius: 10px; border: 1px solid var(--border); background: var(--surface); color: var(--text); font-size: 14px; outline: none; appearance: none; }
.input:focus { border-color: var(--primary); }

.card,.deck-item,.review-card,.legend-item,.kpi .k,.stat,.chip{background:0 0;border:0;border-radius:var(--radius-md)}

/* Deck & Lists */
.deck-item { display: flex; align-items: center; justify-content: space-between; padding: 0 8px; cursor: pointer; user-select: none; position: relative; overflow: hidden; touch-action: pan-y; border-bottom: 1px solid color-mix(in srgb, var(--border) 50%, transparent); pointer-events: auto; }
.deck-item:last-child { border-bottom: none; }
.deck-item .slide { display: flex; align-items: center; gap: 10px; padding: 12px 0; transition: transform .18s ease; will-change: transform; width: 100%; position: relative; z-index: 2; }
.deck-item .right-action { position: absolute; top: 0; right: 0; height: 100%; width: 92px; display: flex; align-items: center; justify-content: center; z-index: 1; }
.deck-item.reveal-delete .slide { transform: translateX(-92px); }
.deck-item.drop-target { outline: 2px dashed var(--primary); outline-offset: -2px; border-radius: var(--radius-md); background: color-mix(in srgb,var(--primary) 8%,transparent); }
.deck-item.drop-target-above::before { content:''; position:absolute; top:-2px; left:10px; right:10px; height:3px; background:var(--primary); border-radius:2px; z-index:10; }
.deck-item.drop-target-below::after { content:''; position:absolute; bottom:-2px; left:10px; right:10px; height:3px; background:var(--primary); border-radius:2px; z-index:10; }
.deck-item.drop-target-inside { background: color-mix(in srgb,var(--primary) 15%,transparent); outline: 2px solid var(--primary); }
.deck-item.dragging-origin { opacity: .3; }
.drag-ghost { position: fixed; left: 0; top: 0; pointer-events: none; z-index: 9999; transform: translate(-9999px,-9999px) scale(1.02); box-shadow: 0 10px 30px rgba(0,0,0,.35); background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius-md); padding: 10px 16px; font-weight: 700; font-size: 14px; color: var(--text); max-width: 250px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }

.folder-badge { font-weight: bold; color: var(--primary); margin-left: 6px; font-size: 12px; }

/* Selection mode checkbox */
.sel-checkbox { width: 22px; height: 22px; border-radius: 6px; border: 2px solid var(--border); background: transparent; cursor: pointer; display: flex; align-items: center; justify-content: center; flex-shrink: 0; transition: all 0.2s; margin-right: 8px; }
.sel-checkbox.checked { background: var(--primary); border-color: var(--primary); }
.sel-checkbox.checked::after { content: 'âœ“'; color: #fff; font-size: 14px; font-weight: bold; }

/* Red X button for removing from folder */
.remove-x { width: 26px; height: 26px; border-radius: 50%; background: rgba(239,68,68,0.15); border: 1px solid rgba(239,68,68,0.4); color: var(--red); font-size: 14px; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; flex-shrink: 0; transition: all 0.15s; }
.remove-x:hover { background: rgba(239,68,68,0.3); }

/* Confirm FAB */
.fab-confirm { position: fixed; bottom: calc(20px + env(safe-area-inset-bottom)); right: 20px; width: 56px; height: 56px; border-radius: 50%; background: var(--green); color: #fff; border: none; font-size: 24px; cursor: pointer; box-shadow: 0 4px 16px rgba(34,197,94,0.4); z-index: 100; display: flex; align-items: center; justify-content: center; transition: transform 0.2s, opacity 0.2s; }
.fab-confirm:active { transform: scale(0.9); }
.fab-cancel { position: fixed; bottom: calc(20px + env(safe-area-inset-bottom)); left: 20px; width: 56px; height: 56px; border-radius: 50%; background: var(--red); color: #fff; border: none; font-size: 20px; cursor: pointer; box-shadow: 0 4px 16px rgba(239,68,68,0.4); z-index: 100; display: flex; align-items: center; justify-content: center; transition: transform 0.2s; }
.fab-cancel:active { transform: scale(0.9); }

/* Indented folder children */
.deck-item.folder-child { padding-left: 28px; }
.deck-item.folder-child-depth-2 { padding-left: 48px; }
.deck-item.folder-child-depth-3 { padding-left: 68px; }

/* Deck emoji avatar */
.deck-emoji { width: 42px; height: 42px; border-radius: 12px; background: color-mix(in srgb, var(--primary) 15%, transparent); display: flex; align-items: center; justify-content: center; font-size: 20px; flex-shrink: 0; }
.deck-info { min-width: 0; flex: 1; }
.deck-info .deck-title { font-weight: 800; font-size: 15px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.deck-info .deck-sub { display: flex; align-items: center; gap: 8px; margin-top: 3px; font-size: 12px; color: var(--muted); }
.deck-info .deck-sub .mini-bar { width: 50px; height: 4px; border-radius: 2px; background: var(--border); overflow: hidden; flex-shrink: 0; }
.deck-info .deck-sub .mini-bar-fill { height: 100%; border-radius: 2px; background: var(--primary); transition: width 0.3s; }
.deck-info .deck-sub .mini-dots { display: flex; gap: 3px; }
.deck-info .deck-sub .mini-dots .md { width: 7px; height: 7px; border-radius: 50%; }
.deck-chevron { color: var(--muted); font-size: 16px; opacity: 0.5; padding-left: 6px; }

/* Stats row: chart + bar7 side by side */
.stats-row { display: flex; align-items: center; gap: 10px; margin: 0; }
.chart-wrap { display: flex; align-items: center; justify-content: center; height: auto; position: relative; z-index: 1; flex-shrink: 0; }
canvas#gradeChart { width: 140px; height: 140px; pointer-events: auto; }
.bar7-side { flex: 1; display: flex; flex-direction: column; gap: 2px; min-width: 0; }
.bar7-row { display: flex; align-items: center; gap: 6px; font-size: 11px; color: var(--muted); height: 18px; cursor: pointer; }
.bar7-row .bar7-label { width: 28px; text-align: right; flex-shrink: 0; font-weight: 600; }
.bar7-row .bar7-track { flex: 1; height: 10px; background: var(--border); border-radius: 5px; overflow: hidden; position: relative; }
.bar7-row .bar7-fill { height: 100%; border-radius: 5px; background: var(--primary); transition: width 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); }
.bar7-row .bar7-val { width: 20px; text-align: left; flex-shrink: 0; font-weight: 700; font-size: 10px; }

/* Stats grid */
.stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
.stat-card { padding: 10px 12px; border-radius: 10px; background: color-mix(in srgb, var(--border) 30%, transparent); }
.stat-card .stat-val { font-weight: 900; font-size: 20px; }
.stat-card .stat-lbl { font-size: 11px; color: var(--muted); margin-top: 1px; }

/* Section title */
.section-title { font-weight: 900; font-size: 14px; color: var(--primary); letter-spacing: .3px; margin: 0 0 6px; }

/* KPI */
.kpi { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; } .kpi .k { padding: 0; pointer-events: auto; } .k .label, .stat .label { color: var(--muted); font-size: 12px; } .k .value, .val { font-weight: 900; font-size: 17px; margin-top: 2px; }
.chip { display: inline-flex; align-items: center; gap: 8px; padding: 0; color: var(--muted); font-size: 12px; pointer-events: auto; }
.chip-pie { width: 18px; height: 18px; border-radius: 50%; background: conic-gradient(var(--primary) var(--progress,0%),var(--border) var(--progress,0%)); vertical-align: middle; display: inline-block; }

/* Legend compact */
.legend { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 8px; }
.legend-item { display: flex; align-items: center; gap: 4px; font-size: 12px; padding: 3px 8px; border-radius: 8px; background: color-mix(in srgb, var(--border) 30%, transparent); cursor: pointer; user-select: none; transition: opacity .15s; position: relative; z-index: 2; pointer-events: auto; }
.legend-item.inactive { opacity: .45; filter: grayscale(20%); }
.dot { width: 10px; height: 10px; border-radius: 50%; } .dot.gray { background: #9ca3af; } .dot.red { background: var(--red); } .dot.amber { background: var(--amber); } .dot.blue { background: var(--blue); } .dot.green { background: var(--green); }

main#view > .card { overflow-y: auto; -webkit-overflow-scrolling: touch; min-height: 0; pointer-events: auto; }

/* Review */
.review-wrap { position: relative; flex: 1; display: flex; flex-direction: column; min-height: 0; overflow: hidden; }
.review-top { display: flex; justify-content: space-between; color: var(--muted); font-size: 13px; flex-shrink: 0; padding-bottom: 4px; }
.review-card { flex: 1; display: flex; flex-direction: column; position: relative; overflow: hidden; min-height: 0; padding: 0; transition: background-color 0.4s ease; pointer-events: auto; }

.review-scroller { flex: 1; width: 100%; height: 100%; overflow-y: auto; overflow-x: hidden; -webkit-overflow-scrolling: touch; display: flex; flex-direction: column; padding: 10px; touch-action: pan-y; user-select: text; }
.review-scroller > * { margin-top: auto; margin-bottom: auto; width: 100%; }
.term, .definition { font-size: var(--fs-term)!important; font-weight: 600; text-align: center; white-space: pre-wrap; word-wrap: break-word; }
.definition { font-size: var(--fs-def)!important; font-weight: 900; }

.preview-box { background: var(--card); border: 2px dashed var(--border); border-radius: 14px; margin: 10px 14px; padding: 20px; text-align: center; min-height: 120px; display: flex; flex-direction: column; justify-content: center; gap: 15px; }
.preview-recto { font-size: var(--fs-term); font-weight: 600; color: var(--text); }
.preview-verso { font-size: var(--fs-def); font-weight: 900; color: var(--primary); border-top: 1px dashed var(--border); padding-top: 10px; }

/* MathJax & Img */
mjx-container { overflow: hidden; max-width: 100% !important; display: inline-block !important; padding: 4px 0; white-space: normal !important; vertical-align: middle; }
mjx-mtext { white-space: normal !important; display: inline !important; }
mjx-math { white-space: normal !important; max-width: 100%; }
.img-placeholder { display: block; background: rgba(255,255,255,0.05); color: #8aa0d3; padding: 15px; border: 2px dashed rgba(255,255,255,0.1); border-radius: 8px; margin: 15px auto; font-style: italic; font-size: 0.85rem; text-align: center; }
img { display: block; max-width: 100%; height: auto; margin: 10px auto; border-radius: 8px; background: var(--border); user-select: none; object-fit: contain; opacity: 1 !important; }

.bottom-actions, .revision-bar, .review-actions-bar { padding: 8px 10px calc(8px + env(safe-area-inset-bottom)); display: none; background: 0 0; border-top: 0; }
.bottom-actions { gap: 8px; grid-template-columns: 1fr 1fr; } .review-actions-bar { grid-row: 4; backdrop-filter: blur(8px) saturate(140%); }

.btn, .action, .rev-btn { background: var(--btn-bg,var(--btn-neutral-bg)); color: var(--btn-fg,var(--btn-neutral-fg)); border: 1px solid var(--btn-bd,var(--btn-neutral-bd)); border-radius: var(--radius-md); padding: 10px 12px; font-weight: 900; cursor: pointer; transition: .15s; width: 100%; appearance: none; outline: 0; font-size: 15px; }
.btn:hover { background: var(--btn-bg-h,var(--btn-bg,var(--btn-neutral-bg-h))); } .btn:disabled { opacity: .6; cursor: not-allowed; }
.btn--primary { --btn-bg: var(--btn-soft-primary-bg); --btn-bg-h: var(--btn-soft-primary-bg-h); --btn-fg: var(--btn-soft-primary-fg); --btn-bd: var(--btn-soft-primary-bd); }
.btn--red { --btn-bg: var(--btn-soft-red-bg); --btn-bg-h: var(--btn-soft-red-bg-h); --btn-fg: var(--btn-soft-red-fg); --btn-bd: var(--btn-soft-red-bd); }
.btn--amber { --btn-bg: var(--btn-soft-amber-bg); --btn-bg-h: var(--btn-soft-amber-bg-h); --btn-fg: var(--btn-soft-amber-fg); --btn-bd: var(--btn-soft-amber-bd); }
.btn--blue { --btn-bg: var(--btn-soft-blue-bg); --btn-bg-h: var(--btn-soft-blue-bg-h); --btn-fg: var(--btn-soft-blue-fg); --btn-bd: var(--btn-soft-blue-bd); }
.btn--green { --btn-bg: var(--btn-soft-green-bg); --btn-bg-h: var(--btn-soft-green-bg-h); --btn-fg: var(--btn-soft-green-fg); --btn-bd: var(--btn-soft-green-bd); }
.btn--solid.btn--primary { --btn-bg: var(--btn-solid-primary-bg); --btn-bg-h: var(--btn-solid-primary-bg-h); --btn-fg: var(--btn-solid-primary-fg); --btn-bd: var(--btn-solid-primary-bd); }
.btn--ghost { --btn-bg: transparent; --btn-bg-h: rgba(255,255,255,.06); --btn-fg: var(--muted); --btn-bd: var(--border); } .btn--tiny { padding: 6px 8px; font-size: 13px; border-radius: 8px; }

.cards-grid { display: grid; grid-template-columns: 1fr; gap: 10px; } @media(min-width: 480px) { .cards-grid { grid-template-columns: 1fr 1fr; } }
.card-block { position: relative; border: 2px solid transparent; border-radius: 14px; padding: 14px; background: 0 0; max-height: none; overflow: hidden; display: flex; flex-direction: column; }
.card-block .term, .card-block .definition { margin: auto 0; width: 100%; word-break: break-word; }
.card-block .definition { display: none; text-align: center; margin-top: 6px; } .card-block.flipped .definition { display: block; } .card-block .term { text-align: center; }
.cb-time { position: absolute; right: 10px; bottom: 8px; font-size: 12px; color: var(--muted); }
.card-block.grade-echec { border-color: var(--red); } .card-block.grade-difficile { border-color: var(--amber); } .card-block.grade-bien { border-color: var(--blue); } .card-block.grade-facile { border-color: var(--green); } .card-block.grade-unseen { border-color: #9ca3af; }

.subject-menu { position: absolute; top: 52px; left: 10px; background: var(--surface); color: var(--text); border: 1px solid var(--border); border-radius: var(--radius-md); min-width: 220px; box-shadow: 0 10px 30px rgba(0,0,0,.35); padding: 6px; z-index: 1000; display: none; }
.subject-item { display: flex; align-items: center; gap: 8px; padding: 8px 10px; border-radius: 10px; cursor: pointer; } .subject-item:hover { background: rgba(255,255,255,.06); } .subject-item .name { font-weight: 800; flex: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; } .subject-item .meta { font-size: 12px; color: var(--muted); } .subject-item .subject-actions { margin-left: auto; display: flex; gap: 6px; }
.swatches { display: flex; gap: 8px; flex-wrap: wrap; } .swatch { width: 26px; height: 26px; border-radius: 8px; border: 1px solid var(--border); background: var(--sw,#6366f1); cursor: pointer; position: relative; } .swatch.is-active::after { content: ''; position: absolute; inset: -3px; border: 2px solid var(--primary); border-radius: 10px; }
.img-lightbox { position: fixed; inset: 0; display: none; background: 0 0; z-index: 10000; } .img-lightbox.open { display: block; }
.img-stage { position: absolute; inset: 0; width: 100%; height: 100%; overflow: hidden; touch-action: none; cursor: grab; } .img-canvas { position: absolute; top: 0; left: 0; transform-origin: 0 0; will-change: transform; }

.s-control { display: flex; align-items: center; gap: 15px; padding: 0 14px 15px; }
.s-slider-container { flex: 1; display: flex; align-items: center; height: 40px; position: relative; }
.s-slider { -webkit-appearance: none; appearance: none; width: 100%; height: 6px; background: var(--border); border-radius: 3px; outline: none; cursor: grab; }
.s-slider::-webkit-slider-thumb { -webkit-appearance: none; width: 22px; height: 22px; background: var(--primary); border-radius: 50%; cursor: pointer; border: 3px solid var(--surface); box-shadow: 0 1px 3px rgba(0,0,0,0.3); margin-top: 0; position: relative; z-index: 2; }
.step-btn { width: 32px; height: 32px; border-radius: 6px; border: none; background: var(--surface); color: var(--text); font-size: 18px; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; }
.step-btn:active { transform: scale(0.9); background: var(--primary); color: #fff; }

.settings-page { padding: 0 12px; }
.settings-hero { font-size: 28px; font-weight: 900; padding: 16px 4px 12px; }
.settings-section { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; margin-bottom: 14px; overflow: hidden; }
.settings-section .section-title { padding: 10px 14px 6px; font-size: 12px; text-transform: uppercase; letter-spacing: 0.4px; color: var(--muted); margin: 0; }
.settings-row { display: flex; align-items: center; padding: 11px 14px; border-bottom: 1px solid var(--border); gap: 12px; cursor: pointer; transition: background 0.15s; }
.settings-row:last-child { border-bottom: none; }
.settings-row:active { background: rgba(255,255,255,0.04); }
.settings-row .s-icon { width: 30px; height: 30px; border-radius: 7px; display: flex; align-items: center; justify-content: center; font-size: 16px; flex-shrink: 0; color: #fff; }
.s-icon.dynamic { background: var(--primary) !important; transition: background 0.3s ease; }
.s-icon.danger { background: var(--red) !important; }
.settings-row .s-label { flex: 1; min-width: 0; }
.settings-row .s-title { font-weight: 600; font-size: 15px; }
.settings-row .s-sub { font-size: 12px; color: var(--muted); margin-top: 1px; }
.settings-row .s-value { color: var(--muted); font-size: 14px; }
.settings-row .s-chevron { color: var(--muted); font-size: 16px; opacity: 0.6; }
.s-toggle { width: 48px; height: 28px; border-radius: 14px; background: var(--border); position: relative; cursor: pointer; transition: background 0.2s; flex-shrink: 0; }
.s-toggle.on { background: var(--primary); }
.s-toggle::after { content: ''; position: absolute; width: 24px; height: 24px; border-radius: 50%; background: #fff; top: 2px; left: 2px; transition: transform 0.2s; box-shadow: 0 1px 3px rgba(0,0,0,0.2); }
.s-toggle.on::after { transform: translateX(20px); }
.settings-section .swatches { padding: 0; gap: 6px; }
.settings-section .swatch { width: 24px; height: 24px; }
.settings-footer { text-align: center; padding: 20px; color: var(--muted); font-size: 12px; }
.toast { position: fixed; bottom: calc(80px + env(safe-area-inset-bottom)); left: 50%; transform: translateX(-50%) translateY(100px); background: var(--surface); color: var(--text); padding: 12px 20px; border-radius: 12px; border: 1px solid var(--border); box-shadow: 0 8px 32px rgba(0,0,0,0.3); font-weight: 600; font-size: 14px; z-index: 9999; opacity: 0; transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.3s; pointer-events: none; max-width: 90%; text-align: center; }
.toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }
.toast.success { border-left: 4px solid var(--green); } .toast.error { border-left: 4px solid var(--red); } .toast.info { border-left: 4px solid var(--primary); }

.progress-bar { position: absolute; top: 0; left: 0; height: 3px; background: linear-gradient(90deg, var(--primary), var(--green)); border-radius: 0 3px 3px 0; transition: width 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); z-index: 5; }

.card-block,.deck-item{transition:transform .2s,border-color .2s,box-shadow .2s,background-color .3s}
.card-block:active,.deck-item:active{transform:scale(.98)}

.focus-mode .topbar, .focus-mode .review-top { opacity: 0.3; transition: opacity 0.3s; }
.focus-mode .topbar:hover, .focus-mode .review-top:hover { opacity: 1; }

/* Math label (less bold) */
.math-label { color: var(--primary); font-weight: 600; font-size: 0.93em; display: block; margin-top: 10px; margin-bottom: 2px; opacity: 0.8; }